<!DOCTYPE html>
<html lang="es" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ruby - Status Code 418</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <script type="module" src="assets/js/firebase-config.js"></script>
    <script type="module" src="assets/js/firebase-storage.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/line-numbers/prism-line-numbers.css">
    <link rel="stylesheet" href="assets/css/auras.css">
    <!-- Monaco Editor Loader -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.36.1/min/vs/loader.min.js"></script>
    <script src="assets/js/theme-manager.js"></script>
    <style>
     :root {
         --background: #1a1b26;
         --foreground: #a9b1d6;
         --card-background: #24283b;
         --border: #414868;
         --accent: #7aa2f7;
         --accent-dark: #5a7edb;
         --green: #9ece6a;
         --yellow: #e0af68;
         --red: #f7768e;
         --font-sans: 'Inter', sans-serif;
         --font-mono: 'JetBrains Mono', monospace;
     }

     body {
         color: var(--foreground);
         font-family: var(--font-sans);
         margin: 0;
         padding: 0;
         position: relative;
         overflow-x: hidden;
     }

     .background-container {
         position: fixed;
         top: 0;
         left: 0;
         width: 100%;
         height: 100%;
         z-index: -1;
         transition: opacity 0.5s ease;
     }

     .background-day, .background-night {
         position: absolute;
         top: 0;
         left: 0;
         width: 100%;
         height: 100%;
         background-size: cover;
         background-position: center;
         opacity: 0;
         transition: opacity 1s ease;
     }

     .background-day {
         background-image: url('https://i.pinimg.com/originals/71/f1/b9/71f1b924a56150104ec16828f2d31b7f.gif');
     }

     .background-night {
         background-image: url('https://i.pinimg.com/originals/4c/23/98/4c2398e6be397bb08b5cb70b2192d730.gif');
     }

     .dark .background-night {
         opacity: 1;
     }

     .background-day {
         opacity: 1;
     }

     .content-box {
         background-color: rgba(36, 40, 59, 0.85);
         border: 1px solid var(--border);
         border-radius: 15px;
         padding: 2rem;
         box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
         backdrop-filter: blur(10px);
         display: flex;
         justify-content: center;
         align-items: center;
         min-height: calc(100vh - 4rem);
         margin: 2rem;
     }

     /* Index Page Styles */
     .main-container {
         display: flex;
         flex-direction: column;
         align-items: center;
         justify-content: center;
         min-height: calc(100vh - 4rem);
         text-align: center;
     }

     .main-title {
         font-size: 5rem;
         font-weight: bold;
         color: var(--accent);
         text-shadow: 0 0 15px var(--accent);
         margin-bottom: 1rem;
     }

     .main-subtitle {
         font-size: 1.5rem;
         margin-bottom: 3rem;
         max-width: 600px;
     }

     .course-grid {
         display: grid;
         grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
         gap: 2.5rem;
         width: 100%;
         max-width: 1400px;
         padding: 2rem 0;
         justify-items: center;
     }

     .course-card-link {
         text-decoration: none;
     }

     .course-card {
         background: linear-gradient(135deg, var(--card-background) 0%, rgba(65, 72, 104, 0.5) 100%);
         border: 1px solid var(--border);
         border-radius: 20px;
         padding: 2.5rem;
         transition: all 0.4s ease;
         display: flex;
         flex-direction: column;
         align-items: center;
         gap: 1.5rem;
         position: relative;
         overflow: hidden;
     }

     .course-card::before {
         content: '';
         position: absolute;
         top: 0;
         left: 0;
         right: 0;
         bottom: 0;
         background: linear-gradient(135deg, rgba(122, 162, 247, 0.1) 0%, rgba(158, 206, 106, 0.1) 100%);
         opacity: 0;
         transition: opacity 0.4s ease;
         border-radius: 20px;
     }

     .course-card:hover {
         transform: translateY(-15px) scale(1.05);
         box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4), 0 0 20px rgba(122, 162, 247, 0.3);
         border-color: var(--accent);
     }

     .course-card:hover::before {
         opacity: 1;
     }

     .course-icon {
         font-size: 4rem;
         color: var(--accent);
         transition: transform 0.3s ease, color 0.3s ease;
         z-index: 1;
     }

     .course-card:hover .course-icon {
         transform: scale(1.1);
         color: var(--yellow);
     }

     .course-title {
         font-size: 1.5rem;
         font-weight: 600;
         color: var(--foreground);
         z-index: 1;
         transition: color 0.3s ease;
     }

     .course-card:hover .course-title {
         color: var(--yellow);
     }

     .course-description {
         color: var(--foreground);
         opacity: 0.7;
         z-index: 1;
         transition: opacity 0.3s ease;
     }

     .course-card:hover .course-description {
         opacity: 1;
     }

     /* Course Page Styles */
     .panel {
         display: none;
         animation: fadeIn 0.5s ease;
         width: 100%;
     }

     .panel.active {
         display: flex;
     }

     @keyframes fadeIn {
         from {
             opacity: 0;
             transform: scale(0.98);
         }
         to {
             opacity: 1;
             transform: scale(1);
         }
     }

     .code-block {
         background-color: #1e1e2e;
         border: 1px solid var(--border);
         color: #c0caf5;
         font-family: var(--font-mono);
         border-radius: 8px;
         margin-top: 1rem;
     }

     .code-block-header {
         background-color: var(--border);
         padding: 0.5rem 1rem;
         display: flex;
         align-items: center;
         gap: 0.5rem;
     }

     .code-block-header span {
         width: 12px;
         height: 12px;
         border-radius: 50%;
     }

     .code-block-header .bg-red-500 { background-color: var(--red); }
     .code-block-header .bg-yellow-500 { background-color: var(--yellow); }
     .code-block-header .bg-green-500 { background-color: var(--green); }

     pre {
         margin: 0;
         padding: 1rem;
         white-space: pre-wrap;
         word-wrap: break-word;
     }

     .code-block .language-html .tag,
     .code-block .language-css .at-rule,
     .code-block .language-javascript .keyword {
         color: var(--accent);
     }

     .code-block .language-html .string,
     .code-block .language-css .string,
     .code-block .language-javascript .string {
         color: var(--green);
     }

     .code-block .language-css .property,
     .code-block .language-javascript .property {
         color: var(--yellow);
     }

     .code-block .language-html .comment,
     .code-block .language-css .comment,
     .code-block .language-javascript .comment {
         color: #5c6370;
     }

     .btn-primary {
         background-color: var(--accent);
         color: white;
         padding: 0.75rem 1.5rem;
         border-radius: 8px;
         font-weight: 600;
         border: none;
         cursor: pointer;
         transition: background-color 0.2s;
     }

     .btn-primary:hover {
         background-color: var(--accent-dark);
     }

     .btn-primary:disabled {
         opacity: 0.5;
         cursor: not-allowed;
     }

     .quiz-option {
         border: 2px solid var(--border);
         background-color: transparent;
         color: var(--foreground);
         padding: 1rem;
         border-radius: 8px;
         cursor: pointer;
         transition: all 0.2s;
         text-align: left;
         width: 100%;
         user-select: none;
         -webkit-user-select: none;
         -moz-user-select: none;
         -ms-user-select: none;
     }

     .quiz-option:hover:not(.disabled) {
         border-color: var(--accent);
         background-color: rgba(122, 162, 247, 0.1);
     }

     .quiz-option.correct {
         border-color: var(--green);
         background-color: rgba(158, 206, 106, 0.1);
         color: var(--green);
     }

     .quiz-option.incorrect {
         border-color: var(--red);
         background-color: rgba(247, 118, 142, 0.1);
         color: var(--red);
     }

     .quiz-option.disabled {
         pointer-events: none;
         opacity: 0.7;
     }

     .level-node {
         display: flex;
         flex-direction: column;
         align-items: center;
         position: relative;
         cursor: pointer;
     }

     .level-icon-wrapper {
         width: 64px;
         height: 64px;
         border-radius: 50%;
         display: flex;
         align-items: center;
         justify-content: center;
         border: 3px solid;
         transition: all 0.3s ease;
     }

     .level-number {
         margin-top: 8px;
         font-weight: 600;
         font-size: 0.9rem;
     }

     .level-node.locked .level-icon-wrapper {
         border-color: var(--border);
         color: var(--border);
         background-color: transparent;
     }

     .level-node.unlocked .level-icon-wrapper {
         border-color: var(--accent);
         color: var(--accent);
     }

     .level-node.unlocked:hover .level-icon-wrapper {
         background-color: var(--accent);
         color: var(--card-background);
         transform: scale(1.1);
     }

     .level-node.completed .level-icon-wrapper {
         border-color: var(--green);
         background-color: var(--green);
         color: var(--card-background);
     }

     #level-grid {
         display: grid;
         grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
         gap: 32px 16px;
         width: 100%;
         max-width: 60rem;
         margin: 0 auto;
     }

     .progress-bar-bg {
         background-color: var(--border);
         border-radius: 9999px;
         height: 0.625rem;
     }

     .progress-bar-fill {
         background-color: var(--accent);
         height: 0.625rem;
         border-radius: 9999px;
     }

     .hidden {
         display: none;
     }

     /* Estilos para el contenido de la lección */
     .lesson-content h3 {
         color: var(--accent);
         margin-top: 1.5rem;
         margin-bottom: 0.5rem;
     }

     .lesson-content ul, .lesson-content ol {
         margin-left: 1.5rem;
         margin-bottom: 1rem;
     }

     .lesson-content li {
         margin-bottom: 0.5rem;
     }

     .lesson-content code {
         background-color: rgba(122, 162, 247, 0.1);
         color: var(--accent);
         padding: 0.2rem 0.4rem;
         border-radius: 4px;
         font-family: var(--font-mono);
         font-size: 0.9em;
     }

     .lesson-content strong {
         color: var(--yellow);
     }

     .lesson-content p {
         margin-bottom: 1rem;
         line-height: 1.6;
     }

     /* Chat Styles */
     #chat-toggle-btn {
         background-color: var(--yellow) !important;
         color: var(--card-background) !important;
         border: none !important;
         box-shadow: 0 4px 12px rgba(224, 175, 104, 0.3) !important;
     }

     #chat-toggle-btn:hover {
         background-color: var(--accent) !important;
         transform: scale(1.1) !important;
         box-shadow: 0 6px 16px rgba(224, 175, 104, 0.4) !important;
     }

     #chat-modal {
         background-color: var(--card-background) !important;
         border: 1px solid var(--border) !important;
         box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5) !important;
     }

     #chat-messages {
         scrollbar-width: thin;
         scrollbar-color: var(--border) transparent;
     }

     #chat-messages::-webkit-scrollbar {
         width: 6px;
     }

     #chat-messages::-webkit-scrollbar-track {
         background: transparent;
     }

     #chat-messages::-webkit-scrollbar-thumb {
         background-color: var(--border);
         border-radius: 3px;
     }

     #chat-messages::-webkit-scrollbar-thumb:hover {
         background-color: var(--accent);
     }

     #chat-input {
         background-color: var(--background) !important;
         border: 1px solid var(--border) !important;
         color: var(--foreground) !important;
     }

     #chat-input:focus {
         outline: none !important;
         border-color: var(--accent) !important;
         box-shadow: 0 0 0 2px rgba(122, 162, 247, 0.2) !important;
     }

     #chat-send-btn {
         background-color: var(--accent) !important;
         border: none !important;
     }

     #chat-send-btn:hover:not(:disabled) {
         background-color: var(--accent-dark) !important;
     }

     #chat-loading {
         color: var(--yellow) !important;
     }

     .chat-message-bubble {
         max-width: 85% !important;
         padding: 0.75rem !important;
         border-radius: 12px !important;
         font-size: 0.875rem !important;
         line-height: 1.4 !important;
         word-wrap: break-word !important;
     }

     .user-message {
         background-color: var(--accent) !important;
         color: white !important;
         margin-left: auto !important;
     }

     .ai-message {
         background-color: var(--border) !important;
         color: var(--foreground) !important;
         margin-right: auto !important;
     }

     /* Responsive Chat */
     @media (max-width: 640px) {
         #chat-modal {
             width: 95% !important;
             height: 400px !important;
             bottom: 80px !important;
             right: 2.5% !important;
             left: 2.5% !important;
         }

         .chat-message-bubble {
             max-width: 90% !important;
             font-size: 0.8rem !important;
         }
     }

     @media (min-width: 641px) {
         #chat-modal {
             width: 320px !important;
             height: 450px !important;
             bottom: 80px !important;
             right: 24px !important;
         }
     }

     /* Asegurar que el modal se oculte correctamente */
     #chat-modal.hidden {
         display: none !important;
     }

     /* Mejorar la funcionalidad del botón de cierre */
     #chat-close-btn {
         cursor: pointer !important;
         padding: 8px !important;
         border-radius: 6px !important;
         transition: all 0.2s ease !important;
         color: var(--foreground) !important;
     }

     #chat-close-btn:hover {
         background-color: rgba(255, 255, 255, 0.1) !important;
         transform: scale(1.1) !important;
     }

     /* Header del chat mejorado */
     #chat-modal header {
         background-color: rgba(26, 27, 38, 0.9) !important;
         backdrop-filter: blur(10px) !important;
     }

    /* Prism.js Tokyo Night inspired theme */
    /* Base from Prism default, colors adapted to Tokyo Night */
    code[class*="language-"], pre[class*="language-"] {
        color: #c0caf5;
        background: #1a1b26;
        text-shadow: none;
        font-family: "JetBrains Mono", Consolas, Monaco, "Andale Mono", "Ubuntu Mono", monospace;
        font-size: 0.95rem;
        line-height: 1.6;
        direction: ltr;
        text-align: left;
        white-space: pre;
        word-spacing: normal;
        word-break: normal;
        tab-size: 2;
        hyphens: none;
    }

    pre[class*="language-"] {
        padding: 1rem;
        margin: 0;
        overflow: auto;
        border-radius: 10px;
        border: 1px solid #414868;
        background: #1e1e2e;
    }

    :not(pre) > code[class*="language-"] {
        padding: .15rem .35rem;
        border-radius: .35rem;
        background: rgba(122,162,247,.12);
        color: #7aa2f7;
        border: 1px solid #414868;
    }

    .token.comment,
    .token.prolog,
    .token.doctype,
    .token.cdata {
        color: #565f89;
    }

    .token.punctuation { color: #c0caf5; }

    .token.property,
    .token.tag,
    .token.boolean,
    .token.number,
    .token.constant,
    .token.symbol,
    .token.deleted {
        color: #ff9e64;
    }

    .token.selector,
    .token.attr-name,
    .token.string,
    .token.char,
    .token.builtin,
    .token.inserted {
        color: #9ece6a;
    }

    .token.operator,
    .token.entity,
    .token.url,
    .language-css .token.string,
    .style .token.string {
        color: #c0caf5;
    }

    .token.atrule,
    .token.attr-value,
    .token.keyword { color: #bb9af7; }

    .token.function,
    .token.class-name { color: #7aa2f7; }

    .token.regex,
    .token.important,
    .token.variable { color: #e0af68; }

    .token.bold { font-weight: bold; }
    .token.italic { font-style: italic; }

    .token.entity { cursor: help; }

    /***** Line numbers plugin *****/
    pre.line-numbers {
        position: relative;
        padding-left: 3.2em;
        counter-reset: linenumber;
    }
    pre.line-numbers > code { position: relative; }

    .line-numbers .line-numbers-rows {
        position: absolute;
        pointer-events: none;
        top: 0; left: 0;
        width: 3em;
        border-right: 1px solid #2b3050;
        background: #1a1b26;
        user-select: none;
    }

    .line-numbers-rows > span {
        display: block;
        counter-increment: linenumber;
    }

    .line-numbers-rows > span:before {
        content: counter(linenumber);
        display: block;
        padding: 0 .8em 0 .6em;
        color: #565f89;
        text-align: right;
    }

    /***** Toolbar plugin *****/
    .prism-toolbar {
        position: absolute;
        top: .4rem;
        right: .4rem;
    }
    .prism-toolbar button, .prism-toolbar span {
        background: #24283b;
        color: #a9b1d6;
        border: 1px solid #414868;
        border-radius: 6px;
        padding: .25rem .5rem;
        font-size: .75rem;
    }
    .prism-toolbar button:hover { background: #2b3050; }
    </style>
</head>
<body>
            <div class="background-container">
        <div class="background-day"></div>
        <div class="background-night"></div>
    </div>


    <!-- Loading Overlay -->
    <div id="loading-overlay" class="fixed inset-0 bg-gray-900 bg-opacity-90 z-50 hidden items-center justify-center flex-col transition-opacity duration-300">
        <div class="relative w-24 h-24 mb-4">
            <div class="absolute inset-0 border-4 border-t-blue-500 border-r-transparent border-b-purple-500 border-l-transparent rounded-full animate-spin"></div>
            <div class="absolute inset-2 border-4 border-t-transparent border-r-blue-400 border-b-transparent border-l-purple-400 rounded-full animate-spin-reverse"></div>
            <div class="absolute inset-0 flex items-center justify-center">
                <i data-lucide="loader-2" class="w-8 h-8 text-white animate-pulse"></i>
            </div>
        </div>
        <p id="loading-message" class="text-xl font-bold text-white tracking-wider animate-pulse">CARGANDO RUBY...</p>
    </div>

    <div class="content-box">
        <div id="level-selection-panel" class="panel active flex-col items-center justify-center p-8">
            <a href="menu_inicio.html" class="absolute top-6 left-6 flex items-center gap-2 text-sm hover:underline" style="color: var(--accent-color);"><i data-lucide="arrow-left" class="w-4 h-4"></i>Volver al Menú</a>
            <button id="theme-toggle" class="absolute top-6 right-6 p-2 rounded-full hover:bg-gray-700 transition-colors">
                <i data-lucide="sun" class="w-6 h-6"></i>
            </button>
            <h1 class="text-4xl font-bold mb-2" style="color: var(--accent-color);">Curso de Ruby</h1>
            <p class="mb-12">Descubre la elegancia y productividad del mejor amigo de un programador.</p>
            <div id="level-grid"></div>
        </div>
        <div id="lesson-panel" class="panel flex-col p-4 md:p-8">
            <div class="flex-grow w-full max-w-4xl mx-auto flex flex-col">
                <header class="flex items-center justify-between mb-4">
                    <h2 id="lesson-title" class="text-2xl md:text-3xl font-bold"></h2>
                    <button id="close-lesson-btn" class="p-2 rounded-full hover:bg-gray-700">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </header>
                <div class="w-full progress-bar-bg rounded-full h-2.5 mb-6">
                    <div id="lesson-progress" class="progress-bar-fill h-2.5 rounded-full" style="width: 10%;"></div>
                </div>
                <div id="lesson-content" class="flex-grow prose prose-invert max-w-none prose-p:text-lg prose-headings:text-white prose-strong:text-white overflow-y-auto"></div>
                <script>
                  // Monaco Initialization (moved definition to later script block, called by renderLesson)
                </script>
                <footer class="flex justify-between items-center mt-6">
                    <button id="prev-btn" class="btn-primary" disabled>Anterior</button>
                    <span id="lesson-step" class="font-mono">1 / 10</span>
                    <button id="next-btn" class="btn-primary">Siguiente</button>
                </footer>
            </div>
        </div>
        <div id="quiz-panel" class="panel flex-col items-center justify-center p-4">
            <div class="w-full max-w-2xl">
                <header class="flex justify-between items-center mb-6">
                    <h2 id="quiz-level-title" class="text-2xl font-bold">Quiz - Nivel 1</h2>
                    <span id="quiz-progress" class="font-mono text-lg">1/10</span>
                </header>
                <p id="quiz-question" class="text-xl md:text-2xl text-center mb-8"></p>
                <div id="quiz-options" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
            </div>
        </div>
        <div id="results-panel" class="panel flex-col items-center justify-center text-center p-4">
            <i id="results-icon" class="w-24 h-24 mb-6"></i>
            <h2 id="results-title" class="text-4xl font-bold mb-4"></h2>
            <p id="results-score" class="text-2xl mb-2"></p>
            <p id="results-message" class="mb-8"></p>
            <div class="flex gap-4">
                <button id="retry-lesson-btn" class="btn-primary">Repetir Lección</button>
                <button id="next-level-btn" class="btn-primary hidden">Siguiente Nivel</button>
            </div>
        </div>
    </div>

    <!-- Floating Chat Button -->
    <button id="chat-toggle-btn" class="fixed bottom-6 right-6 p-4 rounded-full shadow-xl z-50 transition-all duration-300 transform hover:scale-110" style="background-color: var(--yellow); color: var(--card-background);">
        <i data-lucide="message-square" class="w-7 h-7"></i>
    </button>

    <!-- Chat Modal -->
    <div id="chat-modal" class="fixed bottom-20 right-6 w-80 h-[450px] rounded-xl shadow-2xl z-50 flex flex-col hidden" style="background-color: var(--card-background); border: 1px solid var(--border);">
        <!-- Chat Header -->
        <header class="p-3 border-b flex items-center justify-between" style="border-color: var(--border);">
            <div class="flex items-center">
                <i data-lucide="sparkles" class="w-5 h-5 mr-2" style="color: var(--yellow);"></i>
                <h3 class="font-semibold text-lg" style="color: var(--accent);">Asistente de Código</h3>
            </div>
            <button id="chat-close-btn" class="p-1 rounded-full hover:bg-gray-700">
                <i data-lucide="x" class="w-5 h-5"></i>
            </button>
        </header>

        <!-- Chat Messages Container -->
        <div id="chat-messages" class="flex-grow p-3 overflow-y-auto space-y-3">
            <!-- Mensaje de Bienvenida de la IA -->
            <div class="flex justify-start">
                <div class="ai-message chat-message-bubble">
                    Hola. Soy tu Asistente de Código. Pregunta sobre el contenido, la estructura o las funciones de Ruby que hemos visto en el curso.
                </div>
            </div>
        </div>

        <!-- Chat Input Area -->
        <div class="p-3 border-t" style="border-color: var(--border);">
            <div class="flex gap-2">
                <input type="text" id="chat-input" placeholder="Escribe tu pregunta..." class="flex-grow p-2 rounded-lg text-sm focus:ring-0" style="background-color: var(--background); border: 1px solid var(--border); color: var(--foreground);" onkeydown="if(event.key === 'Enter') document.getElementById('chat-send-btn').click()">
                <button id="chat-send-btn" class="p-2 rounded-lg transition-colors disabled:opacity-50" style="background-color: var(--accent); color: white;">
                    <i data-lucide="send" class="w-5 h-5"></i>
                </button>
            </div>
            <p id="chat-loading" class="text-xs text-center mt-1 hidden" style="color: var(--yellow);">Analizando la estructura...</p>
        </div>
    </div>

    <script>
    // --- DATOS DEL CURSO ---
    const courseData = [
        { // Nivel 1
            title: "La Gema de la Programación",
            lesson: [
                { title: "¿Qué es Ruby?", content: `<p>Ruby es un lenguaje de programación dinámico y de código abierto enfocado en la simplicidad y la productividad. Su elegante sintaxis es natural de leer y fácil de escribir.</p>`},
                { title: "Hola, Mundo en Ruby", content: `<p>Para imprimir algo en la pantalla (la consola), usamos el comando <code>puts</code> (put string).</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">puts "¡Hola, Mundo!"</code></pre></div>`},
                { title: "Comentarios", content: `<p>En Ruby, los comentarios de una sola línea comienzan con el símbolo de almohadilla <code>#</code>. Todo lo que sigue en esa línea es ignorado.</p>`},
                { title: "Variables", content: `<p>En Ruby, no necesitas una palabra clave como 'let' o 'const'. Simplemente le das un nombre a tu variable y le asignas un valor. Los nombres de variable deben empezar con una letra minúscula.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">mi_variable = "Este es un texto"\nputs mi_variable</code></pre></div>`},
                { title: "Strings (Cadenas)", content: `<p>El texto, como en otros lenguajes, se llama String. Puede ir entre comillas dobles <code>""</code> o simples <code>''</code>. Las comillas dobles permiten la "interpolación", que veremos más adelante.</p>`},
                { title: "Numbers (Números)", content: `<p>Ruby maneja números enteros (Integers) y decimales (Floats) de forma automática.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">edad = 30 # Integer\nprecio = 19.99 # Float</code></pre></div>`},
                { title: "Aritmética Simple", content: `<p>Puedes hacer operaciones matemáticas como suma (+), resta (-), multiplicación (*) y división (/).</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">resultado = 5 * (10 - 8)\nputs resultado # Imprime 10</code></pre></div>`},
                { title: "nil: La Ausencia de Valor", content: `<p>En Ruby, cuando algo no tiene valor, no es 'null' o 'undefined', es <code>nil</code>. Representa la nada. Es un objeto en sí mismo.</p>`},
                { title: "Todo es un Objeto", content: `<p>Una de las filosofías centrales de Ruby es que <strong>todo es un objeto</strong>. Esto significa que incluso un número o un simple texto tienen "poderes" (métodos) incorporados. Por ejemplo, puedes preguntarle a un texto su longitud.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">puts "hola".length # Imprime 4</code></pre></div>`},
                { title: "¡Listo para el Quiz!", content: "<p>Has escrito tu primera línea en Ruby y entiendes su filosofía y sus tipos de datos básicos. ¡A demostrarlo!</p>"}
            ],
            quiz: [
                { question: "¿Qué comando se usa para imprimir en Ruby?", options: ["print", "log", "puts"], answer: "puts" },
                { question: "¿Cómo se inicia un comentario en Ruby?", options: ["//", "#", "/*"], answer: "#" },
                { question: "En Ruby, la ausencia de valor se representa con...", options: ["null", "undefined", "nil"], answer: "nil" },
                { question: "¿Necesitas 'let' o 'const' para crear una variable?", options: ["Sí, siempre", "Solo para constantes", "No"], answer: "No" },
                { question: "La idea de que todo en Ruby tiene métodos (como .length) se debe a que...", options: ["Todo es una variable", "Todo es un objeto", "Todo es dinámico"], answer: "Todo es un objeto" },
                { question: "¿Cuál de estos es un 'Float'?", options: ["100", "19.99", "'99'"], answer: "19.99" },
                { question: "¿Cuál es el resultado de '10 / 5'?", options: ["2", "2.0", "5"], answer: "2" },
                { question: "Un nombre de variable válido en Ruby es...", options: ["MiVariable", "mi_variable", "2variable"], answer: "mi_variable" },
                { question: "El comando 'puts \"abc\".length' imprimirá...", options: ["abc", "3", "length"], answer: "3" },
                { question: "La principal filosofía de Ruby es la...", options: ["Complejidad y potencia", "Simplicidad y productividad", "Seguridad y rendimiento"], answer: "Simplicidad y productividad" }
            ]
        },
        { // Nivel 2
            title: "Arrays y Hashes",
            lesson: [
                { title: "Arrays en Ruby", content: `<p>Los arrays son colecciones ordenadas que pueden contener cualquier tipo de objeto.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">frutas = ["manzana", "banana", "naranja"]
puts frutas[0] # manzana</code></pre></div>` },
                { title: "Métodos de Arrays", content: `<p>push, pop, unshift, shift para manipular arrays.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">frutas.push("uva") # añade al final
frutas.pop # elimina del final</code></pre></div>` },
                { title: "Hashes en Ruby", content: `<p>Los hashes almacenan datos en pares clave-valor.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">persona = {nombre: "Ana", edad: 25}
puts persona[:nombre] # Ana</code></pre></div>` },
                { title: "Símbolos", content: `<p>Los símbolos (:nombre) son como strings inmutables, más eficientes para claves.</p>` },
                { title: "Iteración con each", content: `<p>El método each permite iterar sobre arrays y hashes.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">frutas.each do |fruta|
  puts "Me gusta la #{fruta}"
end</code></pre></div>` },
                { title: "Métodos de Búsqueda", content: `<p>select, find, include? para buscar elementos.</p>` },
                { title: "Transformación con map", content: `<p>map transforma cada elemento y retorna un nuevo array.</p>` },
                { title: "Reducción con reduce", content: `<p>reduce combina elementos en un solo valor.</p>` },
                { title: "Métodos de Hash", content: `<p>each_key, each_value para iterar sobre claves o valores.</p>` },
                { title: "¡Listo para el Quiz!", content: "<p>Arrays y hashes organizan datos en Ruby. ¡Muestra que sabes usarlos!</p>"}
            ],
            quiz: [
                { question: "¿Cómo se crean arrays en Ruby?", options: ["{}", "[]", "()", "<>"], answer: "[]" },
                { question: "¿Desde qué índice empiezan los arrays?", options: ["1", "0", "-1", "Ninguno"], answer: "0" },
                { question: "¿Qué hace push()?", options: ["Añade al principio", "Añade al final", "Elimina del principio", "Elimina del final"], answer: "Añade al final" },
                { question: "¿Qué hace pop()?", options: ["Añade al principio", "Añade al final", "Elimina del principio", "Elimina del final"], answer: "Elimina del final" },
                { question: "¿Qué hace unshift()?", options: ["Añade al principio", "Añade al final", "Elimina del principio", "Elimina del final"], answer: "Añade al principio" },
                { question: "¿Qué hace shift()?", options: ["Añade al principio", "Añade al final", "Elimina del principio", "Elimina del final"], answer: "Elimina del principio" },
                { question: "¿Cómo se crean hashes?", options: ["[]", "{}", "()", "<>"], answer: "{}" },
                { question: "¿Qué son los símbolos?", options: ["Strings mutables", "Strings inmutables", "Números", "Booleans"], answer: "Strings inmutables" },
                { question: "¿Qué método itera sobre arrays?", options: ["each", "for", "while", "loop"], answer: "each" },
                { question: "¿Qué método filtra arrays?", options: ["map", "select", "reduce", "each"], answer: "select" },
                { question: "¿Qué método transforma arrays?", options: ["select", "map", "reduce", "each"], answer: "map" },
                { question: "¿Qué método combina elementos?", options: ["map", "select", "reduce", "each"], answer: "reduce" },
                { question: "¿Qué método verifica existencia?", options: ["find", "include?", "select", "each"], answer: "include?" }
            ]
        },
        { // Nivel 3
            title: "Clases y Objetos",
            lesson: [
                { title: "Definición de Clases", content: `<p>Las clases son plantillas para crear objetos.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">class Persona
  def initialize(nombre, edad)
    @nombre = nombre
    @edad = edad
  end
end</code></pre></div>` },
                { title: "Variables de Instancia", content: `<p>Comienzan con @ y son accesibles en todos los métodos.</p>` },
                { title: "Métodos de Instancia", content: `<p>Operan sobre instancias específicas.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">def saludar
  puts "Hola, soy #{@nombre}"
end</code></pre></div>` },
                { title: "Métodos de Clase", content: `<p>Se llaman sobre la clase misma.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">def self.contador
  @@contador ||= 0
  @@contador += 1
end</code></pre></div>` },
                { title: "Variables de Clase", content: `<p>Comienzan con @@ y son compartidas por todas las instancias.</p>` },
                { title: "Herencia", content: `<p>Las clases pueden heredar de otras usando <.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">class Estudiante < Persona
  def estudiar
    puts "#{@nombre} está estudiando"
  end
end</code></pre></div>` },
                { title: "Módulos como Mixins", content: `<p>Los módulos se incluyen en clases con include.</p>` },
                { title: "Métodos de Acceso", content: `<p>attr_reader, attr_writer, attr_accessor para propiedades.</p>` },
                { title: "Métodos Privados", content: `<p>Métodos que solo pueden ser llamados desde dentro de la clase.</p>` },
                { title: "¡Listo para el Quiz!", content: "<p>Las clases y objetos modelan el mundo real en Ruby. ¡Muestra que sabes POO!</p>"}
            ],
            quiz: [
                { question: "¿Cómo se definen clases?", options: ["class Nombre", "def class", "new class", "create class"], answer: "class Nombre" },
                { question: "¿Qué método inicializa objetos?", options: ["init", "initialize", "new", "create"], answer: "initialize" },
                { question: "¿Qué símbolo precede variables de instancia?", options: ["$", "@", "%", "&"], answer: "@" },
                { question: "¿Qué símbolo precede variables de clase?", options: ["$", "@@", "%", "&"], answer: "@@" },
                { question: "¿Qué palabra clave define métodos de clase?", options: ["self.", "class.", "@@", "static."], answer: "self." },
                { question: "¿Qué operador indica herencia?", options: ["extends", "<", "inherits", "parent"], answer: "<" },
                { question: "¿Qué incluye funcionalidad en clases?", options: ["import", "include", "extend", "require"], answer: "include" },
                { question: "¿Qué crea getters y setters?", options: ["attr_accessor", "property", "getter_setter", "access"], answer: "attr_accessor" },
                { question: "¿Qué hace private?", options: ["Oculta métodos", "Oculta clases", "Oculta variables", "Oculta archivos"], answer: "Oculta métodos" },
                { question: "¿Cuál es el pilar de la POO en Ruby?", options: ["Funcional", "Orientado a objetos", "Procedural", "Lógico"], answer: "Orientado a objetos" }
            ]
        },
        { // Nivel 4
            title: "Bloques, Procs y Lambdas",
            lesson: [
                { title: "Bloques de Código", content: `<p>Fragmentos de código que se pasan a métodos.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">5.times do |i|
  puts "Número: #{i}"
end</code></pre></div>` },
                { title: "Procs", content: `<p>Objetos que contienen bloques de código.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">mi_proc = Proc.new { |x| puts x * 2 }
mi_proc.call(5) # 10</code></pre></div>` },
                { title: "Lambdas", content: `<p>Similar a procs pero con comportamiento más estricto.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">mi_lambda = lambda { |x| puts x * 2 }
mi_lambda.call(5) # 10</code></pre></div>` },
                { title: "Closures", content: `<p>Bloques que capturan variables del scope donde se definen.</p>` },
                { title: "Métodos que Aceptan Bloques", content: `<p>Métodos como each, map, select usan bloques.</p>` },
                { title: "Yield", content: `<p>Llama al bloque pasado a un método.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">def repetir
  yield "Hola"
  yield "Mundo"
end
repetir { |palabra| puts palabra }</code></pre></div>` },
                { title: "Bloques con Parámetros", content: `<p>Bloques que reciben argumentos.</p>` },
                { title: "Return en Bloques", content: `<p>Comportamiento diferente en procs vs lambdas.</p>` },
                { title: "¡Listo para el Quiz!", content: "<p>Bloques, procs y lambdas hacen Ruby muy flexible. ¡Muestra que sabes usarlos!</p>"}
            ],
            quiz: [
                { question: "¿Qué son los bloques?", options: ["Errores de sintaxis", "Fragmentos de código", "Variables", "Objetos"], answer: "Fragmentos de código" },
                { question: "¿Qué crean Proc.new?", options: ["Objetos proc", "Objetos lambda", "Bloques", "Métodos"], answer: "Objetos proc" },
                { question: "¿Qué crean lambda?", options: ["Objetos proc", "Objetos lambda", "Bloques", "Métodos"], answer: "Objetos lambda" },
                { question: "¿Qué palabra clave llama bloques en métodos?", options: ["call", "yield", "execute", "run"], answer: "yield" },
                { question: "¿Qué capturan los closures?", options: ["Solo variables globales", "Variables del scope", "Solo parámetros", "Solo métodos"], answer: "Variables del scope" },
                { question: "¿Qué método itera con bloques?", options: ["for", "each", "while", "loop"], answer: "each" },
                { question: "¿Qué método transforma con bloques?", options: ["each", "map", "select", "reduce"], answer: "map" },
                { question: "¿Qué método filtra con bloques?", options: ["each", "map", "select", "reduce"], answer: "select" },
                { question: "¿Qué método reduce con bloques?", options: ["each", "map", "select", "reduce"], answer: "reduce" },
                { question: "¿Cuál es más estricto: proc o lambda?", options: ["proc", "lambda", "Iguales", "Depende"], answer: "lambda" }
            ]
        },
        { // Nivel 5
            title: "Control de Flujo",
            lesson: [
                { title: "Condicionales If", content: `<p>Ejecuta código si una condición es verdadera.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">if edad >= 18
  puts "Mayor de edad"
end</code></pre></div>` },
                { title: "Else y Elsif", content: `<p>Alternativas cuando la condición es falsa.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">if nota >= 90
  puts "Excelente"
elsif nota >= 70
  puts "Bueno"
else
  puts "Necesita mejorar"
end</code></pre></div>` },
                { title: "Operadores Lógicos", content: `<p>&& (AND), || (OR), ! (NOT), and, or, not.</p>` },
                { title: "Unless", content: `<p>Equivalente a if not.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">unless edad < 18
  puts "Mayor de edad"
end</code></pre></div>` },
                { title: "Operador Ternario", content: `<p>Sintaxis corta para condiciones simples.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">mensaje = edad >= 18 ? "Mayor" : "Menor"</code></pre></div>` },
                { title: "Case Statement", content: `<p>Alternativa a múltiples if-elsif.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">case dia
when "lunes"
  puts "Inicio de semana"
when "viernes"
  puts "Fin de semana"
else
  puts "Día normal"
end</code></pre></div>` },
                { title: "Truthy y Falsy", content: `<p>Valores que se consideran verdaderos o falsos.</p>` },
                { title: "While Loop", content: `<p>Ejecuta mientras una condición sea verdadera.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">contador = 0
while contador < 5
  puts contador
  contador += 1
end</code></pre></div>` },
                { title: "Until Loop", content: `<p>Ejecuta hasta que una condición sea verdadera.</p>` },
                { title: "¡Listo para el Quiz!", content: "<p>El control de flujo toma decisiones y repite acciones. ¡Muestra que sabes controlarlo!</p>"}
            ],
            quiz: [
                { question: "¿Qué estructura ejecuta si condición es verdadera?", options: ["if", "unless", "case", "while"], answer: "if" },
                { question: "¿Qué estructura ejecuta si condición es falsa?", options: ["if", "unless", "case", "while"], answer: "unless" },
                { question: "¿Qué operador lógico significa 'Y'?", options: ["||", "&&", "!", "and"], answer: "&&" },
                { question: "¿Qué operador lógico significa 'O'?", options: ["||", "&&", "!", "or"], answer: "||" },
                { question: "¿Qué estructura es alternativa a if-elsif?", options: ["unless", "case", "while", "until"], answer: "case" },
                { question: "¿Qué estructura repite mientras condición es verdadera?", options: ["if", "case", "while", "until"], answer: "while" },
                { question: "¿Qué estructura repite hasta que condición es verdadera?", options: ["while", "until", "for", "each"], answer: "until" },
                { question: "¿Qué valores son falsy en Ruby?", options: ["nil, false", "0, ''", "Solo nil", "Todos los valores"], answer: "nil, false" },
                { question: "¿Qué hace el operador ternario?", options: ["Condición larga", "Condición corta", "Bucle", "Función"], answer: "Condición corta" },
                { question: "¿Qué palabra clave termina case/when?", options: ["end", "break", "else", "default"], answer: "end" }
            ]
        },
        { // Nivel 6
            title: "Condicionales Avanzados",
            lesson: [
                { title: "Operador Ternario", content: `<p>El operador ternario es una forma compacta de escribir if/else.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">edad = 18\nestado = edad >= 18 ? "adulto" : "menor"</code></pre></div>` },
                { title: "Case/When", content: `<p>Case/when es como switch en otros lenguajes.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">case dia\nwhen "lunes"\n  puts "Inicio de semana"\nwhen "viernes"\n  puts "Casi fin de semana"\nelse\n  puts "Día normal"\nend</code></pre></div>` },
                { title: "Unless", content: `<p>Unless es lo opuesto a if.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">unless llueve\n  puts "Vamos al parque"\nend</code></pre></div>` },
                { title: "Modificadores de Condición", content: `<p>Puedes poner if/unless al final de la línea.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">puts "Hace calor" if temperatura > 30\nputs "No llueve" unless llueve</code></pre></div>` },
                { title: "Operadores Lógicos", content: `<p>&&, ||, ! para combinar condiciones.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">if edad >= 18 && tiene_licencia\n  puts "Puede conducir"\nend</code></pre></div>` },
                { title: "Rangos en Condiciones", content: `<p>Puedes usar rangos en case/when.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">case edad\nwhen 0..12\n  "niño"\nwhen 13..17\n  "adolescente"\nwhen 18..64\n  "adulto"\nelse\n  "senior"\nend</code></pre></div>` },
                { title: "Spaceship Operator", content: `<p>El operador <=> compara dos valores.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">5 <=> 3  # 1\n3 <=> 5  # -1\n5 <=> 5  # 0</code></pre></div>` },
                { title: "Safe Navigation", content: `<p>El operador &. evita errores con nil.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">usuario&.nombre  # nil si usuario es nil</code></pre></div>` },
                { title: "Valores por Defecto", content: `<p>Usa || para valores por defecto.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">nombre = usuario_nombre || "Anónimo"</code></pre></div>` },
                { title: "¡Listo para el Quiz!", content: "<p>Dominas las condicionales avanzadas en Ruby. ¡Demuéstralo!</p>"}
            ],
            quiz: [
                { question: "¿Qué hace el operador ternario?", options: ["If/else corto", "Bucle", "Función", "Array"], answer: "If/else corto" },
                { question: "¿Qué es case/when?", options: ["Switch", "Loop", "Función", "Clase"], answer: "Switch" },
                { question: "¿Qué hace unless?", options: ["Opuesto a if", "Igual a if", "Bucle", "Función"], answer: "Opuesto a if" },
                { question: "¿Dónde va el modificador if?", options: ["Al final", "Al inicio", "En medio", "Ninguno"], answer: "Al final" },
                { question: "¿Qué operador es AND?", options: ["&&", "||", "!", "=="], answer: "&&" },
                { question: "¿Qué operador es OR?", options: ["||", "&&", "!", "=="], answer: "||" },
                { question: "¿Qué hace <=>?", options: ["Compara", "Suma", "Resta", "Multiplica"], answer: "Compara" },
                { question: "¿Qué hace &.?", options: ["Safe navigation", "Suma", "Compara", "Asigna"], answer: "Safe navigation" },
                { question: "¿Qué hace ||?", options: ["Valor por defecto", "Suma", "Compara", "Multiplica"], answer: "Valor por defecto" },
                { question: "¿Qué retorna 5 <=> 3?", options: ["1", "-1", "0", "nil"], answer: "1" }
            ]
        },
        { // Nivel 7
            title: "Métodos y Bloques",
            lesson: [
                { title: "Definir Métodos", content: `<p>Los métodos encapsulan código reutilizable.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">def saludar(nombre)\n  "Hola, #{nombre}!"\nend\n\nputs saludar("Ana")</code></pre></div>` },
                { title: "Parámetros por Defecto", content: `<p>Puedes dar valores por defecto a parámetros.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">def saludar(nombre = "Mundo")\n  "Hola, #{nombre}!"\nend</code></pre></div>` },
                { title: "Return Implícito", content: `<p>Ruby retorna automáticamente la última expresión.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">def suma(a, b)\n  a + b  # return implícito\nend</code></pre></div>` },
                { title: "Bloques con yield", content: `<p>yield ejecuta el bloque pasado al método.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">def ejecutar\n  puts "Antes"\n  yield\n  puts "Después"\nend\n\nejecutar { puts "Durante" }</code></pre></div>` },
                { title: "Bloques con Parámetros", content: `<p>Los bloques pueden recibir parámetros.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">def repetir(n)\n  n.times { |i| yield i }\nend\n\nrepetir(3) { |i| puts i }</code></pre></div>` },
                { title: "Procs y Lambdas", content: `<p>Procs y lambdas son bloques guardados en variables.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">mi_proc = Proc.new { |x| x * 2 }\nmi_lambda = ->(x) { x * 2 }\n\nputs mi_proc.call(5)  # 10</code></pre></div>` },
                { title: "Diferencias Proc vs Lambda", content: `<p>Lambdas verifican argumentos, procs no.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">l = ->(x) { x * 2 }\nl.call(5, 3)  # Error!\n\np = Proc.new { |x| x * 2 }\np.call(5, 3)  # OK, ignora 3</code></pre></div>` },
                { title: "Métodos con Splat", content: `<p>El operador * acepta múltiples argumentos.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">def suma(*numeros)\n  numeros.sum\nend\n\nputs suma(1, 2, 3, 4)  # 10</code></pre></div>` },
                { title: "Keyword Arguments", content: `<p>Argumentos con nombre para mayor claridad.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">def crear_usuario(nombre:, edad:, email: nil)\n  {nombre: nombre, edad: edad, email: email}\nend</code></pre></div>` },
                { title: "¡Listo para el Quiz!", content: "<p>Dominas métodos y bloques en Ruby. ¡Demuéstralo!</p>"}
            ],
            quiz: [
                { question: "¿Cómo se define un método?", options: ["def", "function", "method", "func"], answer: "def" },
                { question: "¿Qué hace yield?", options: ["Ejecuta bloque", "Retorna", "Suma", "Compara"], answer: "Ejecuta bloque" },
                { question: "¿Ruby retorna qué por defecto?", options: ["Última expresión", "nil", "0", "false"], answer: "Última expresión" },
                { question: "¿Qué es un Proc?", options: ["Bloque guardado", "Función", "Clase", "Variable"], answer: "Bloque guardado" },
                { question: "¿Qué es un Lambda?", options: ["Bloque guardado", "Función", "Clase", "Variable"], answer: "Bloque guardado" },
                { question: "¿Diferencia Proc vs Lambda?", options: ["Verificación args", "Velocidad", "Memoria", "Sintaxis"], answer: "Verificación args" },
                { question: "¿Qué hace *args?", options: ["Múltiples args", "Suma", "Multiplica", "Divide"], answer: "Múltiples args" },
                { question: "¿Qué son keyword arguments?", options: ["Args con nombre", "Args múltiples", "Args opcionales", "Args por defecto"], answer: "Args con nombre" },
                { question: "¿Cómo se llama un Proc?", options: [".call", ".run", ".execute", ".do"], answer: ".call" },
                { question: "¿Qué palabra termina un método?", options: ["end", "}", "return", "done"], answer: "end" }
            ]
        },
        { // Nivel 8
            title: "Módulos y Mixins",
            lesson: [
                { title: "¿Qué son los Módulos?", content: `<p>Los módulos agrupan métodos y constantes.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">module Saludable\n  def saludar\n    "Hola!"\n  end\nend</code></pre></div>` },
                { title: "Include vs Extend", content: `<p>Include añade métodos de instancia, extend de clase.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">class Persona\n  include Saludable\nend\n\np = Persona.new\np.saludar  # "Hola!"</code></pre></div>` },
                { title: "Namespaces", content: `<p>Los módulos crean espacios de nombres.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">module MiApp\n  class Usuario\n  end\nend\n\nu = MiApp::Usuario.new</code></pre></div>` },
                { title: "Mixins", content: `<p>Los mixins permiten herencia múltiple.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">module Volador\n  def volar\n    "Volando!"\n  end\nend\n\nclass Pajaro\n  include Volador\nend</code></pre></div>` },
                { title: "Prepend", content: `<p>Prepend inserta el módulo antes en la cadena.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">class Persona\n  prepend Saludable\nend</code></pre></div>` },
                { title: "Module Functions", content: `<p>Métodos de módulo se llaman directamente.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">module Math\n  def self.suma(a, b)\n    a + b\n  end\nend\n\nMath.suma(5, 3)</code></pre></div>` },
                { title: "Constantes en Módulos", content: `<p>Los módulos pueden tener constantes.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">module Config\n  VERSION = "1.0.0"\nend\n\nputs Config::VERSION</code></pre></div>` },
                { title: "Comparable Mixin", content: `<p>Comparable añade operadores de comparación.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">class Persona\n  include Comparable\n  attr_reader :edad\n  \n  def <=>(otra)\n    edad <=> otra.edad\n  end\nend</code></pre></div>` },
                { title: "Enumerable Mixin", content: `<p>Enumerable añade métodos de iteración.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">class MiColeccion\n  include Enumerable\n  \n  def each\n    yield 1\n    yield 2\n    yield 3\n  end\nend</code></pre></div>` },
                { title: "¡Listo para el Quiz!", content: "<p>Dominas módulos y mixins en Ruby. ¡Demuéstralo!</p>"}
            ],
            quiz: [
                { question: "¿Qué son los módulos?", options: ["Agrupan código", "Clases", "Variables", "Funciones"], answer: "Agrupan código" },
                { question: "¿Qué hace include?", options: ["Métodos de instancia", "Métodos de clase", "Variables", "Constantes"], answer: "Métodos de instancia" },
                { question: "¿Qué hace extend?", options: ["Métodos de clase", "Métodos de instancia", "Variables", "Constantes"], answer: "Métodos de clase" },
                { question: "¿Qué hace prepend?", options: ["Inserta antes", "Inserta después", "Elimina", "Modifica"], answer: "Inserta antes" },
                { question: "¿Qué son los mixins?", options: ["Herencia múltiple", "Herencia simple", "Variables", "Funciones"], answer: "Herencia múltiple" },
                { question: "¿Cómo acceder a constante de módulo?", options: ["::", ".", "->", "#"], answer: "::" },
                { question: "¿Qué añade Comparable?", options: ["Comparaciones", "Iteraciones", "Variables", "Funciones"], answer: "Comparaciones" },
                { question: "¿Qué añade Enumerable?", options: ["Iteraciones", "Comparaciones", "Variables", "Funciones"], answer: "Iteraciones" },
                { question: "¿Cómo definir método de módulo?", options: ["self.metodo", "def metodo", "module.metodo", "class.metodo"], answer: "self.metodo" },
                { question: "¿Los módulos pueden tener?", options: ["Constantes", "Solo métodos", "Solo variables", "Nada"], answer: "Constantes" }
            ]
        },
        { // Nivel 9
            title: "Manejo de Excepciones",
            lesson: [
                { title: "Begin/Rescue", content: `<p>Begin/rescue captura errores.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">begin\n  10 / 0\nrescue ZeroDivisionError\n  puts "No se puede dividir por cero"\nend</code></pre></div>` },
                { title: "Rescue Específico", content: `<p>Puedes capturar tipos específicos de errores.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">begin\n  # código\nrescue ArgumentError\n  puts "Argumento inválido"\nrescue TypeError\n  puts "Tipo incorrecto"\nend</code></pre></div>` },
                { title: "Rescue con Variable", content: `<p>Guarda el error en una variable.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">begin\n  # código\nrescue => e\n  puts "Error: #{e.message}"\nend</code></pre></div>` },
                { title: "Ensure", content: `<p>Ensure siempre se ejecuta.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">begin\n  archivo = File.open("datos.txt")\nrescue\n  puts "Error al abrir"\nensure\n  archivo.close if archivo\nend</code></pre></div>` },
                { title: "Else en Rescue", content: `<p>Else se ejecuta si no hay error.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">begin\n  resultado = 10 / 2\nrescue\n  puts "Error"\nelse\n  puts "Éxito: #{resultado}"\nend</code></pre></div>` },
                { title: "Raise", content: `<p>Raise lanza una excepción.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">def validar_edad(edad)\n  raise "Edad inválida" if edad < 0\nend</code></pre></div>` },
                { title: "Excepciones Personalizadas", content: `<p>Crea tus propias excepciones.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">class MiError < StandardError\nend\n\nraise MiError, "Algo salió mal"</code></pre></div>` },
                { title: "Retry", content: `<p>Retry reintenta el bloque begin.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">intentos = 0\nbegin\n  intentos += 1\n  # código que puede fallar\nrescue\n  retry if intentos < 3\nend</code></pre></div>` },
                { title: "Rescue en Línea", content: `<p>Rescue puede ir en una sola línea.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">resultado = 10 / 0 rescue "Error"</code></pre></div>` },
                { title: "¡Listo para el Quiz!", content: "<p>Dominas el manejo de excepciones en Ruby. ¡Demuéstralo!</p>"}
            ],
            quiz: [
                { question: "¿Qué captura errores?", options: ["rescue", "catch", "try", "error"], answer: "rescue" },
                { question: "¿Qué siempre se ejecuta?", options: ["ensure", "finally", "always", "end"], answer: "ensure" },
                { question: "¿Qué lanza excepciones?", options: ["raise", "throw", "error", "exception"], answer: "raise" },
                { question: "¿Qué hace retry?", options: ["Reintenta", "Cancela", "Ignora", "Termina"], answer: "Reintenta" },
                { question: "¿Qué ejecuta si no hay error?", options: ["else", "then", "success", "ok"], answer: "else" },
                { question: "¿Cómo guardar error en variable?", options: ["=> e", "-> e", "= e", ": e"], answer: "=> e" },
                { question: "¿Cómo crear excepción personalizada?", options: ["< StandardError", "extends Error", "implements Error", "new Error"], answer: "< StandardError" },
                { question: "¿Rescue puede ir en línea?", options: ["Sí", "No", "Solo con begin", "Solo con ensure"], answer: "Sí" },
                { question: "¿Qué error es división por cero?", options: ["ZeroDivisionError", "DivisionError", "MathError", "ArithmeticError"], answer: "ZeroDivisionError" },
                { question: "¿Begin necesita rescue?", options: ["Sí", "No", "Solo con ensure", "Solo con else"], answer: "Sí" }
            ]
        },
        { // Nivel 10
            title: "File I/O y Persistencia",
            lesson: [
                { title: "Leer Archivos", content: `<p>File.read lee todo el archivo.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">contenido = File.read("datos.txt")\nputs contenido</code></pre></div>` },
                { title: "Escribir Archivos", content: `<p>File.write escribe en un archivo.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">File.write("datos.txt", "Hola Mundo")</code></pre></div>` },
                { title: "File.open con Bloque", content: `<p>File.open con bloque cierra automáticamente.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">File.open("datos.txt", "r") do |file|\n  puts file.read\nend</code></pre></div>` },
                { title: "Modos de Apertura", content: `<p>r (read), w (write), a (append).</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">File.open("log.txt", "a") do |f|\n  f.puts "Nueva línea"\nend</code></pre></div>` },
                { title: "Leer Línea por Línea", content: `<p>each_line itera sobre líneas.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">File.open("datos.txt").each_line do |linea|\n  puts linea\nend</code></pre></div>` },
                { title: "File.exist?", content: `<p>Verifica si un archivo existe.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">if File.exist?("datos.txt")\n  puts "El archivo existe"\nend</code></pre></div>` },
                { title: "Dir para Directorios", content: `<p>Dir maneja directorios.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">Dir.mkdir("nueva_carpeta")\nDir.entries(".").each { |f| puts f }</code></pre></div>` },
                { title: "JSON en Ruby", content: `<p>Usa JSON para guardar datos estructurados.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">require 'json'\n\ndatos = {nombre: "Ana", edad: 25}\nFile.write("datos.json", datos.to_json)</code></pre></div>` },
                { title: "YAML en Ruby", content: `<p>YAML es más legible que JSON.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">require 'yaml'\n\ndatos = {nombre: "Ana", edad: 25}\nFile.write("datos.yml", datos.to_yaml)</code></pre></div>` },
                { title: "¡Listo para el Quiz!", content: "<p>Dominas File I/O en Ruby. ¡Demuéstralo!</p>"}
            ],
            quiz: [
                { question: "¿Qué lee todo un archivo?", options: ["File.read", "File.open", "File.get", "File.load"], answer: "File.read" },
                { question: "¿Qué escribe en un archivo?", options: ["File.write", "File.save", "File.put", "File.store"], answer: "File.write" },
                { question: "¿Qué modo es solo lectura?", options: ["r", "w", "a", "x"], answer: "r" },
                { question: "¿Qué modo es solo escritura?", options: ["w", "r", "a", "x"], answer: "w" },
                { question: "¿Qué modo es append?", options: ["a", "r", "w", "x"], answer: "a" },
                { question: "¿Qué verifica existencia?", options: ["File.exist?", "File.exists?", "File.check", "File.has"], answer: "File.exist?" },
                { question: "¿Qué itera líneas?", options: ["each_line", "each", "map", "select"], answer: "each_line" },
                { question: "¿Qué maneja directorios?", options: ["Dir", "Directory", "Folder", "Path"], answer: "Dir" },
                { question: "¿Qué formato es más legible?", options: ["YAML", "JSON", "XML", "CSV"], answer: "YAML" },
                { question: "¿Cómo convertir a JSON?", options: ["to_json", "as_json", "json", "to_s"], answer: "to_json" }
            ]
        },
        { // Nivel 11
            title: "Regular Expressions (Regex)",
            lesson: [
                { title: "¿Qué son las Regex?", content: `<p>Las expresiones regulares buscan patrones en texto.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">email = "usuario@ejemplo.com"\nemail.match?(/\\w+@\\w+\\.\\w+/)  # true</code></pre></div>` },
                { title: "Sintaxis Básica", content: `<p>/ / delimita una regex, \\d es dígito, \\w es palabra.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">"123".match?(/\\d+/)  # true\n"abc".match?(/\\w+/)  # true</code></pre></div>` },
                { title: "Métodos match y scan", content: `<p>match encuentra la primera coincidencia, scan todas.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">"abc 123".scan(/\\d+/)  # ["123"]</code></pre></div>` },
                { title: "Grupos de Captura", content: `<p>Los paréntesis capturan partes del patrón.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">match = "2024-12-10".match(/(\\d{4})-(\\d{2})-(\\d{2})/)\nmatch[1]  # "2024"</code></pre></div>` },
                { title: "Sustitución con sub y gsub", content: `<p>sub reemplaza la primera, gsub todas.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">"hola mundo".gsub(/o/, "0")  # "h0la mund0"</code></pre></div>` },
                { title: "Anclas ^ y $", content: `<p>^ inicio de línea, $ fin de línea.</p>` },
                { title: "Cuantificadores", content: `<p>+ uno o más, * cero o más, ? cero o uno.</p>` },
                { title: "Clases de Caracteres", content: `<p>[abc] cualquiera de a, b, c. [^abc] ninguno de ellos.</p>` },
                { title: "Modificadores", content: `<p>/i ignora mayúsculas, /m multilínea.</p>` },
                { title: "¡Listo para el Quiz!", content: "<p>Dominas Regex en Ruby. ¡Demuéstralo!</p>"}
            ],
            quiz: [
                { question: "¿Qué delimita una regex?", options: ["/ /", "\" \"", "' '", "( )"], answer: "/ /" },
                { question: "¿Qué es \\d?", options: ["Dígito", "Palabra", "Espacio", "Letra"], answer: "Dígito" },
                { question: "¿Qué es \\w?", options: ["Palabra", "Dígito", "Espacio", "Punto"], answer: "Palabra" },
                { question: "¿Qué hace match?", options: ["Primera coincidencia", "Todas", "Ninguna", "Última"], answer: "Primera coincidencia" },
                { question: "¿Qué hace scan?", options: ["Todas coincidencias", "Primera", "Ninguna", "Última"], answer: "Todas coincidencias" },
                { question: "¿Qué hace gsub?", options: ["Reemplaza todas", "Reemplaza primera", "Busca", "Elimina"], answer: "Reemplaza todas" },
                { question: "¿Qué hace sub?", options: ["Reemplaza primera", "Reemplaza todas", "Busca", "Elimina"], answer: "Reemplaza primera" },
                { question: "¿Qué es ^?", options: ["Inicio línea", "Fin línea", "Cualquier", "Ninguno"], answer: "Inicio línea" },
                { question: "¿Qué es $?", options: ["Fin línea", "Inicio línea", "Cualquier", "Ninguno"], answer: "Fin línea" },
                { question: "¿Qué hace +?", options: ["Uno o más", "Cero o más", "Cero o uno", "Exactamente uno"], answer: "Uno o más" }
            ]
        },
        { // Nivel 12
            title: "Metaprogramming Básico",
            lesson: [
                { title: "¿Qué es Metaprogramming?", content: `<p>Código que escribe código en tiempo de ejecución.</p>` },
                { title: "define_method", content: `<p>Define métodos dinámicamente.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">class Persona\n  define_method(:saludar) do\n    "Hola!"\n  end\nend</code></pre></div>` },
                { title: "method_missing", content: `<p>Captura llamadas a métodos inexistentes.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">def method_missing(name, *args)\n  "Método #{name} no existe"\nend</code></pre></div>` },
                { title: "send", content: `<p>Llama métodos dinámicamente.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">objeto.send(:metodo, arg1, arg2)</code></pre></div>` },
                { title: "attr_accessor", content: `<p>Crea getters y setters automáticamente.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">class Persona\n  attr_accessor :nombre, :edad\nend</code></pre></div>` },
                { title: "class_eval", content: `<p>Evalúa código en contexto de clase.</p>` },
                { title: "instance_eval", content: `<p>Evalúa código en contexto de instancia.</p>` },
                { title: "const_get", content: `<p>Obtiene constantes dinámicamente.</p>` },
                { title: "respond_to?", content: `<p>Verifica si un objeto responde a un método.</p>` },
                { title: "¡Listo para el Quiz!", content: "<p>Dominas Metaprogramming en Ruby. ¡Demuéstralo!</p>"}
            ],
            quiz: [
                { question: "¿Qué es metaprogramming?", options: ["Código que escribe código", "Código rápido", "Código seguro", "Código simple"], answer: "Código que escribe código" },
                { question: "¿Qué hace define_method?", options: ["Define métodos", "Llama métodos", "Elimina métodos", "Busca métodos"], answer: "Define métodos" },
                { question: "¿Qué hace method_missing?", options: ["Captura métodos inexistentes", "Define métodos", "Llama métodos", "Elimina métodos"], answer: "Captura métodos inexistentes" },
                { question: "¿Qué hace send?", options: ["Llama métodos dinámicamente", "Define métodos", "Elimina métodos", "Busca métodos"], answer: "Llama métodos dinámicamente" },
                { question: "¿Qué hace attr_accessor?", options: ["Getters y setters", "Solo getters", "Solo setters", "Ninguno"], answer: "Getters y setters" },
                { question: "¿Qué hace attr_reader?", options: ["Solo getters", "Getters y setters", "Solo setters", "Ninguno"], answer: "Solo getters" },
                { question: "¿Qué hace attr_writer?", options: ["Solo setters", "Getters y setters", "Solo getters", "Ninguno"], answer: "Solo setters" },
                { question: "¿Qué hace respond_to?", options: ["Verifica método", "Llama método", "Define método", "Elimina método"], answer: "Verifica método" },
                { question: "¿Qué hace class_eval?", options: ["Evalúa en clase", "Evalúa en instancia", "Evalúa en módulo", "Ninguno"], answer: "Evalúa en clase" },
                { question: "¿Qué hace instance_eval?", options: ["Evalúa en instancia", "Evalúa en clase", "Evalúa en módulo", "Ninguno"], answer: "Evalúa en instancia" }
            ]
        },
        { // Nivel 13
            title: "Gems y Bundler",
            lesson: [
                { title: "¿Qué son las Gems?", content: `<p>Librerías reutilizables de Ruby.</p>` },
                { title: "Instalar Gems", content: `<p>gem install nombre_gem instala una gem.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-bash">gem install rails</code></pre></div>` },
                { title: "Require", content: `<p>require carga una gem en tu código.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">require 'json'\nrequire 'httparty'</code></pre></div>` },
                { title: "Bundler", content: `<p>Bundler maneja dependencias de gems.</p>` },
                { title: "Gemfile", content: `<p>Gemfile lista las gems del proyecto.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">source 'https://rubygems.org'\ngem 'rails', '~> 7.0'\ngem 'pg'</code></pre></div>` },
                { title: "bundle install", content: `<p>Instala todas las gems del Gemfile.</p>` },
                { title: "Gemfile.lock", content: `<p>Guarda versiones exactas de gems instaladas.</p>` },
                { title: "Gems Populares", content: `<p>Rails, Sinatra, RSpec, Puma, Devise.</p>` },
                { title: "Crear tu Propia Gem", content: `<p>bundle gem nombre crea estructura de gem.</p>` },
                { title: "¡Listo para el Quiz!", content: "<p>Dominas Gems y Bundler. ¡Demuéstralo!</p>"}
            ],
            quiz: [
                { question: "¿Qué son las gems?", options: ["Librerías Ruby", "Archivos", "Variables", "Funciones"], answer: "Librerías Ruby" },
                { question: "¿Cómo instalar una gem?", options: ["gem install", "gem add", "gem get", "gem load"], answer: "gem install" },
                { question: "¿Qué hace require?", options: ["Carga gem", "Instala gem", "Elimina gem", "Busca gem"], answer: "Carga gem" },
                { question: "¿Qué es Bundler?", options: ["Gestor dependencias", "Editor", "Servidor", "Base datos"], answer: "Gestor dependencias" },
                { question: "¿Qué es Gemfile?", options: ["Lista de gems", "Código Ruby", "Configuración", "Base datos"], answer: "Lista de gems" },
                { question: "¿Qué hace bundle install?", options: ["Instala gems", "Elimina gems", "Busca gems", "Actualiza gems"], answer: "Instala gems" },
                { question: "¿Qué es Gemfile.lock?", options: ["Versiones exactas", "Lista gems", "Configuración", "Código"], answer: "Versiones exactas" },
                { question: "¿Qué gem es framework web?", options: ["Rails", "RSpec", "Puma", "Devise"], answer: "Rails" },
                { question: "¿Qué gem es para testing?", options: ["RSpec", "Rails", "Puma", "Sinatra"], answer: "RSpec" },
                { question: "¿Cómo crear una gem?", options: ["bundle gem", "gem create", "gem new", "gem make"], answer: "bundle gem" }
            ]
        },
        { // Nivel 14
            title: "Testing con RSpec",
            lesson: [
                { title: "¿Por qué Testing?", content: `<p>Los tests aseguran que el código funciona correctamente.</p>` },
                { title: "Instalar RSpec", content: `<p>Agrega gem 'rspec' al Gemfile.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-bash">gem install rspec\nrspec --init</code></pre></div>` },
                { title: "Estructura de Tests", content: `<p>describe agrupa tests, it define un test.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">describe Calculadora do\n  it "suma dos números" do\n    expect(2 + 2).to eq(4)\n  end\nend</code></pre></div>` },
                { title: "Matchers", content: `<p>eq, be, include, be_nil son matchers.</p>` },
                { title: "before y after", content: `<p>before ejecuta código antes de cada test.</p>` },
                { title: "let", content: `<p>let define variables lazy para tests.</p>` },
                { title: "Mocks y Stubs", content: `<p>Simulan objetos para testing.</p>` },
                { title: "TDD", content: `<p>Test-Driven Development: escribe tests primero.</p>` },
                { title: "Coverage", content: `<p>Mide qué porcentaje del código está testeado.</p>` },
                { title: "¡Listo para el Quiz!", content: "<p>Dominas Testing con RSpec. ¡Demuéstralo!</p>"}
            ],
            quiz: [
                { question: "¿Por qué hacer tests?", options: ["Asegurar funcionamiento", "Velocidad", "Diseño", "Ninguno"], answer: "Asegurar funcionamiento" },
                { question: "¿Qué es RSpec?", options: ["Framework testing", "Framework web", "Base datos", "Editor"], answer: "Framework testing" },
                { question: "¿Qué hace describe?", options: ["Agrupa tests", "Define test", "Ejecuta test", "Elimina test"], answer: "Agrupa tests" },
                { question: "¿Qué hace it?", options: ["Define test", "Agrupa tests", "Ejecuta test", "Elimina test"], answer: "Define test" },
                { question: "¿Qué hace expect?", options: ["Verifica resultado", "Define test", "Agrupa tests", "Ejecuta test"], answer: "Verifica resultado" },
                { question: "¿Qué es un matcher?", options: ["Comparador", "Variable", "Función", "Clase"], answer: "Comparador" },
                { question: "¿Qué hace before?", options: ["Ejecuta antes", "Ejecuta después", "Define test", "Agrupa tests"], answer: "Ejecuta antes" },
                { question: "¿Qué hace let?", options: ["Define variable lazy", "Define test", "Agrupa tests", "Ejecuta test"], answer: "Define variable lazy" },
                { question: "¿Qué es TDD?", options: ["Test-Driven Development", "Test Data Design", "Total Development", "Ninguno"], answer: "Test-Driven Development" },
                { question: "¿Qué es coverage?", options: ["Porcentaje testeado", "Velocidad", "Diseño", "Ninguno"], answer: "Porcentaje testeado" }
            ]
        },
        { // Nivel 15
            title: "Ruby on Rails Básico",
            lesson: [
                { title: "¿Qué es Rails?", content: `<p>Framework web MVC para Ruby.</p>` },
                { title: "Instalar Rails", content: `<p>gem install rails crea proyectos web.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-bash">gem install rails\nrails new mi_app</code></pre></div>` },
                { title: "MVC", content: `<p>Model (datos), View (UI), Controller (lógica).</p>` },
                { title: "Generar Scaffold", content: `<p>rails g scaffold crea CRUD completo.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-bash">rails g scaffold Post title:string body:text</code></pre></div>` },
                { title: "Migraciones", content: `<p>rails db:migrate actualiza la base de datos.</p>` },
                { title: "Routes", content: `<p>config/routes.rb define URLs.</p>` },
                { title: "Controllers", content: `<p>app/controllers maneja requests.</p>` },
                { title: "Views", content: `<p>app/views muestra HTML con ERB.</p>` },
                { title: "Models", content: `<p>app/models interactúa con base de datos.</p>` },
                { title: "¡Listo para el Quiz!", content: "<p>Dominas Rails Básico. ¡Demuéstralo!</p>"}
            ],
            quiz: [
                { question: "¿Qué es Rails?", options: ["Framework web", "Base datos", "Editor", "Lenguaje"], answer: "Framework web" },
                { question: "¿Qué es MVC?", options: ["Model-View-Controller", "Model-Value-Code", "Main-View-Code", "Ninguno"], answer: "Model-View-Controller" },
                { question: "¿Qué hace rails new?", options: ["Crea proyecto", "Elimina proyecto", "Ejecuta proyecto", "Ninguno"], answer: "Crea proyecto" },
                { question: "¿Qué hace scaffold?", options: ["CRUD completo", "Solo modelo", "Solo vista", "Solo controller"], answer: "CRUD completo" },
                { question: "¿Qué hace db:migrate?", options: ["Actualiza BD", "Crea BD", "Elimina BD", "Ninguno"], answer: "Actualiza BD" },
                { question: "¿Dónde están las rutas?", options: ["config/routes.rb", "app/routes.rb", "config/urls.rb", "app/urls.rb"], answer: "config/routes.rb" },
                { question: "¿Dónde están controllers?", options: ["app/controllers", "config/controllers", "lib/controllers", "Ninguno"], answer: "app/controllers" },
                { question: "¿Dónde están views?", options: ["app/views", "config/views", "lib/views", "Ninguno"], answer: "app/views" },
                { question: "¿Dónde están models?", options: ["app/models", "config/models", "lib/models", "Ninguno"], answer: "app/models" },
                { question: "¿Qué es ERB?", options: ["Embedded Ruby", "Extended Ruby", "Extra Ruby", "Ninguno"], answer: "Embedded Ruby" }
            ]
        },
        { // Nivel 16
            title: "ActiveRecord y Bases de Datos",
            lesson: [
                { title: "¿Qué es ActiveRecord?", content: `<p>ORM que mapea tablas a clases Ruby.</p>` },
                { title: "Crear Modelos", content: `<p>rails g model crea modelo y migración.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-bash">rails g model User name:string email:string</code></pre></div>` },
                { title: "CRUD con ActiveRecord", content: `<p>Create, Read, Update, Delete.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">User.create(name: "Ana")\nUser.find(1)\nuser.update(name: "María")\nuser.destroy</code></pre></div>` },
                { title: "Validaciones", content: `<p>validates asegura datos correctos.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">validates :email, presence: true, uniqueness: true</code></pre></div>` },
                { title: "Asociaciones", content: `<p>has_many, belongs_to relacionan modelos.</p>` },
                { title: "Queries", content: `<p>where, find_by, order consultan datos.</p>` },
                { title: "Callbacks", content: `<p>before_save, after_create ejecutan código automáticamente.</p>` },
                { title: "Scopes", content: `<p>Queries reutilizables.</p>` },
                { title: "Migraciones Avanzadas", content: `<p>add_column, remove_column modifican tablas.</p>` },
                { title: "¡Listo para el Quiz!", content: "<p>Dominas ActiveRecord. ¡Demuéstralo!</p>"}
            ],
            quiz: [
                { question: "¿Qué es ActiveRecord?", options: ["ORM", "Framework", "Base datos", "Editor"], answer: "ORM" },
                { question: "¿Qué hace create?", options: ["Crea registro", "Lee registro", "Actualiza registro", "Elimina registro"], answer: "Crea registro" },
                { question: "¿Qué hace find?", options: ["Lee registro", "Crea registro", "Actualiza registro", "Elimina registro"], answer: "Lee registro" },
                { question: "¿Qué hace update?", options: ["Actualiza registro", "Crea registro", "Lee registro", "Elimina registro"], answer: "Actualiza registro" },
                { question: "¿Qué hace destroy?", options: ["Elimina registro", "Crea registro", "Lee registro", "Actualiza registro"], answer: "Elimina registro" },
                { question: "¿Qué hace validates?", options: ["Valida datos", "Crea datos", "Lee datos", "Elimina datos"], answer: "Valida datos" },
                { question: "¿Qué hace has_many?", options: ["Asociación uno a muchos", "Asociación uno a uno", "Validación", "Query"], answer: "Asociación uno a muchos" },
                { question: "¿Qué hace belongs_to?", options: ["Asociación inversa", "Asociación directa", "Validación", "Query"], answer: "Asociación inversa" },
                { question: "¿Qué hace where?", options: ["Filtra registros", "Crea registros", "Elimina registros", "Actualiza registros"], answer: "Filtra registros" },
                { question: "¿Qué es un callback?", options: ["Código automático", "Validación", "Query", "Asociación"], answer: "Código automático" }
            ]
        },
        { // Nivel 17
            title: "Routes y Controllers Avanzados",
            lesson: [
                { title: "RESTful Routes", content: `<p>resources genera rutas REST automáticamente.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">resources :posts</code></pre></div>` },
                { title: "Rutas Personalizadas", content: `<p>get, post, put, delete definen rutas custom.</p>` },
                { title: "Parámetros en Rutas", content: `<p>:id captura parámetros dinámicos.</p>` },
                { title: "Strong Parameters", content: `<p>params.require().permit() protege contra mass assignment.</p>` },
                { title: "Filters", content: `<p>before_action ejecuta código antes de acciones.</p>` },
                { title: "Render y Redirect", content: `<p>render muestra vista, redirect redirige.</p>` },
                { title: "Flash Messages", content: `<p>flash[:notice] muestra mensajes temporales.</p>` },
                { title: "Respond To", content: `<p>respond_to maneja formatos (HTML, JSON).</p>` },
                { title: "Namespaces", content: `<p>namespace agrupa rutas.</p>` },
                { title: "¡Listo para el Quiz!", content: "<p>Dominas Routes y Controllers. ¡Demuéstralo!</p>"}
            ],
            quiz: [
                { question: "¿Qué hace resources?", options: ["Rutas REST", "Rutas custom", "Validaciones", "Queries"], answer: "Rutas REST" },
                { question: "¿Qué hace get?", options: ["Ruta GET", "Ruta POST", "Ruta PUT", "Ruta DELETE"], answer: "Ruta GET" },
                { question: "¿Qué hace post?", options: ["Ruta POST", "Ruta GET", "Ruta PUT", "Ruta DELETE"], answer: "Ruta POST" },
                { question: "¿Qué son strong parameters?", options: ["Protección", "Validación", "Query", "Asociación"], answer: "Protección" },
                { question: "¿Qué hace before_action?", options: ["Ejecuta antes", "Ejecuta después", "Valida", "Filtra"], answer: "Ejecuta antes" },
                { question: "¿Qué hace render?", options: ["Muestra vista", "Redirige", "Valida", "Filtra"], answer: "Muestra vista" },
                { question: "¿Qué hace redirect_to?", options: ["Redirige", "Muestra vista", "Valida", "Filtra"], answer: "Redirige" },
                { question: "¿Qué es flash?", options: ["Mensajes temporales", "Validación", "Query", "Asociación"], answer: "Mensajes temporales" },
                { question: "¿Qué hace respond_to?", options: ["Maneja formatos", "Valida", "Filtra", "Redirige"], answer: "Maneja formatos" },
                { question: "¿Qué hace namespace?", options: ["Agrupa rutas", "Crea rutas", "Elimina rutas", "Valida rutas"], answer: "Agrupa rutas" }
            ]
        },
        { // Nivel 18
            title: "Views y Helpers",
            lesson: [
                { title: "ERB Templates", content: `<p><%= %> imprime, <% %> ejecuta código.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-erb"><h1><%= @post.title %></h1>\n<% @posts.each do |post| %>\n  <p><%= post.body %></p>\n<% end %></code></pre></div>` },
                { title: "Partials", content: `<p>render 'partial' reutiliza vistas.</p>` },
                { title: "Layouts", content: `<p>app/views/layouts/application.html.erb es el layout principal.</p>` },
                { title: "Form Helpers", content: `<p>form_with crea formularios.</p>` },
                { title: "Link Helpers", content: `<p>link_to crea enlaces.</p>` },
                { title: "Asset Pipeline", content: `<p>Maneja CSS, JS, imágenes.</p>` },
                { title: "Custom Helpers", content: `<p>app/helpers define helpers personalizados.</p>` },
                { title: "Turbo y Hotwire", content: `<p>Actualiza páginas sin JavaScript.</p>` },
                { title: "I18n", content: `<p>Internacionalización para múltiples idiomas.</p>` },
                { title: "¡Listo para el Quiz!", content: "<p>Dominas Views y Helpers. ¡Demuéstralo!</p>"}
            ],
            quiz: [
                { question: "¿Qué hace <%= %>?", options: ["Imprime", "Ejecuta", "Comenta", "Ninguno"], answer: "Imprime" },
                { question: "¿Qué hace <% %>?", options: ["Ejecuta", "Imprime", "Comenta", "Ninguno"], answer: "Ejecuta" },
                { question: "¿Qué son partials?", options: ["Vistas reutilizables", "Modelos", "Controllers", "Routes"], answer: "Vistas reutilizables" },
                { question: "¿Qué es un layout?", options: ["Plantilla principal", "Partial", "Helper", "Model"], answer: "Plantilla principal" },
                { question: "¿Qué hace form_with?", options: ["Crea formularios", "Crea enlaces", "Crea imágenes", "Ninguno"], answer: "Crea formularios" },
                { question: "¿Qué hace link_to?", options: ["Crea enlaces", "Crea formularios", "Crea imágenes", "Ninguno"], answer: "Crea enlaces" },
                { question: "¿Qué maneja Asset Pipeline?", options: ["CSS, JS, imágenes", "Solo CSS", "Solo JS", "Solo imágenes"], answer: "CSS, JS, imágenes" },
                { question: "¿Dónde están los helpers?", options: ["app/helpers", "app/views", "app/models", "app/controllers"], answer: "app/helpers" },
                { question: "¿Qué es Turbo?", options: ["Actualiza sin JS", "Framework", "Base datos", "Editor"], answer: "Actualiza sin JS" },
                { question: "¿Qué es I18n?", options: ["Internacionalización", "Validación", "Query", "Asociación"], answer: "Internacionalización" }
            ]
        },
        { // Nivel 19
            title: "APIs con Ruby",
            lesson: [
                { title: "¿Qué es una API?", content: `<p>Interfaz para comunicación entre aplicaciones.</p>` },
                { title: "JSON en Rails", content: `<p>render json: devuelve JSON.</p><div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-ruby">render json: @posts</code></pre></div>` },
                { title: "API Only Mode", content: `<p>rails new --api crea app solo API.</p>` },
                { title: "Serializers", content: `<p>Controlan qué datos se devuelven.</p>` },
                { title: "Autenticación API", content: `<p>Tokens JWT para autenticar.</p>` },
                { title: "CORS", content: `<p>Permite requests desde otros dominios.</p>` },
                { title: "Versionado", content: `<p>api/v1, api/v2 para versiones.</p>` },
                { title: "Rate Limiting", content: `<p>Limita requests por usuario.</p>` },
                { title: "Documentación", content: `<p>Swagger, Postman documentan APIs.</p>` },
                { title: "¡Listo para el Quiz!", content: "<p>Dominas APIs con Ruby. ¡Demuéstralo!</p>"}
            ],
            quiz: [
                { question: "¿Qué es una API?", options: ["Interfaz comunicación", "Base datos", "Editor", "Framework"], answer: "Interfaz comunicación" },
                { question: "¿Qué formato usa APIs?", options: ["JSON", "HTML", "CSS", "XML"], answer: "JSON" },
                { question: "¿Qué hace render json?", options: ["Devuelve JSON", "Devuelve HTML", "Devuelve CSS", "Ninguno"], answer: "Devuelve JSON" },
                { question: "¿Qué hace --api?", options: ["App solo API", "App completa", "App sin BD", "Ninguno"], answer: "App solo API" },
                { question: "¿Qué son serializers?", options: ["Controlan datos", "Validan datos", "Filtran datos", "Ninguno"], answer: "Controlan datos" },
                { question: "¿Qué es JWT?", options: ["Token autenticación", "Base datos", "Framework", "Editor"], answer: "Token autenticación" },
                { question: "¿Qué es CORS?", options: ["Permite requests externos", "Valida datos", "Filtra datos", "Ninguno"], answer: "Permite requests externos" },
                { question: "¿Qué es versionado?", options: ["Versiones API", "Validación", "Query", "Asociación"], answer: "Versiones API" },
                { question: "¿Qué es rate limiting?", options: ["Limita requests", "Valida datos", "Filtra datos", "Ninguno"], answer: "Limita requests" },
                { question: "¿Qué documenta APIs?", options: ["Swagger", "Rails", "RSpec", "Bundler"], answer: "Swagger" }
            ]
        },
        { // Nivel 20
            title: "Proyecto Final: Aplicación Ruby Completa",
            lesson: [
                { title: "Resumen del Curso", content: `<p>Has aprendido Ruby desde lo básico hasta Rails avanzado.</p>` },
                { title: "Conceptos Clave", content: `<p>Variables, clases, módulos, gems, testing, Rails, APIs.</p>` },
                { title: "Proyecto Final", content: `<p>Crea una aplicación web completa con Rails.</p>` },
                { title: "Requisitos del Proyecto", content: `<p>Modelos con asociaciones, autenticación, CRUD completo, API.</p>` },
                { title: "Mejores Prácticas", content: `<p>Tests, código limpio, convenciones Rails.</p>` },
                { title: "Deployment", content: `<p>Heroku, Railway, Render para publicar.</p>` },
                { title: "Próximos Pasos", content: `<p>GraphQL, Hotwire, Stimulus, ViewComponent.</p>` },
                { title: "Comunidad Ruby", content: `<p>RubyGems, GitHub, Stack Overflow, foros.</p>` },
                { title: "Recursos", content: `<p>Ruby Docs, Rails Guides, RubyWeekly.</p>` },
                { title: "¡Felicidades!", content: "<p>¡Has completado el curso de Ruby! Ahora eres un desarrollador Ruby competente. ¡Sigue practicando y creando proyectos increíbles!</p>"}
            ],
            quiz: [
                { question: "¿Qué aprendiste en este curso?", options: ["Ruby completo", "Solo básico", "Solo Rails", "Solo APIs"], answer: "Ruby completo" },
                { question: "¿Qué es Rails?", options: ["Framework web", "Lenguaje", "Base datos", "Editor"], answer: "Framework web" },
                { question: "¿Qué es RSpec?", options: ["Testing", "Framework web", "Base datos", "Editor"], answer: "Testing" },
                { question: "¿Qué es ActiveRecord?", options: ["ORM", "Framework", "Base datos", "Editor"], answer: "ORM" },
                { question: "¿Qué es una gem?", options: ["Librería", "Archivo", "Variable", "Función"], answer: "Librería" },
                { question: "¿Qué es Bundler?", options: ["Gestor dependencias", "Editor", "Servidor", "Base datos"], answer: "Gestor dependencias" },
                { question: "¿Qué es una API?", options: ["Interfaz comunicación", "Base datos", "Editor", "Framework"], answer: "Interfaz comunicación" },
                { question: "¿Dónde deployar Rails?", options: ["Heroku/Railway", "Solo local", "Solo servidor propio", "Ninguno"], answer: "Heroku/Railway" },
                { question: "¿Qué es MVC?", options: ["Model-View-Controller", "Main-Value-Code", "Model-Value-Code", "Ninguno"], answer: "Model-View-Controller" },
                { question: "¿Próximo paso después de Rails?", options: ["Hotwire/GraphQL", "Solo HTML", "Solo CSS", "Ninguno"], answer: "Hotwire/GraphQL" }
            ]
        }
    ];

    // --- LÓGICA DE LA APLICACIÓN ---
    let currentLevel = 0;
    let unlockedLevel = 1;
    let completedLevels = [];
    let quizScores = {}; // Add quizScores state
    let currentLessonStep = 0;
    let currentQuizQuestion = 0;
    let score = 0;
    const COURSE_ID = 'ruby';
    
    // Challenge Map - Desafíos que se desbloquean cada 5 niveles
    const challengeMap = {
        5: 'ruby_challenge1',
        10: 'ruby_challenge2',
        15: 'ruby_challenge3',
        20: 'ruby_challenge4'
    };

    const panels = {
        levelSelection: document.getElementById('level-selection-panel'),
        lesson: document.getElementById('lesson-panel'),
        quiz: document.getElementById('quiz-panel'),
        results: document.getElementById('results-panel')
    };

    // --- THEME ---
    const savedTheme = localStorage.getItem('theme') || 'dark';
    if (savedTheme === 'light') document.documentElement.classList.remove('dark');

    function showPanel(panelName) {
        Object.values(panels).forEach(p => p.classList.remove('active'));
        panels[panelName].classList.add('active');
        lucide.createIcons();
    }

    function saveProgress() {
        localStorage.setItem(`${COURSE_ID}_levelUnlocked`, unlockedLevel);
        localStorage.setItem(`${COURSE_ID}_completedLevels`, JSON.stringify(completedLevels));
        localStorage.setItem(`${COURSE_ID}_quizScores`, JSON.stringify(quizScores)); // Save locally
        
        // Sincronizar con Firebase
        const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
        if (currentUser.id && window.updateCourseProgress) {
            const rubyProgress = {
                completedLevels: completedLevels,
                unlockedLevel: unlockedLevel,
                quizScores: quizScores // Sync to Firebase
            };
            
            // Update local currentUser to reflect changes immediately
            currentUser.rubyProgress = rubyProgress;
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            
            updateCourseProgress(currentUser.id, 'rubyProgress', rubyProgress)
                .catch(err => console.error('Error syncing ruby progress:', err));
        }
    }

    function loadProgress() {
        const savedUnlocked = localStorage.getItem(`${COURSE_ID}_levelUnlocked`);
        if (savedUnlocked) unlockedLevel = parseInt(savedUnlocked, 10);
        const savedCompleted = localStorage.getItem(`${COURSE_ID}_completedLevels`);
        if (savedCompleted) completedLevels = JSON.parse(savedCompleted);
        const savedScores = localStorage.getItem(`${COURSE_ID}_quizScores`);
        if (savedScores) quizScores = JSON.parse(savedScores);
    }

    function renderLevelSelection() {
        const levelGrid = document.getElementById('level-grid');
        levelGrid.innerHTML = '';
        for (let i = 1; i <= 20; i++) {
            const levelIndex = i - 1;
            const node = document.createElement('div');
            node.className = 'level-node';

            let status = 'locked';
            let icon = 'lock';
            if (i < unlockedLevel || completedLevels.includes(levelIndex)) {
                status = 'completed';
                icon = 'check';
            }
            if (i === unlockedLevel && !completedLevels.includes(levelIndex)) {
                status = 'unlocked';
                icon = 'play';
            }

            node.classList.add(status);
            node.innerHTML = `
                <div class="level-icon-wrapper">
                    <i data-lucide="${icon}" class="w-8 h-8"></i>
                </div>
                <span class="level-number">Nivel ${i}</span>`;

            if(status !== 'locked') {
                node.onclick = () => startLevel(levelIndex);
            }

            levelGrid.appendChild(node);
        }
        lucide.createIcons();
    }

// Monaco Initialization Vars
let monacoRequireConfigured = false;
let monacoEditors = {};

function initializeCodeBlockMonaco() {
    if (!monacoRequireConfigured) {
        if (window.require) {
            require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.36.1/min/vs' }});
            monacoRequireConfigured = true;
        } else {
            return;
        }
    }

    require(['vs/editor/editor.main'], function() {
        if (window.themeManager) window.themeManager.defineCustomThemes();

        document.querySelectorAll('.code-block').forEach((block) => {
            if (block.getAttribute('data-monaco-initialized') === 'true') return;
            
            const codeElement = block.querySelector('code');
            if (!codeElement) return;

            let language = 'ruby'; // Default value
            const classStr = codeElement.className || '';
            
            if (classStr.includes('javascript') || classStr.includes('js')) language = 'javascript';
            else if (classStr.includes('python')) language = 'python';
            else if (classStr.includes('html')) language = 'html';

            const code = codeElement.textContent;
            let filename = 'example.' + (language === 'javascript' ? 'js' : (language === 'ruby' ? 'rb' : language));

            block.innerHTML = '';
            block.style.height = 'auto'; // Reset height
            block.setAttribute('data-monaco-initialized', 'true');
            
            const editorContainer = document.createElement('div');
            editorContainer.style.width = '100%';
            const lineCount = code.split('\n').length;
            const height = Math.min(Math.max(lineCount * 21 + 20, 100), 500); 
            editorContainer.style.height = `${height}px`;
            editorContainer.className = 'monaco-static-block rounded-md overflow-hidden border border-gray-700 mt-4';
            
            const header = document.createElement('div');
            header.className = 'flex items-center justify-between px-4 py-2 bg-[#1a1b26] border-b border-gray-800';
            header.innerHTML = `
                <div class="flex gap-2">
                    <div class="w-3 h-3 rounded-full bg-[#ff5f56]"></div>
                    <div class="w-3 h-3 rounded-full bg-[#ffbd2e]"></div>
                    <div class="w-3 h-3 rounded-full bg-[#27c93f]"></div>
                </div>
                <div class="text-xs text-gray-400 font-mono">${filename}</div>
            `;
            
            block.appendChild(header);
            block.appendChild(editorContainer);

            monaco.editor.create(editorContainer, {
                value: code,
                language: language,
                theme: 'tokyo-night',
                readOnly: true,
                domReadOnly: true,
                minimap: { enabled: false },
                scrollBeyondLastLine: false,
                fontSize: 14,
                fontFamily: "'JetBrains Mono', monospace",
                lineNumbers: 'off',
                folding: false,
                renderLineHighlight: 'none',
                contextmenu: false,
                scrollbar: { vertical: 'hidden', horizontal: 'auto', useShadows: false },
                overviewRulerBorder: false,
                hideCursorInOverviewRuler: true,
                padding: { top: 10, bottom: 10 }
            });
        });
    });
}

    function startLevel(levelIndex) {
        currentLevel = levelIndex;
        currentLessonStep = 0;
        renderLesson();
        showPanel('lesson');
    }

    function renderLesson() {
        const levelData = courseData[currentLevel];
        const stepData = levelData.lesson[currentLessonStep];

        document.getElementById('lesson-title').textContent = `Nivel ${currentLevel + 1}: ${stepData.title}`;
        document.getElementById('lesson-content').innerHTML = stepData.content;
        document.getElementById('lesson-step').textContent = `${currentLessonStep + 1} / ${levelData.lesson.length}`;

        const progress = ((currentLessonStep + 1) / levelData.lesson.length) * 100;
        document.getElementById('lesson-progress').style.width = `${progress}%`;

        setTimeout(initializeCodeBlockMonaco, 10);

        const prevBtn = document.getElementById('prev-btn');
        prevBtn.disabled = currentLessonStep === 0;

        document.getElementById('next-btn').textContent = (currentLessonStep === levelData.lesson.length - 1) ? 'Iniciar Quiz' : 'Siguiente';
    }

    function startQuiz() {
        currentQuizQuestion = 0;
        score = 0;
        renderQuizQuestion();
        showPanel('quiz');
        // Bloquear chat durante el quiz
        document.getElementById('chat-modal').classList.add('hidden');
        document.getElementById('chat-toggle-btn').style.display = 'none';
    }

    function renderQuizQuestion() {
        const levelData = courseData[currentLevel];
        const questionData = levelData.quiz[currentQuizQuestion];

        document.getElementById('quiz-level-title').textContent = `Quiz - Nivel ${currentLevel + 1}`;
        document.getElementById('quiz-progress').textContent = `${currentQuizQuestion + 1}/${levelData.quiz.length}`;
        document.getElementById('quiz-question').textContent = questionData.question;

        const optionsContainer = document.getElementById('quiz-options');
        optionsContainer.innerHTML = '';

        // Crear letras fijas en orden a, b, c, d
        const letters = ['a', 'b', 'c', 'd'];

        // Barajar las opciones antes de asignarlas a las letras
        const shuffledOptions = [...questionData.options].sort(() => Math.random() - 0.5);

        // Crear opciones con letras fijas pero contenido aleatorio
        letters.forEach((letter, index) => {
            const optionButton = document.createElement('button');
            optionButton.textContent = `${letter}) ${shuffledOptions[index]}`;
            optionButton.className = 'quiz-option p-4 rounded-lg text-left';
            optionButton.dataset.answer = shuffledOptions[index];
            optionButton.onclick = () => checkAnswer(optionButton, shuffledOptions[index], questionData.answer);
            optionsContainer.appendChild(optionButton);
        });
    }

    function checkAnswer(button, selectedAnswer, correctAnswer) {
        const options = document.querySelectorAll('.quiz-option');
        options.forEach(opt => {
            opt.classList.add('disabled');
            if (opt.textContent.includes(correctAnswer)) {
                opt.classList.add('correct');
            } else if (opt.textContent.includes(selectedAnswer)) {
                opt.classList.add('incorrect');
            }
        });

        if (selectedAnswer === correctAnswer) score++;

        setTimeout(() => {
            currentQuizQuestion++;
            if (currentQuizQuestion < courseData[currentLevel].quiz.length) {
                renderQuizQuestion();
            } else {
                showResults();
            }
        }, 1500);
    }

    function showResults() {
        const passed = score >= (courseData[currentLevel].quiz.length * 0.7); // 70% to pass
        const resultsIcon = document.getElementById('results-icon');

        document.getElementById('results-title').textContent = passed ? '¡Felicidades!' : 'Sigue Intentando';
        resultsIcon.setAttribute('data-lucide', passed ? 'award' : 'repeat');
        resultsIcon.style.color = passed ? 'var(--green)' : 'var(--yellow)';

        document.getElementById('results-score').textContent = `Tu puntuación: ${score} / ${courseData[currentLevel].quiz.length}`;
        document.getElementById('results-message').textContent = passed
            ? '¡Has desbloqueado el siguiente nivel!'
            : `Necesitas al menos ${Math.ceil(courseData[currentLevel].quiz.length * 0.7)} respuestas correctas para pasar. ¡No te rindas!`;

        const nextLevelBtn = document.getElementById('next-level-btn');
        if (passed) {
            if (!completedLevels.includes(currentLevel)) {
                completedLevels.push(currentLevel);
            }
            if (unlockedLevel <= currentLevel + 1) {
                unlockedLevel = currentLevel + 2;
            }
            
            // Save Quiz Score to State
            quizScores[currentLevel] = score;
            
            saveProgress();
            // Guardar quizScores para leaderboard
            saveQuizScore(score, courseData[currentLevel].quiz.length, COURSE_ID, currentLevel + 1);
            // Mostrar challenge si corresponde
            checkAndShowChallenge(currentLevel + 1, challengeMap);
            nextLevelBtn.classList.remove('hidden');
        } else {
            nextLevelBtn.classList.add('hidden');
        }
        showPanel('results');
    }

    // Event Listeners
    document.getElementById('next-btn').addEventListener('click', () => {
        if (currentLessonStep < courseData[currentLevel].lesson.length - 1) {
            currentLessonStep++;
            renderLesson();
        } else {
            startQuiz();
        }
    });
    document.getElementById('prev-btn').addEventListener('click', () => {
        if (currentLessonStep > 0) {
            currentLessonStep--;
            renderLesson();
        }
    });
    document.getElementById('close-lesson-btn').addEventListener('click', () => {
        renderLevelSelection();
        showPanel('levelSelection');
    });
    document.getElementById('retry-lesson-btn').addEventListener('click', () => startLevel(currentLevel));
    document.getElementById('next-level-btn').addEventListener('click', () => {
        if(currentLevel + 1 < courseData.length){
            startLevel(currentLevel + 1);
        } else {
              renderLevelSelection();
              showPanel('levelSelection');
        }
    });

    // Inicialización
    // Event listener consolidado abajo

    // --- LÓGICA DE TEMA (Día/Noche) ---
    const themeToggle = document.getElementById('theme-toggle');
    const themeIcon = document.querySelector('#theme-toggle i');

    function updateTheme(theme) {
        if (theme === 'dark') {
            document.documentElement.classList.add('dark');
            if (themeIcon) themeIcon.setAttribute('data-lucide', 'sun');
        } else {
            document.documentElement.classList.remove('dark');
            if (themeIcon) themeIcon.setAttribute('data-lucide', 'moon');
        }
        localStorage.setItem('theme', theme);
        if (typeof lucide !== 'undefined') {
            lucide.createIcons();
        }
    }

    if (themeToggle) {
        themeToggle.addEventListener('click', () => {
            const currentTheme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
            updateTheme(currentTheme === 'dark' ? 'light' : 'dark');
        });
    }

    // Inicialización de la aplicación
    // Inicialización de la aplicación
    document.addEventListener('DOMContentLoaded', async () => {
        // Import dynamic modules locally if needed, or rely on window globals if already loaded. 
        // Better: Use the window globals set by firebase-config.js which is loaded as module in head.
        
        const { showLoading, hideLoading, checkConnection, getUserFromFirestore } = window;

        if (!checkConnection()) return;
        if (showLoading) showLoading('Sincronizando con Ruby...');

        // Strict Session Check
        const localSession = JSON.parse(localStorage.getItem('currentUser'));
        
        if (!localSession || !localSession.id) {
            alert('Sesión no encontrada. Redirigiendo...');
            window.location.href = 'index.html';
            return;
        }

        try {
            // Strict Sync from Firestore
            // We rely on window.getUserFromFirestore initialized in <head> module
            if (getUserFromFirestore) {
                const firestoreUser = await getUserFromFirestore(localSession.id);
                
                if (!firestoreUser) {
                    throw new Error('Usuario no existe en DB remoto.');
                }

                // Update Local State with Fresh Data
                // Ruby course specific fields
                if (firestoreUser.rubyProgress) {
                    completedLevels = firestoreUser.rubyProgress.completedLevels || [];
                    unlockedLevel = firestoreUser.rubyProgress.unlockedLevel || 1;
                    quizScores = firestoreUser.rubyProgress.quizScores || {};
                    
                    // Update Cache
                    localStorage.setItem('ruby_levelUnlocked', unlockedLevel);
                    localStorage.setItem('ruby_completedLevels', JSON.stringify(completedLevels));
                    localStorage.setItem('ruby_quizScores', JSON.stringify(quizScores));
                } else {
                    console.log('🆕 Inicializando curso Ruby para usuario...');
                }
                
                // Update global session cache
                localStorage.setItem('currentUser', JSON.stringify(firestoreUser));
                
            } else {
                console.warn('Firebase functions not attached to window?');
            }
            
            // Render UI
            loadProgress(); // Reloads from variables/cache updated above
            renderLevelSelection();
            showPanel('levelSelection');
            
            if (hideLoading) hideLoading();

        } catch (error) {
            console.error('❌ Error Fatal Ruby Init:', error);
            alert('Error cargando curso: ' + error.message);
            window.location.href = 'menu_inicio.html';
        }

        // Carga el tema guardado
        const savedTheme = localStorage.getItem('theme') || 'dark';
        updateTheme(savedTheme);

        // Inicializar iconos
        if (typeof lucide !== 'undefined') {
            lucide.createIcons();
        }
    });
    </script>
    <!-- Sistema de quizScores y challengeMap -->
    <script src="assets/js/course_system.js"></script>
    <!-- Prism.js core and languages -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-markup.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-css.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/toolbar/prism-toolbar.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>
    <!-- Sistema de Chat (Bot) -->
    <script src="assets/js/chat-system.js"></script>
</body>
</html>
