<!DOCTYPE html>
<html lang="es" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python - Status Code 418</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/line-numbers/prism-line-numbers.css">
    <link rel="stylesheet" href="assets/css/auras.css">
    <!-- Firebase Modules -->
    <script type="module" src="assets/js/firebase-config.js"></script>
    <script type="module" src="assets/js/firebase-storage.js"></script>

    <script src="assets/js/course_system.js"></script>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>
    <!-- Monaco Editor Loader -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.36.1/min/vs/loader.min.js"></script>
    <!-- Theme Manager -->
    <script src="assets/js/theme-manager.js"></script>
    <style>
     :root {
         --background: #1a1b26;
         --foreground: #a9b1d6;
         --card-background: #24283b;
         --border: #414868;
         --accent: #7aa2f7;
         --accent-dark: #5a7edb;
         --green: #9ece6a;
         --yellow: #e0af68;
         --red: #f7768e;
         --font-sans: 'Inter', sans-serif;
         --font-mono: 'JetBrains Mono', monospace;
     }

     body {
         color: var(--foreground);
         font-family: var(--font-sans);
         margin: 0;
         padding: 0;
         position: relative;
         overflow-x: hidden;
     }

     /* Fondo animado */
     .background-container {
         position: fixed;
         top: 0;
         left: 0;
         width: 100%;
         height: 100%;
         z-index: -1;
         transition: opacity 0.5s ease;
     }

     .background-day, .background-night {
         position: absolute;
         top: 0;
         left: 0;
         width: 100%;
         height: 100%;
         background-size: cover;
         background-position: center;
         opacity: 0;
         transition: opacity 1s ease;
     }

     .background-day {
         background-image: url('https://i.pinimg.com/originals/71/f1/b9/71f1b924a56150104ec16828f2d31b7f.gif');
     }

     .background-night {
         background-image: url('https://i.pinimg.com/originals/4c/23/98/4c2398e6be397bb08b5cb70b2192d730.gif');
     }

     .dark .background-night {
         opacity: 1;
     }

     .background-day {
         opacity: 1;
     }

     .content-box {
         background-color: rgba(36, 40, 59, 0.85);
         border: 1px solid var(--border);
         border-radius: 15px;
         padding: 2rem;
         box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
         backdrop-filter: blur(10px);
         display: flex;
         justify-content: center;
         align-items: center;
         min-height: calc(100vh - 4rem);
         margin: 2rem;
     }

     /* Index Page Styles */
     .main-container {
         display: flex;
         flex-direction: column;
         align-items: center;
         justify-content: center;
         min-height: calc(100vh - 4rem);
         text-align: center;
     }

     .main-title {
         font-size: 5rem;
         font-weight: bold;
         color: var(--accent);
         text-shadow: 0 0 15px var(--accent);
         margin-bottom: 1rem;
     }

     .main-subtitle {
         font-size: 1.5rem;
         margin-bottom: 3rem;
         max-width: 600px;
     }

     .course-grid {
         display: grid;
         grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
         gap: 2.5rem;
         width: 100%;
         max-width: 1400px;
         padding: 2rem 0;
         justify-items: center;
     }

     .course-card-link {
         text-decoration: none;
     }

     .course-card {
         background: linear-gradient(135deg, var(--card-background) 0%, rgba(65, 72, 104, 0.5) 100%);
         border: 1px solid var(--border);
         border-radius: 20px;
         padding: 2.5rem;
         transition: all 0.4s ease;
         display: flex;
         flex-direction: column;
         align-items: center;
         gap: 1.5rem;
         position: relative;
         overflow: hidden;
     }

     .course-card::before {
         content: '';
         position: absolute;
         top: 0;
         left: 0;
         right: 0;
         bottom: 0;
         background: linear-gradient(135deg, rgba(122, 162, 247, 0.1) 0%, rgba(158, 206, 106, 0.1) 100%);
         opacity: 0;
         transition: opacity 0.4s ease;
         border-radius: 20px;
     }

     .course-card:hover {
         transform: translateY(-15px) scale(1.05);
         box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4), 0 0 20px rgba(122, 162, 247, 0.3);
         border-color: var(--accent);
     }

     .course-card:hover::before {
         opacity: 1;
     }

     .course-icon {
         font-size: 4rem;
         color: var(--accent);
         transition: transform 0.3s ease, color 0.3s ease;
         z-index: 1;
     }

     .course-card:hover .course-icon {
         transform: scale(1.1);
         color: var(--yellow);
     }

     .course-title {
         font-size: 1.5rem;
         font-weight: 600;
         color: var(--foreground);
         z-index: 1;
         transition: color 0.3s ease;
     }

     .course-card:hover .course-title {
         color: var(--yellow);
     }

     .course-description {
         color: var(--foreground);
         opacity: 0.7;
         z-index: 1;
         transition: opacity 0.3s ease;
     }

     .course-card:hover .course-description {
         opacity: 1;
     }

     /* Course Page Styles */
     .panel {
         display: none;
         animation: fadeIn 0.5s ease;
         width: 100%;
     }

     .panel.active {
         display: flex;
     }

     @keyframes fadeIn {
         from {
             opacity: 0;
             transform: scale(0.98);
         }
         to {
             opacity: 1;
             transform: scale(1);
         }
     }

     .code-block {
         background-color: #1a1b26;
         border: 1px solid var(--border);
         color: #c0caf5;
         font-family: var(--font-mono);
         border-radius: 12px;
         margin-top: 1rem;
         overflow: hidden;
         box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
     }

     .code-block-header {
         background: linear-gradient(135deg, #24283b 0%, #1a1b26 100%);
         padding: 0.75rem 1rem;
         display: flex;
         align-items: center;
         gap: 0.5rem;
         border-bottom: 1px solid var(--border);
     }

     .code-block-header span {
         width: 12px;
         height: 12px;
         border-radius: 50%;
     }

     .code-block-header .bg-red-500 { background-color: #ff5f56; }
     .code-block-header .bg-yellow-500 { background-color: #ffbd2e; }
     .code-block-header .bg-green-500 { background-color: #27c93f; }

     /* Estilos mejorados para el código con guías de indentación */
     .code-block pre {
         margin: 0;
         padding: 1rem 1.25rem;
         white-space: pre;
         overflow-x: auto;
         background: #1a1b26;
         position: relative;
     }

     .code-block pre code {
         font-family: 'JetBrains Mono', 'Fira Code', Consolas, monospace;
         font-size: 0.9rem;
         line-height: 1.7;
         tab-size: 4;
         display: block;
         position: relative;
         color: #c0caf5;
     }

     /* Guías de indentación estilo VSCode */
     .code-block pre code::before {
         content: '';
         position: absolute;
         left: 0;
         top: 0;
         bottom: 0;
         width: 100%;
         pointer-events: none;
         background-image: 
             repeating-linear-gradient(
                 90deg,
                 transparent 0px,
                 transparent 2rem,
                 rgba(122, 162, 247, 0.08) 2rem,
                 rgba(122, 162, 247, 0.08) calc(2rem + 1px),
                 transparent calc(2rem + 1px),
                 transparent 4rem,
                 rgba(255, 158, 100, 0.08) 4rem,
                 rgba(255, 158, 100, 0.08) calc(4rem + 1px),
                 transparent calc(4rem + 1px),
                 transparent 6rem,
                 rgba(158, 206, 106, 0.08) 6rem,
                 rgba(158, 206, 106, 0.08) calc(6rem + 1px),
                 transparent calc(6rem + 1px),
                 transparent 8rem,
                 rgba(187, 154, 247, 0.08) 8rem,
                 rgba(187, 154, 247, 0.08) calc(8rem + 1px),
                 transparent calc(8rem + 1px),
                 transparent 10rem
             );
     }

     /* Números de línea para los bloques de código */
     .code-block.with-line-numbers pre {
         padding-left: 3.5rem;
         counter-reset: line;
     }

     .code-block.with-line-numbers pre code .line::before {
         counter-increment: line;
         content: counter(line);
         position: absolute;
         left: -2.5rem;
         width: 2rem;
         text-align: right;
         color: #565f89;
         font-size: 0.8rem;
     }

     /* Scrollbar personalizado para el código */
     .code-block pre::-webkit-scrollbar {
         height: 8px;
     }

     .code-block pre::-webkit-scrollbar-track {
         background: #1a1b26;
         border-radius: 4px;
     }

     .code-block pre::-webkit-scrollbar-thumb {
         background: #414868;
         border-radius: 4px;
     }

     .code-block pre::-webkit-scrollbar-thumb:hover {
         background: #565f89;
     }


     .code-block .language-html .tag,
     .code-block .language-css .at-rule,
     .code-block .language-javascript .keyword {
         color: var(--accent);
     }

     .code-block .language-html .string,
     .code-block .language-css .string,
     .code-block .language-javascript .string {
         color: var(--green);
     }

     .code-block .language-css .property,
     .code-block .language-javascript .property {
         color: var(--yellow);
     }

     .code-block .language-html .comment,
     .code-block .language-css .comment,
     .code-block .language-javascript .comment {
         color: #5c6370;
     }

     .btn-primary {
         background-color: var(--accent);
         color: white;
         padding: 0.75rem 1.5rem;
         border-radius: 8px;
         font-weight: 600;
         border: none;
         cursor: pointer;
         transition: background-color 0.2s;
     }

     .btn-primary:hover {
         background-color: var(--accent-dark);
     }

     .btn-primary:disabled {
         opacity: 0.5;
         cursor: not-allowed;
     }

     .quiz-option {
         border: 2px solid var(--border);
         background-color: transparent;
         color: var(--foreground);
         padding: 1rem;
         border-radius: 8px;
         cursor: pointer;
         transition: all 0.2s;
         text-align: left;
         width: 100%;
         user-select: none;
         -webkit-user-select: none;
         -moz-user-select: none;
         -ms-user-select: none;
     }

     .quiz-option:hover:not(.disabled) {
         border-color: var(--accent);
         background-color: rgba(122, 162, 247, 0.1);
     }

     .quiz-option.correct {
         border-color: var(--green);
         background-color: rgba(158, 206, 106, 0.1);
         color: var(--green);
     }

     .quiz-option.incorrect {
         border-color: var(--red);
         background-color: rgba(247, 118, 142, 0.1);
         color: var(--red);
     }

     .quiz-option.disabled {
         pointer-events: none;
         opacity: 0.7;
     }

     .level-node {
         display: flex;
         flex-direction: column;
         align-items: center;
         position: relative;
         cursor: pointer;
     }

     .level-icon-wrapper {
         width: 64px;
         height: 64px;
         border-radius: 50%;
         display: flex;
         align-items: center;
         justify-content: center;
         border: 3px solid;
         transition: all 0.3s ease;
     }

     .level-number {
         margin-top: 8px;
         font-weight: 600;
         font-size: 0.9rem;
     }

     .level-node.locked .level-icon-wrapper {
         border-color: var(--border);
         color: var(--border);
         background-color: transparent;
     }

     .level-node.unlocked .level-icon-wrapper {
         border-color: var(--accent);
         color: var(--accent);
     }

     .level-node.unlocked:hover .level-icon-wrapper {
         background-color: var(--accent);
         color: var(--card-background);
         transform: scale(1.1);
     }

     .level-node.completed .level-icon-wrapper {
         border-color: var(--green);
         background-color: var(--green);
         color: var(--card-background);
     }

     #level-grid {
         display: grid;
         grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
         gap: 32px 16px;
         width: 100%;
         max-width: 60rem;
         margin: 0 auto;
     }

     .progress-bar-bg {
         background-color: var(--border);
         border-radius: 9999px;
         height: 0.625rem;
     }

     .progress-bar-fill {
         background-color: var(--accent);
         height: 0.625rem;
         border-radius: 9999px;
     }

     .hidden {
         display: none;
     }

     /* Estilos para el contenido de la lección */
     .lesson-content h3 {
         color: var(--accent);
         margin-top: 1.5rem;
         margin-bottom: 0.5rem;
     }

     .lesson-content ul, .lesson-content ol {
         margin-left: 1.5rem;
         margin-bottom: 1rem;
     }

     .lesson-content li {
         margin-bottom: 0.5rem;
     }

     .lesson-content code {
         background-color: rgba(122, 162, 247, 0.1);
         color: var(--accent);
         padding: 0.2rem 0.4rem;
         border-radius: 4px;
         font-family: var(--font-mono);
         font-size: 0.9em;
     }

     .lesson-content strong {
         color: var(--yellow);
     }

     .lesson-content p {
         margin-bottom: 1rem;
         line-height: 1.6;
     }

     /* Nuevos estilos para tipos de preguntas */
     .quiz-type-indicator {
         background-color: var(--accent);
         color: white;
         padding: 0.5rem 1rem;
         border-radius: 20px;
         font-size: 0.875rem;
         font-weight: 600;
         margin-bottom: 1rem;
         display: inline-block;
     }

     .code-completion-input {
         background-color: rgba(122, 162, 247, 0.1);
         border: 1px solid var(--accent);
         color: var(--foreground);
         padding: 0.5rem;
         border-radius: 4px;
         font-family: var(--font-mono);
         width: 100px;
         margin: 0 0.25rem;
     }

     .drag-drop-container {
         display: flex;
         flex-direction: column;
         gap: 1rem;
         margin: 1.5rem 0;
     }

     .drag-drop-options {
         display: flex;
         flex-wrap: wrap;
         gap: 0.5rem;
         margin-bottom: 1rem;
     }

     .drag-option {
         background-color: var(--accent);
         color: white;
         padding: 0.5rem 1rem;
         border-radius: 6px;
         cursor: grab;
         user-select: none;
     }

     .drag-option:active {
         cursor: grabbing;
     }

     .drag-drop-targets {
         display: flex;
         flex-direction: column;
         gap: 0.5rem;
     }

     .drag-target {
         background-color: rgba(122, 162, 247, 0.1);
         border: 2px dashed var(--accent);
         border-radius: 6px;
         padding: 1rem;
         min-height: 50px;
         display: flex;
         align-items: center;
         gap: 0.5rem;
     }

     .drag-target.occupied {
         border-style: solid;
         background-color: rgba(158, 206, 106, 0.1);
     }

     .matching-container {
         display: grid;
         grid-template-columns: 1fr 1fr;
         gap: 1rem;
         margin: 1.5rem 0;
     }

     .matching-item {
         background-color: rgba(122, 162, 247, 0.1);
         border: 1px solid var(--accent);
         border-radius: 6px;
         padding: 1rem;
         cursor: pointer;
         transition: all 0.2s;
     }

     .matching-item.selected {
         background-color: var(--accent);
         color: white;
     }

     .matching-item.matched {
         background-color: rgba(158, 206, 106, 0.2);
         border-color: var(--green);
     }

     .ordering-container {
         display: flex;
         flex-direction: column;
         gap: 0.5rem;
         margin: 1.5rem 0;
     }

     .ordering-item {
         background-color: rgba(122, 162, 247, 0.1);
         border: 1px solid var(--accent);
         border-radius: 6px;
         padding: 1rem;
         cursor: grab;
         user-select: none;
         display: flex;
         align-items: center;
         gap: 0.5rem;
     }

     .ordering-item:active {
         cursor: grabbing;
     }

     .ordering-handle {
         color: var(--accent);
     }

     .error-finding-container {
         position: relative;
         margin: 1.5rem 0;
     }

     .error-code {
         position: relative;
     }

     .error-spot {
         position: absolute;
         background-color: rgba(247, 118, 142, 0.3);
         border-radius: 3px;
         cursor: pointer;
         transition: background-color 0.2s;
     }

     .error-spot:hover {
         background-color: rgba(247, 118, 142, 0.5);
     }

     .error-spot.found {
         background-color: rgba(158, 206, 106, 0.3);
     }

     .quiz-feedback {
         margin-top: 1rem;
         padding: 1rem;
         border-radius: 6px;
         font-weight: 600;
     }

     .quiz-feedback.correct {
         background-color: rgba(158, 206, 106, 0.1);
         color: var(--green);
         border: 1px solid var(--green);
     }

     .quiz-feedback.incorrect {
         background-color: rgba(247, 118, 142, 0.1);
         color: var(--red);
         border: 1px solid var(--red);
     }

     /* Chat Styles */
     #chat-toggle-btn {
         background-color: var(--yellow) !important;
         color: var(--card-background) !important;
         border: none !important;
         box-shadow: 0 4px 12px rgba(224, 175, 104, 0.3) !important;
     }

     #chat-toggle-btn:hover {
         background-color: var(--accent) !important;
         transform: scale(1.1) !important;
         box-shadow: 0 6px 16px rgba(224, 175, 104, 0.4) !important;
     }

     #chat-modal {
         background-color: var(--card-background) !important;
         border: 1px solid var(--border) !important;
         box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5) !important;
     }

     #chat-messages {
         scrollbar-width: thin;
         scrollbar-color: var(--border) transparent;
     }

     #chat-messages::-webkit-scrollbar {
         width: 6px;
     }

     #chat-messages::-webkit-scrollbar-track {
         background: transparent;
     }

     #chat-messages::-webkit-scrollbar-thumb {
         background-color: var(--border);
         border-radius: 3px;
     }

     #chat-messages::-webkit-scrollbar-thumb:hover {
         background-color: var(--accent);
     }

     #chat-input {
         background-color: var(--background) !important;
         border: 1px solid var(--border) !important;
         color: var(--foreground) !important;
     }

     #chat-input:focus {
         outline: none !important;
         border-color: var(--accent) !important;
         box-shadow: 0 0 0 2px rgba(122, 162, 247, 0.2) !important;
     }

     #chat-send-btn {
         background-color: var(--accent) !important;
         border: none !important;
     }

     #chat-send-btn:hover:not(:disabled) {
         background-color: var(--accent-dark) !important;
     }

     #chat-loading {
         color: var(--yellow) !important;
     }

     .chat-message-bubble {
         max-width: 85% !important;
         padding: 0.75rem !important;
         border-radius: 12px !important;
         font-size: 0.875rem !important;
         line-height: 1.4 !important;
         word-wrap: break-word !important;
     }

     .user-message {
         background-color: var(--accent) !important;
         color: white !important;
         margin-left: auto !important;
     }

     .ai-message {
         background-color: var(--border) !important;
         color: var(--foreground) !important;
         margin-right: auto !important;
     }

     /* Responsive Chat */
     @media (max-width: 640px) {
         #chat-modal {
             width: 95% !important;
             height: 400px !important;
             bottom: 80px !important;
             right: 2.5% !important;
             left: 2.5% !important;
         }

         .chat-message-bubble {
             max-width: 90% !important;
             font-size: 0.8rem !important;
         }
     }

     @media (min-width: 641px) {
         #chat-modal {
             width: 320px !important;
             height: 450px !important;
             bottom: 80px !important;
             right: 24px !important;
         }
     }

     /* Asegurar que el modal se oculte correctamente */
     #chat-modal.hidden {
         display: none !important;
     }

     /* Mejorar la funcionalidad del botón de cierre */
     #chat-close-btn {
         cursor: pointer !important;
         padding: 8px !important;
         border-radius: 6px !important;
         transition: all 0.2s ease !important;
         color: var(--foreground) !important;
     }

     #chat-close-btn:hover {
         background-color: rgba(255, 255, 255, 0.1) !important;
         transform: scale(1.1) !important;
     }

     /* Header del chat mejorado */
     #chat-modal header {
         background-color: rgba(26, 27, 38, 0.9) !important;
         backdrop-filter: blur(10px) !important;
     }

         /* Prism.js Tokyo Night inspired theme */
        /* Base from Prism default, colors adapted to Tokyo Night */
        code[class*="language-"], pre[class*="language-"] {
            color: #c0caf5;
            background: #1a1b26;
            text-shadow: none;
            font-family: "JetBrains Mono", Consolas, Monaco, "Andale Mono", "Ubuntu Mono", monospace;
            font-size: 0.95rem;
            line-height: 1.6;
            direction: ltr;
            text-align: left;
            white-space: pre;
            word-spacing: normal;
            word-break: normal;
            tab-size: 2;
            hyphens: none;
        }
    
        pre[class*="language-"] {
            padding: 1rem;
            margin: 0;
            overflow: auto;
            border-radius: 10px;
            border: 1px solid #414868;
            background: #1e1e2e;
        }
    
        :not(pre) > code[class*="language-"] {
            padding: .15rem .35rem;
            border-radius: .35rem;
            background: rgba(122,162,247,.12);
            color: #7aa2f7;
            border: 1px solid #414868;
        }
    
        .token.comment,
        .token.prolog,
        .token.doctype,
        .token.cdata {
            color: #565f89;
            font-style: italic;
        }
    
        .token.punctuation { color: #c0caf5; }
    
        .token.property,
        .token.tag,
        .token.boolean,
        .token.number,
        .token.constant,
        .token.symbol,
        .token.deleted {
            color: #ff9e64;
            font-weight: bold;
        }
    
        .token.selector,
        .token.attr-name,
        .token.string,
        .token.char,
        .token.builtin,
        .token.inserted {
            color: #9ece6a;
        }
    
        .token.operator,
        .token.entity,
        .token.url,
        .language-css .token.string,
        .style .token.string {
            color: #c0caf5;
            font-weight: bold;
        }
    
        .token.atrule,
        .token.attr-value,
        .token.keyword {
            color: #bb9af7;
            font-weight: bold;
        }
    
        .token.function,
        .token.class-name {
            color: #7aa2f7;
            font-weight: bold;
        }
    
        .token.regex,
        .token.important,
        .token.variable {
            color: #e0af68;
            font-style: italic;
        }
    
        /* Enhanced Python-specific highlighting */
        .language-python .token.keyword {
            color: #bb9af7;
            font-weight: bold;
        }
    
        .language-python .token.function {
            color: #7aa2f7;
        }
    
        .language-python .token.string {
            color: #9ece6a;
        }
    
        .language-python .token.number {
            color: #ff9e64;
        }
    
        .language-python .token.operator {
            color: #c0caf5;
            font-weight: bold;
        }
    
        .language-python .token.punctuation {
            color: #c0caf5;
        }
    
        .token.bold { font-weight: bold; }
        .token.italic { font-style: italic; }
    
        .token.entity { cursor: help; }
    
        /***** Line numbers plugin *****/
        pre.line-numbers {
            position: relative;
            padding-left: 3.2em;
            counter-reset: linenumber;
        }
        pre.line-numbers > code { position: relative; }
    
        .line-numbers .line-numbers-rows {
            position: absolute;
            pointer-events: none;
            top: 0; left: 0;
            width: 3em;
            border-right: 1px solid #2b3050;
            background: #1a1b26;
            user-select: none;
        }
    
        .line-numbers-rows > span {
            display: block;
            counter-increment: linenumber;
        }
    
        .line-numbers-rows > span:before {
            content: counter(linenumber);
            display: block;
            padding: 0 .8em 0 .6em;
            color: #565f89;
            text-align: right;
        }
    
        /***** Toolbar plugin *****/
        .prism-toolbar {
            position: absolute;
            top: .4rem;
            right: .4rem;
        }
        .prism-toolbar button, .prism-toolbar span {
            background: #24283b;
            color: #a9b1d6;
            border: 1px solid #414868;
            border-radius: 6px;
            padding: .25rem .5rem;
            font-size: .75rem;
        }
        .prism-toolbar button:hover { background: #2b3050; }
            /* Nuevos estilos para tipos de preguntas */
            .quiz-type-indicator {
                background-color: var(--accent);
                color: white;
                padding: 0.5rem 1rem;
                border-radius: 20px;
                font-size: 0.875rem;
                font-weight: 600;
                margin-bottom: 1rem;
                display: inline-block;
            }
            
            .code-completion-input {
                background-color: rgba(122, 162, 247, 0.1);
                border: 1px solid var(--accent);
                color: var(--foreground);
                padding: 0.5rem;
                border-radius: 4px;
                font-family: var(--font-mono);
                width: 100px;
                margin: 0 0.25rem;
            }
            
            .drag-drop-container {
                display: flex;
                flex-direction: column;
                gap: 1rem;
                margin: 1.5rem 0;
            }
            
            .drag-drop-options {
                display: flex;
                flex-wrap: wrap;
                gap: 0.5rem;
                margin-bottom: 1rem;
            }
            
            .drag-option {
                background-color: var(--accent);
                color: white;
                padding: 0.5rem 1rem;
                border-radius: 6px;
                cursor: grab;
                user-select: none;
            }
            
            .drag-option:active {
                cursor: grabbing;
            }
            
            .drag-drop-targets {
                display: flex;
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .drag-target {
                background-color: rgba(122, 162, 247, 0.1);
                border: 2px dashed var(--accent);
                border-radius: 6px;
                padding: 1rem;
                min-height: 50px;
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }
            
            .drag-target.occupied {
                border-style: solid;
                background-color: rgba(158, 206, 106, 0.1);
            }
            
            .matching-container {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 1rem;
                margin: 1.5rem 0;
            }
            
            .matching-item {
                background-color: rgba(122, 162, 247, 0.1);
                border: 1px solid var(--accent);
                border-radius: 6px;
                padding: 1rem;
                cursor: pointer;
                transition: all 0.2s;
            }
            
            .matching-item.selected {
                background-color: var(--accent);
                color: white;
            }
            
            .matching-item.matched {
                background-color: rgba(158, 206, 106, 0.2);
                border-color: var(--green);
            }
            
            .ordering-container {
                display: flex;
                flex-direction: column;
                gap: 0.5rem;
                margin: 1.5rem 0;
            }
            
            .ordering-item {
                background-color: rgba(122, 162, 247, 0.1);
                border: 1px solid var(--accent);
                border-radius: 6px;
                padding: 1rem;
                cursor: grab;
                user-select: none;
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }
            
            .ordering-item:active {
                cursor: grabbing;
            }
            
            .ordering-handle {
                color: var(--accent);
            }
            
            .error-finding-container {
                position: relative;
                margin: 1.5rem 0;
            }
            
            .error-code {
                position: relative;
            }
            
            .error-spot {
                position: absolute;
                background-color: rgba(247, 118, 142, 0.3);
                border-radius: 3px;
                cursor: pointer;
                transition: background-color 0.2s;
            }
            
            .error-spot:hover {
                background-color: rgba(247, 118, 142, 0.5);
            }
            
            .error-spot.found {
                background-color: rgba(158, 206, 106, 0.3);
            }
            
            .quiz-feedback {
                margin-top: 1rem;
                padding: 1rem;
                border-radius: 6px;
                font-weight: 600;
            }
            
            .quiz-feedback.correct {
                background-color: rgba(158, 206, 106, 0.1);
                color: var(--green);
                border: 1px solid var(--green);
            }
            
            .quiz-feedback.incorrect {
                background-color: rgba(247, 118, 142, 0.1);
                color: var(--red);
                border: 1px solid var(--red);
            }

            /* Estilos para la Consola Interactiva de Python */
            .python-interactive-container {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 1.5rem;
                margin: 2rem 0;
            }

            @media (max-width: 768px) {
                .python-interactive-container {
                    grid-template-columns: 1fr;
                }
            }

            .code-display-panel {
                background-color: #1e1e2e;
                border: 1px solid var(--border);
                border-radius: 12px;
                overflow: hidden;
                display: flex;
                flex-direction: column;
            }

            .code-display-header {
                background-color: var(--border);
                padding: 0.75rem 1rem;
                display: flex;
                align-items: center;
                justify-content: space-between;
            }

            .code-display-header .dots {
                display: flex;
                gap: 0.5rem;
            }

            .code-display-header .dot {
                width: 12px;
                height: 12px;
                border-radius: 50%;
            }

            .code-display-body {
                padding: 1rem;
                overflow-x: auto;
                flex-grow: 1;
            }

            .code-display-body pre {
                margin: 0;
                font-family: var(--font-mono);
                font-size: 0.9rem;
                line-height: 1.6;
                color: #c0caf5;
            }

            .console-panel {
                background-color: #1a1a1a;
                border: 1px solid var(--border);
                border-radius: 12px;
                overflow: hidden;
                display: flex;
                flex-direction: column;
            }

            .console-header {
                background-color: var(--border);
                padding: 0.75rem 1rem;
                display: flex;
                align-items: center;
                justify-content: space-between;
            }

            .console-header .title {
                font-weight: 600;
                color: var(--foreground);
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }

            .console-controls {
                display: flex;
                gap: 0.5rem;
            }

            .console-btn {
                padding: 0.4rem 0.8rem;
                border-radius: 6px;
                font-size: 0.85rem;
                font-weight: 600;
                border: none;
                cursor: pointer;
                transition: all 0.2s;
                display: flex;
                align-items: center;
                gap: 0.3rem;
            }

            .console-btn-run {
                background-color: var(--green);
                color: var(--background);
            }

            .console-btn-run:hover {
                background-color: #b4f481;
            }

            .console-btn-run:disabled {
                background-color: var(--border);
                cursor: not-allowed;
                opacity: 0.5;
            }

            .console-btn-clear {
                background-color: var(--red);
                color: white;
            }

            .console-btn-clear:hover {
                background-color: #ff8fa3;
            }

            .console-output {
                padding: 1rem;
                min-height: 200px;
                max-height: 400px;
                overflow-y: auto;
                font-family: var(--font-mono);
                font-size: 0.9rem;
                line-height: 1.6;
                color: #c0caf5;
                flex-grow: 1;
            }

            .console-output::-webkit-scrollbar {
                width: 8px;
            }

            .console-output::-webkit-scrollbar-track {
                background: transparent;
            }

            .console-output::-webkit-scrollbar-thumb {
                background-color: var(--border);
                border-radius: 4px;
            }

            .console-line {
                margin-bottom: 0.5rem;
            }

            .console-line.output {
                color: #9ece6a;
            }

            .console-line.error {
                color: var(--red);
            }

            .console-line.input {
                color: var(--yellow);
            }

            .console-line.info {
                color: var(--accent);
            }

            .console-input-prompt {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                padding: 0.5rem 1rem;
                background-color: rgba(122, 162, 247, 0.1);
                border-top: 1px solid var(--border);
            }

            .console-input-field {
                flex-grow: 1;
                background-color: transparent;
                border: none;
                color: var(--foreground);
                font-family: var(--font-mono);
                font-size: 0.9rem;
                outline: none;
            }

            .console-loading {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                color: var(--yellow);
            }

            .console-loading .spinner {
                width: 16px;
                height: 16px;
                border: 2px solid var(--border);
                border-top-color: var(--yellow);
                border-radius: 50%;
                animation: spin 1s linear infinite;
            }

            @keyframes spin {
                to { transform: rotate(360deg); }
            }

            /* Rainbow Indentation para Código Python */
            .code-display-body pre code,
            .code-block pre code {
                position: relative;
                display: block;
            }

            /* Indent Rainbow - Niveles de indentación con colores */
            .code-display-body pre code .indent-level-1,
            .code-block pre code .indent-level-1 {
                border-left: 2px solid rgba(255, 85, 85, 0.3);
                padding-left: 1rem;
            }

            .code-display-body pre code .indent-level-2,
            .code-block pre code .indent-level-2 {
                border-left: 2px solid rgba(255, 170, 85, 0.3);
                padding-left: 1rem;
            }

            .code-display-body pre code .indent-level-3,
            .code-block pre code .indent-level-3 {
                border-left: 2px solid rgba(255, 255, 85, 0.3);
                padding-left: 1rem;
            }

            .code-display-body pre code .indent-level-4,
            .code-block pre code .indent-level-4 {
                border-left: 2px solid rgba(85, 255, 85, 0.3);
                padding-left: 1rem;
            }

            .code-display-body pre code .indent-level-5,
            .code-block pre code .indent-level-5 {
                border-left: 2px solid rgba(85, 170, 255, 0.3);
                padding-left: 1rem;
            }

            .code-display-body pre code .indent-level-6,
            .code-block pre code .indent-level-6 {
                border-left: 2px solid rgba(170, 85, 255, 0.3);
                padding-left: 1rem;
            }

            /* Mejoras visuales para la consola de código */
            .code-display-panel pre,
            .code-block pre {
                background-color: #1e1e2e !important;
                border-radius: 8px;
                position: relative;
            }

            .code-display-panel pre code,
            .code-block pre code {
                font-family: var(--font-mono);
                font-size: 0.9rem;
                line-height: 1.7;
                color: #c0caf5;
            }

            /* Colores de sintaxis mejorados para Python */
            .code-block pre code.language-python .token.keyword {
                color: #bb9af7;
                font-weight: 600;
            }

            .code-block pre code.language-python .token.string {
                color: #9ece6a;
            }

            .code-block pre code.language-python .token.number {
                color: #ff9e64;
            }

            .code-block pre code.language-python .token.comment {
                color: #565f89;
                font-style: italic;
            }

            .code-block pre code.language-python .token.function {
                color: #7aa2f7;
            }

            .code-block pre code.language-python .token.operator {
                color: #89ddff;
            }

            .code-block pre code.language-python .token.punctuation {
                color: #a9b1d6;
            }

            .code-block pre code.language-python .token.boolean {
                color: #ff9e64;
                font-weight: 600;
            }
        </style></head>
<body>
    <div class="background-container">
    <div class="background-day"></div>
    <div class="background-night"></div>
</div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="fixed inset-0 bg-gray-900 bg-opacity-90 z-50 hidden items-center justify-center flex-col transition-opacity duration-300">
        <div class="relative w-24 h-24 mb-4">
            <div class="absolute inset-0 border-4 border-t-blue-500 border-r-transparent border-b-purple-500 border-l-transparent rounded-full animate-spin"></div>
            <div class="absolute inset-2 border-4 border-t-transparent border-r-blue-400 border-b-transparent border-l-purple-400 rounded-full animate-spin-reverse"></div>
            <div class="absolute inset-0 flex items-center justify-center">
                <i data-lucide="loader-2" class="w-8 h-8 text-white animate-pulse"></i>
            </div>
        </div>
        <p id="loading-message" class="text-xl font-bold text-white tracking-wider animate-pulse">CARGANDO PYTHON...</p>
    </div>

<div class="content-box">
    <!-- Panel de Selección de Nivel -->
    <div id="level-selection-panel" class="panel active flex-col items-center justify-center p-4 relative">
        
        <!-- HEADER / NAVBAR SIMPLIFICADO -->
        <div class="w-full flex justify-between items-center mb-8">
            <a href="menu_inicio.html" class="flex items-center gap-2 hover:opacity-80 transition-opacity" title="Volver al Menú Principal">
                <i data-lucide="terminal" class="w-8 h-8 text-blue-400"></i>
                <span class="font-bold text-xl text-blue-100">Status Code 418</span>
            </a>
            <div class="flex items-center gap-4">
                <a href="menu_inicio.html" class="hidden md:flex items-center gap-2 text-sm text-gray-400 hover:text-white transition-colors border border-gray-700 rounded-lg px-3 py-1.5 hover:border-accent">
                    <i data-lucide="arrow-left" class="w-4 h-4"></i>
                    Volver al Hub
                </a>
<!-- Chat Button Removed -->
                
<!-- Store Button Removed -->

                <div class="w-px h-6 bg-white/20 mx-2"></div>
                <button id="theme-toggle" class="p-2 rounded-full hover:bg-white/10 transition-colors">
                    <i id="theme-icon" data-lucide="sun" class="w-5 h-5 text-gray-300"></i>
                </button>
            </div>
        </div>
        <h1 class="text-4xl font-bold mb-2" style="color: var(--accent);">Curso de Python</h1>
        <p class="mb-8">Aprende Python, uno de los lenguajes de programación más populares y versátiles.</p>
        <div id="level-grid"></div>


    </div>

    <!-- Panel de Lección -->
    <div id="lesson-panel" class="panel flex-col p-4 md:p-8">
        <div class="flex-grow w-full max-w-4xl mx-auto flex flex-col">
            <header class="flex items-center justify-between mb-4">
                <h2 id="lesson-title" class="text-2xl md:text-3xl font-bold"></h2>
                <button id="close-lesson-btn" class="p-2 rounded-full hover:bg-gray-700">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </header>
            <div class="w-full progress-bar-bg rounded-full h-2.5 mb-6">
                <div id="lesson-progress" class="progress-bar-fill h-2.5 rounded-full" style="width: 10%;"></div>
            </div>
            <div id="lesson-content" class="flex-grow prose prose-invert max-w-none prose-p:text-lg prose-headings:text-white prose-strong:text-white overflow-y-auto"></div>

            <footer class="flex justify-between items-center mt-6">
                <button id="prev-btn" class="btn-primary" disabled>Anterior</button>
                <span id="lesson-step" class="font-mono">1 / 10</span>
                <button id="next-btn" class="btn-primary">Siguiente</button>
            </footer>
        </div>
    </div>

    <!-- Panel de Quiz -->
    <div id="quiz-panel" class="panel flex-col items-center justify-center p-4">
        <div class="w-full max-w-4xl">
            <header class="flex justify-between items-center mb-6">
                <div>
                    <h2 id="quiz-level-title" class="text-2xl font-bold">Quiz - Nivel 1</h2>
                    <div id="quiz-type-indicator" class="quiz-type-indicator hidden"></div>
                </div>
                <span id="quiz-progress" class="font-mono text-lg">1/10</span>
            </header>
            <p id="quiz-question" class="text-xl md:text-2xl mb-8"></p>

            <!-- Contenedor para diferentes tipos de preguntas -->
            <div id="quiz-content">
                <!-- Selección múltiple (por defecto) -->
                <div id="multiple-choice-container" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>

                <!-- Completar código -->
                <div id="code-completion-container" class="hidden">
                    <div class="code-block rounded-lg overflow-hidden mt-4">
                        <div class="code-block-header px-4 py-2 flex items-center gap-2">
                            <span class="w-3 h-3 bg-red-500 rounded-full"></span>
                            <span class="w-3 h-3 bg-yellow-500 rounded-full"></span>
                            <span class="w-3 h-3 bg-green-500 rounded-full"></span>
                        </div>
                        <pre id="code-completion-code" class="p-4"><code class="language-python"></code></pre>
                    </div>
                </div>

                <!-- Arrastrar y soltar -->
                <div id="drag-drop-container" class="hidden drag-drop-container"></div>

                <!-- Emparejamiento -->
                <div id="matching-container" class="hidden matching-container"></div>

                <!-- Ordenar código -->
                <div id="ordering-container" class="hidden ordering-container"></div>

                <!-- Encontrar errores -->
                <div id="error-finding-container" class="hidden error-finding-container"></div>
            </div>

            <div id="quiz-feedback" class="quiz-feedback hidden"></div>

            <div class="flex justify-between items-center mt-8">
                <button id="quiz-hint-btn" class="btn-primary">Pista</button>
                
            </div>
        </div>
    </div>

    <!-- Panel de Resultados -->
    <div id="results-panel" class="panel flex-col items-center justify-center text-center p-4">
        <i id="results-icon" class="w-24 h-24 mb-6"></i>
        <h2 id="results-title" class="text-4xl font-bold mb-4"></h2>
        <p id="results-score" class="text-2xl mb-2"></p>
        <p id="results-message" class="mb-8"></p>
        <div class="flex gap-4">
            <button id="retry-lesson-btn" class="btn-primary">Repetir Lección</button>
            <button id="next-level-btn" class="btn-primary hidden">Siguiente Nivel</button>
            <a id="code-challenge-btn" href="#" class="btn-primary hidden" style="background-color: var(--accent); color: white; display: flex; align-items: center; gap: 0.5rem; text-decoration: none;">
                <i data-lucide="code"></i> Ir al Desafío
            </a>
        </div>
    </div>

    <!-- Panel de Práctica -->

</div>

<!-- Floating Chat Button -->
<!-- Floating Chat Button Removed -->

<!-- Chat Modal -->
<!-- Chat Modal Removed -->

<script>
// Datos de Práctica
const practiceData = [
    {
        title: "Práctica 1: Variables y Tipos de Datos",
        content: `<h3>Ejercicios Básicos</h3>
        <p>Crea un programa que:</p>
        <ol>
        <li>Pida al usuario su nombre y edad usando input()</li>
        <li>Convierta la edad a entero</li>
        <li>Muestre un mensaje personalizado</li>
        </ol>
        <div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python"># Tu código aquí
nombre = input("Ingresa tu nombre: ")
edad = int(input("Ingresa tu edad: "))
print(f"Hola {nombre}, tienes {edad} años!")</code></pre></div>`
    },
    {
        title: "Práctica 1.1: Encontrar Errores",
        content: `<h3>Encuentra los Errores</h3>
        <p>Haz clic en las partes del código que están incorrectas para corregirlas.</p>
        <div class="command-list mt-2 mb-2">
            <strong>Comandos disponibles:</strong> input, int, print, f-string
            <div class="command-counter mt-1">
                <span id="command-counter-1">Usados: 0/4</span>
            </div>
        </div>
        <div id="error-code-1" class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python">nombre = input("Ingresa tu nombre: ")
edad = input("Ingresa tu edad: ")
print("Hola {nombre}, tienes {edad} años!")</code></pre></div>
        <button id="give-up-1" class="btn-primary mt-4">Rendirme y Ver Solución</button>
        <div id="solution-1" class="hidden mt-4">
            <p><strong>Solución:</strong></p>
            <pre><code class="language-python">nombre = input("Ingresa tu nombre: ")
edad = int(input("Ingresa tu edad: "))
print(f"Hola {nombre}, tienes {edad} años!")</code></pre>
        </div>`
    },
    {
        title: "Práctica 1.2: Completar Código",
        content: `<h3>Completa el Código</h3>
        <p>Arrastra los comandos disponibles a los huecos correctos.</p>
        <div class="command-list mt-2 mb-2">
            <strong>Comandos disponibles:</strong>
            <div class="command-palette mt-2 flex flex-wrap gap-2" id="command-palette-1">
                <div class="command-item bg-blue-500 text-white px-3 py-1 rounded cursor-move" draggable="true" data-command="input">input</div>
                <div class="command-item bg-blue-500 text-white px-3 py-1 rounded cursor-move" draggable="true" data-command="int">int</div>
                <div class="command-item bg-blue-500 text-white px-3 py-1 rounded cursor-move" draggable="true" data-command="print">print</div>
                <div class="command-item bg-blue-500 text-white px-3 py-1 rounded cursor-move" draggable="true" data-command="f">f</div>
            </div>
            <div class="command-counter mt-1">
                <span id="command-counter-fill-1">Completados: 0/4</span>
            </div>
        </div>
        <div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python"># Tu código aquí
nombre = <span class="drop-zone border-2 border-dashed border-gray-400 p-1 rounded" data-fill="1"></span>("Ingresa tu nombre: ")
edad = <span class="drop-zone border-2 border-dashed border-gray-400 p-1 rounded" data-fill="2"></span>(<span class="drop-zone border-2 border-dashed border-gray-400 p-1 rounded" data-fill="3"></span>("Ingresa tu edad: "))
print(<span class="drop-zone border-2 border-dashed border-gray-400 p-1 rounded" data-fill="4"></span>("Hola {nombre}, tienes {edad} años!"))</code></pre></div>
        <div class="mt-4">
            
            <button id="reset-fill-1" class="btn-primary ml-2">Reiniciar</button>
        </div>
        <div id="fill-feedback-1" class="mt-2"></div>`
    },
    {
        title: "Práctica 2: Operadores y Condicionales",
        content: `<h3>Ejercicios con Lógica</h3>
        <p>Crea un programa que:</p>
        <ol>
        <li>Pida dos números al usuario</li>
        <li>Realice operaciones básicas (+, -, *, /)</li>
        <li>Determine cuál es mayor</li>
        </ol>
        <div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python"># Tu código aquí
num1 = float(input("Primer número: "))
num2 = float(input("Segundo número: "))
print(f"Suma: {num1 + num2}")
print(f"Resta: {num1 - num2}")
print(f"Multiplicación: {num1 * num2}")
if num2 != 0:
   print(f"División: {num1 / num2}")
else:
   print("No se puede dividir por cero")
if num1 > num2:
   print(f"{num1} es mayor")
elif num2 > num1:
   print(f"{num2} es mayor")
else:
   print("Son iguales")</code></pre></div>`
    },
    {
        title: "Práctica 2.1: Encontrar Errores en Condicionales",
        content: `<h3>Encuentra los Errores</h3>
        <p>Haz clic en las partes del código que están incorrectas.</p>
        <div class="command-list mt-2 mb-2">
            <strong>Comandos disponibles:</strong> float, input, print, f-string, if, elif, else
            <div class="command-counter mt-1">
                <span id="command-counter-2">Usados: 0/7</span>
            </div>
        </div>
        <div id="error-code-2" class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python">num1 = input("Primer número: ")
num2 = input("Segundo número: ")
print(f"Suma: {num1 + num2}")
if num1 > num2
   print(f"{num1} es mayor")
else num2 > num1:
   print(f"{num2} es mayor")
else:
   print("Son iguales")</code></pre></div>
        <button id="give-up-2" class="btn-primary mt-4">Rendirme y Ver Solución</button>
        <div id="solution-2" class="hidden mt-4">
            <p><strong>Solución:</strong></p>
            <pre><code class="language-python">num1 = float(input("Primer número: "))
num2 = float(input("Segundo número: "))
print(f"Suma: {num1 + num2}")
print(f"Resta: {num1 - num2}")
print(f"Multiplicación: {num1 * num2}")
if num2 != 0:
   print(f"División: {num1 / num2}")
else:
   print("No se puede dividir por cero")
if num1 > num2:
   print(f"{num1} es mayor")
elif num2 > num1:
   print(f"{num2} es mayor")
else:
   print("Son iguales")</code></pre>
        </div>`
    },
    {
        title: "Práctica 2.2: Completar Código con Condicionales",
        content: `<h3>Completa el Código</h3>
        <p>Arrastra los comandos disponibles a los huecos correctos.</p>
        <div class="command-list mt-2 mb-2">
            <strong>Comandos disponibles:</strong>
            <div class="command-palette mt-2 flex flex-wrap gap-2" id="command-palette-2">
                <div class="command-item bg-blue-500 text-white px-3 py-1 rounded cursor-move" draggable="true" data-command="float">float</div>
                <div class="command-item bg-blue-500 text-white px-3 py-1 rounded cursor-move" draggable="true" data-command="input">input</div>
                <div class="command-item bg-blue-500 text-white px-3 py-1 rounded cursor-move" draggable="true" data-command="print">print</div>
                <div class="command-item bg-blue-500 text-white px-3 py-1 rounded cursor-move" draggable="true" data-command="f">f</div>
                <div class="command-item bg-blue-500 text-white px-3 py-1 rounded cursor-move" draggable="true" data-command="if">if</div>
                <div class="command-item bg-blue-500 text-white px-3 py-1 rounded cursor-move" draggable="true" data-command="elif">elif</div>
                <div class="command-item bg-blue-500 text-white px-3 py-1 rounded cursor-move" draggable="true" data-command="else">else</div>
            </div>
            <div class="command-counter mt-1">
                <span id="command-counter-fill-2">Completados: 0/14</span>
            </div>
        </div>
        <div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python">num1 = <span class="drop-zone border-2 border-dashed border-gray-400 p-1 rounded" data-fill="5"></span>(<span class="drop-zone border-2 border-dashed border-gray-400 p-1 rounded" data-fill="6"></span>("Primer número: "))
num2 = <span class="drop-zone border-2 border-dashed border-gray-400 p-1 rounded" data-fill="7"></span>(<span class="drop-zone border-2 border-dashed border-gray-400 p-1 rounded" data-fill="8"></span>("Segundo número: "))
print(<span class="drop-zone border-2 border-dashed border-gray-400 p-1 rounded" data-fill="9"></span>("Suma: {num1 + num2}"))
print(<span class="drop-zone border-2 border-dashed border-gray-400 p-1 rounded" data-fill="10"></span>("Resta: {num1 - num2}"))
print(<span class="drop-zone border-2 border-dashed border-gray-400 p-1 rounded" data-fill="11"></span>("Multiplicación: {num1 * num2}"))
<span class="drop-zone border-2 border-dashed border-gray-400 p-1 rounded" data-fill="12"></span> num2 != 0:
   print(<span class="drop-zone border-2 border-dashed border-gray-400 p-1 rounded" data-fill="13"></span>("División: {num1 / num2}"))
<span class="drop-zone border-2 border-dashed border-gray-400 p-1 rounded" data-fill="14"></span>:
   print("No se puede dividir por cero")
<span class="drop-zone border-2 border-dashed border-gray-400 p-1 rounded" data-fill="15"></span> num1 > num2:
   print(<span class="drop-zone border-2 border-dashed border-gray-400 p-1 rounded" data-fill="16"></span>("{num1} es mayor"))
<span class="drop-zone border-2 border-dashed border-gray-400 p-1 rounded" data-fill="17"></span> num2 > num1:
   print(<span class="drop-zone border-2 border-dashed border-gray-400 p-1 rounded" data-fill="18"></span>("{num2} es mayor"))
<span class="drop-zone border-2 border-dashed border-gray-400 p-1 rounded" data-fill="19"></span>:
   print("Son iguales")</code></pre></div>
        <div class="mt-4">
            
            <button id="reset-fill-2" class="btn-primary ml-2">Reiniciar</button>
        </div>
        <div id="fill-feedback-2" class="mt-2"></div>`
    },
    {
        title: "Práctica 3: Bucles",
        content: `<h3>Ejercicios con Repetición</h3>
        <p>Crea un programa que:</p>
        <ol>
        <li>Pida un número al usuario</li>
        <li>Muestre la tabla de multiplicar de ese número (del 1 al 10)</li>
        <li>Use un bucle for</li>
        </ol>
        <div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python"># Tu código aquí
numero = int(input("Ingresa un número: "))
for i in range(1, 11):
    print(f"{numero} x {i} = {numero * i}")</code></pre></div>`
    },
    {
        title: "Práctica 4: Listas y Funciones",
        content: `<h3>Ejercicios con Colecciones</h3>
        <p>Crea funciones que:</p>
        <ol>
        <li>Reciba una lista de números</li>
        <li>Devuelva el promedio</li>
        <li>Encuentre el número mayor</li>
        </ol>
        <div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python"># Tu código aquí
def calcular_promedio(numeros):
    return sum(numeros) / len(numeros)

def encontrar_mayor(numeros):
    return max(numeros)

# Prueba las funciones
lista = [10, 20, 30, 40, 50]
print(f"Promedio: {calcular_promedio(lista)}")
print(f"Mayor: {encontrar_mayor(lista)}")</code></pre></div>`
    },
    {
        title: "Práctica 5: Proyecto Final",
        content: `<h3>Aplicación Completa</h3>
        <p>Crea un programa que:</p>
        <ol>
        <li>Sea un sistema de gestión de estudiantes</li>
        <li>Permita agregar estudiantes con nombre y calificaciones</li>
        <li>Muestre el promedio de cada estudiante</li>
        <li>Liste todos los estudiantes ordenados por promedio</li>
        </ol>
        <div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python"># Tu código aquí
estudiantes = []

def agregar_estudiante():
    nombre = input("Nombre del estudiante: ")
    calificaciones = []
    for i in range(3):
        calif = float(input(f"Calificación {i+1}: "))
        calificaciones.append(calif)
    estudiantes.append({"nombre": nombre, "calificaciones": calificaciones})

def calcular_promedio(calificaciones):
    return sum(calificaciones) / len(calificaciones)

# Agregar algunos estudiantes
for _ in range(2):
    agregar_estudiante()

# Mostrar resultados
for estudiante in estudiantes:
    prom = calcular_promedio(estudiante["calificaciones"])
    print(f"{estudiante['nombre']}: {prom:.2f}")

# Ordenar por promedio
estudiantes.sort(key=lambda x: calcular_promedio(x["calificaciones"]), reverse=True)
print("\\nOrdenados por promedio:")
for estudiante in estudiantes:
    prom = calcular_promedio(estudiante["calificaciones"])
    print(f"{estudiante['nombre']}: {prom:.2f}")</code></pre></div>`
    }
];

const courseData = [
    { // Nivel 1
        title: "Variables y Tipos de Datos",
        lesson: [
            { 
                title: "¿Qué es una Variable?", 
                content: `<p>Una <strong>variable</strong> es un espacio en la memoria del computador que almacena un valor. En Python, crear una variable es tan simple como asignar un valor usando el operador de asignación <code>=</code>.</p>
                <p>A diferencia de lenguajes como C++ o Java, Python es <strong>dinámicamente tipado</strong>, lo que significa que no necesitas declarar el tipo de dato de antemano. El intérprete lo infiere automáticamente según el valor asignado.</p>
                <div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python"># Declaración simple de variables
nombre = "Ana"
edad = 25
altura = 1.75
es_estudiante = True

# Reasignación con diferente tipo
edad = "veinticinco"  # Ahora es string
edad = 25.5           # Ahora es float</code></pre></div>`
            },
            { 
                title: "Tipos de Datos Primitivos", 
                content: `<p>Python tiene cuatro tipos de datos primitivos fundamentales:</p>
                <ul>
                    <li><strong>String (str)</strong>: Cadenas de texto. Ejemplo: <code>"Hola"</code></li>
                    <li><strong>Integer (int)</strong>: Números enteros. Ejemplo: <code>42</code></li>
                    <li><strong>Float</strong>: Números decimales. Ejemplo: <code>3.14</code></li>
                    <li><strong>Boolean (bool)</strong>: <code>True</code> o <code>False</code></li>
                </ul>
                <div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python">texto = "Python"
numero = 100
decimal = 3.14
activo = True

print(type(texto))   # <class 'str'>
print(type(numero))  # <class 'int'></code></pre></div>`
            },
            { 
                title: "Funciones print() e input()", 
                content: `<p>La función <code>print()</code> muestra información. La función <code>input()</code> captura datos del usuario.</p>
                <div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python">print("Hola Mundo")

nombre = input("¿Tu nombre? ")
edad = int(input("¿Tu edad? "))

print(f"Hola {nombre}, tienes {edad} años")</code></pre></div>`
            },
            { 
                title: "Código Completo y Consola Interactiva", 
                content: `<h3>Prueba el Código</h3>
                <div id="console-nivel-1" data-code="nombre = input(&quot;¿Cómo te llamas? &quot;)
edad = int(input(&quot;¿Cuántos años tienes? &quot;))

print(&quot;\\nHola {}!&quot;.format(nombre))
año_nacimiento = 2025 - edad
print(&quot;Naciste en {}&quot;.format(año_nacimiento))
print(&quot;Has vivido {} meses&quot;.format(edad * 12))"></div>`
            }
        ],
        quiz: [
            { type: "multiple-choice", question: "¿Qué función muestra información?", options: ["input()", "print()", "show()", "display()"], answer: "print()" },
            { type: "multiple-choice", question: "¿Qué devuelve input()?", options: ["int", "str", "float", "Depende"], answer: "str" },
            { type: "multiple-choice", question: "¿Cómo crear f-string?", options: ["s\"texto\"", "f\"texto\"", "format()", "str()"], answer: "f\"texto\"" },
            { type: "multiple-choice", question: "¿Convertir a entero?", options: ["int()", "str()", "float()", "number()"], answer: "int()" },
            { type: "multiple-choice", question: "Python dinámicamente tipado significa:", options: ["No tiene tipos", "Infiere tipos", "Solo strings", "Requiere declaración"], answer: "Infiere tipos" }
        ]
    },
    { // Nivel 2
        title: "Operadores Matemáticos",
        lesson: [
            { 
                title: "Operadores Básicos", 
                content: `<p>Python soporta operadores aritméticos estándar con precedencia definida.</p>
                <div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python">suma = 5 + 3          # 8
resta = 10 - 4        # 6
multiplicacion = 6 * 7  # 42
division = 15 / 3     # 5.0

division_entera = 17 // 5   # 3
modulo = 17 % 5             # 2
potencia = 2 ** 3           # 8</code></pre></div>`
            },
            { 
                title: "Orden de Operaciones", 
                content: `<p>Python sigue PEMDAS: Paréntesis, Exponentes, Multiplicación/División, Adición/Sustracción.</p>
                <div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python">resultado = 2 + 3 * 4    # 14
resultado = (2 + 3) * 4  # 20

precio = (100 * 0.85) * 1.21  # Con descuento e IVA</code></pre></div>`
            },
            { 
                title: "Código Completo y Consola Interactiva", 
                content: `<h3>Calculadora</h3>
                <div id="console-nivel-2" data-code="num1 = float(input(&quot;Primer número: &quot;))
num2 = float(input(&quot;Segundo número: &quot;))

print(f&quot;\\n{num1} + {num2} = {num1 + num2}&quot;)
print(f&quot;{num1} - {num2} = {num1 - num2}&quot;)
print(f&quot;{num1} * {num2} = {num1 * num2}&quot;)

if num2 != 0:
    print(f&quot;{num1} / {num2} = {num1 / num2:.2f}&quot;)
    print(f&quot;{num1} // {num2} = {num1 // num2}&quot;)
else:
    print(&quot;No se puede dividir por cero&quot;)"></div>`
            }
        ],
        quiz: [
            { type: "multiple-choice", question: "¿Resultado de 10 // 3?", options: ["3.33", "3", "4", "3.0"], answer: "3" },
            { type: "multiple-choice", question: "¿Operador para resto?", options: ["/", "//", "%", "**"], answer: "%" },
            { type: "multiple-choice", question: "¿Resultado de 2 ** 3?", options: ["6", "8", "9", "5"], answer: "8" },
            { type: "multiple-choice", question: "¿Qué hace x += 5?", options: ["Suma 5 a x", "Compara", "Resta", "Multiplica"], answer: "Suma 5 a x" },
            { type: "multiple-choice", question: "¿Resultado de 5 + 3 * 2?", options: ["16", "11", "13", "10"], answer: "11" }
        ]
    },
    { // Nivel 3
        title: "Operadores de Comparación y Lógicos",
        lesson: [
            { 
                title: "Operadores de Comparación", 
                content: `<p>Los operadores de comparación comparan dos valores y devuelven <code>True</code> o <code>False</code>.</p>
                <div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python"># Comparaciones básicas
5 == 5   # True (igual a)
5 != 3   # True (diferente de)
7 > 3    # True (mayor que)
2 < 8    # True (menor que)
5 >= 5   # True (mayor o igual)
3 <= 2   # False (menor o igual)

# Comparar strings
"python" == "Python"  # False (case-sensitive)
"abc" < "xyz"         # True (orden alfabético)</code></pre></div>`
            },
            { 
                title: "Operadores Lógicos", 
                content: `<p>Los operadores lógicos combinan condiciones booleanas.</p>
                <div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python"># and - ambas condiciones deben ser True
edad = 20
tiene_licencia = True
puede_conducir = edad >= 18 and tiene_licencia  # True

# or - al menos una condición debe ser True
es_fin_semana = dia == "sábado" or dia == "domingo"

# not - invierte el valor
no_es_menor = not (edad < 18)  # True</code></pre></div>`
            },
            { 
                title: "Código Completo y Consola Interactiva", 
                content: `<h3>Verificador de Condiciones</h3>
                <div id="console-nivel-3" data-code="edad = int(input(&quot;¿Cuántos años tienes? &quot;))
nota = float(input(&quot;¿Qué nota sacaste? &quot;))

if edad &gt;= 18:
    categoria = &quot;adulto&quot;
elif edad &gt;= 13:
    categoria = &quot;adolescente&quot;
else:
    categoria = &quot;niño&quot;

aprobado = nota &gt;= 70

print(&quot;\\nEres {}&quot;.format(categoria))
print(&quot;Nota: {}&quot;.format(nota))
if aprobado:
    print(&quot;¡Aprobaste!&quot;)
else:
    print(&quot;Necesitas estudiar más&quot;)"></div>`
            }
        ],
        quiz: [
            { type: "multiple-choice", question: "¿Qué devuelve 5 == 5?", options: ["5", "True", "False", "Error"], answer: "True" },
            { type: "multiple-choice", question: "Operador para 'diferente de':", options: ["<>", "=/=", "!=", "not"], answer: "!=" },
            { type: "multiple-choice", question: "¿Qué devuelve True and False?", options: ["True", "False", "Error", "None"], answer: "False" },
            { type: "multiple-choice", question: "¿Qué devuelve True or False?", options: ["True", "False", "Error", "None"], answer: "True" },
            { type: "multiple-choice", question: "¿Qué hace not?", options: ["Suma", "Resta", "Invierte", "Compara"], answer: "Invierte" }
        ]
    },
    { // Nivel 4
        title: "Condicionales (if, elif, else)",
        lesson: [
            { 
                title: "La sentencia if", 
                content: `<p>La sentencia <code>if</code> ejecuta código solo si una condición es verdadera.</p>
                <div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python">edad = 20
if edad >= 18:
    print("Eres mayor de edad")
    print("Puedes votar")</code></pre></div>`
            },
            { 
                title: "if-else y elif", 
                content: `<p><code>else</code> se ejecuta cuando el if es falso. <code>elif</code> permite múltiples condiciones.</p>
                <div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python">calificacion = 85
if calificacion >= 90:
    print("Excelente")
elif calificacion >= 80:
    print("Muy bien")
elif calificacion >= 70:
    print("Bien")
else:
    print("Necesitas mejorar")</code></pre></div>`
            },
            { 
                title: "Código Completo y Consola Interactiva", 
                content: `<h3>Clasificador de Edad</h3>
                <div id="console-nivel-4" data-code="edad = int(input(&quot;¿Cuántos años tienes? &quot;))

if edad &lt; 13:
    print(&quot;Eres un niño&quot;)
    actividad = &quot;jugar&quot;
elif edad &lt; 18:
    print(&quot;Eres adolescente&quot;)
    actividad = &quot;estudiar&quot;
elif edad &lt; 60:
    print(&quot;Eres adulto&quot;)
    actividad = &quot;trabajar&quot;
else:
    print(&quot;Eres adulto mayor&quot;)
    actividad = &quot;disfrutar&quot;

print(&quot;Actividad: {}&quot;.format(actividad))"></div>`
            }
        ],
        quiz: [
            { type: "multiple-choice", question: "¿Palabra clave para condicionales?", options: ["when", "if", "switch", "case"], answer: "if" },
            { type: "multiple-choice", question: "¿Qué se ejecuta si if es falso?", options: ["if", "elif", "else", "then"], answer: "else" },
            { type: "multiple-choice", question: "¿Múltiples elif permitidos?", options: ["Verdadero", "Falso"], answer: "Verdadero" },
            { type: "multiple-choice", question: "¿Cómo se definen bloques?", options: ["Llaves {}", "Paréntesis ()", "Indentación", "Punto y coma"], answer: "Indentación" },
            { type: "multiple-choice", question: "Estructura correcta:", options: ["if condition: code", "if condition { code }", "if (condition) code", "if condition then code"], answer: "if condition: code" }
        ]
    },
    { // Nivel 5
        title: "Bucles (for y while)",
        lesson: [
            { 
                title: "El bucle for", 
                content: `<p>El bucle <code>for</code> itera sobre secuencias.</p>
                <div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python">for i in range(5):
    print(i)  # 0, 1, 2, 3, 4

frutas = ["manzana", "banana"]
for fruta in frutas:
    print(fruta)</code></pre></div>`
            },
            { 
                title: "El bucle while", 
                content: `<p>El bucle <code>while</code> se ejecuta mientras la condición sea verdadera.</p>
                <div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python">contador = 0
while contador < 5:
    print(contador)
    contador += 1</code></pre></div>`
            },
            { 
                title: "break y continue", 
                content: `<p><code>break</code> sale del bucle. <code>continue</code> salta a la siguiente iteración.</p>
                <div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python">for i in range(10):
    if i == 5:
        break
    if i % 2 == 0:
        continue
    print(i)</code></pre></div>`
            },
            { 
                title: "Código Completo y Consola Interactiva", 
                content: `<h3>Suma de Números</h3>
                <div id="console-nivel-5" data-code="n = int(input(&quot;¿Hasta qué número sumar? &quot;))

suma = 0
for i in range(1, n + 1):
    suma += i
    print(&quot;{} → suma: {}&quot;.format(i, suma))

print(&quot;\\nResultado: {}&quot;.format(suma))"></div>`
            }
        ],
        quiz: [
            { type: "multiple-choice", question: "¿Bucle para iterar secuencias?", options: ["while", "for", "if", "loop"], answer: "for" },
            { type: "multiple-choice", question: "¿Salir de bucle?", options: ["continue", "exit", "stop", "break"], answer: "break" },
            { type: "multiple-choice", question: "while se ejecuta mientras:", options: ["Condición True", "Condición False", "Siempre", "Nunca"], answer: "Condición True" },
            { type: "multiple-choice", question: "¿Qué hace continue?", options: ["Termina", "Salta iteración", "Reinicia", "Error"], answer: "Salta iteración" },
            { type: "multiple-choice", question: "¿Qué genera range(3)?", options: ["1, 2, 3", "0, 1, 2", "0, 1, 2, 3", "1, 2"], answer: "0, 1, 2" }
        ]
    },
    { // Nivel 6
        title: "Funciones",
        lesson: [
            { 
                title: "Definir Funciones", 
                content: `<p>Las funciones son bloques de código reutilizables.</p>
                <div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python">def saludar():
    print("¡Hola!")

saludar()  # Llamar la función</code></pre></div>`
            },
            { 
                title: "Parámetros y Return", 
                content: `<p>Las funciones pueden recibir parámetros y devolver valores.</p>
                <div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python">def sumar(a, b):
    return a + b

resultado = sumar(3, 5)  # 8</code></pre></div>`
            },
            { 
                title: "Código Completo y Consola Interactiva", 
                content: `<h3>Calculadora con Funciones</h3>
                <div id="console-nivel-6" data-code="def sumar(a, b):
    return a + b

def restar(a, b):
    return a - b

num1 = float(input(&quot;Primer número: &quot;))
num2 = float(input(&quot;Segundo número: &quot;))

print(&quot;\\nSuma: {}&quot;.format(sumar(num1, num2)))
print(&quot;Resta: {}&quot;.format(restar(num1, num2)))"></div>`
            }
        ],
        quiz: [
            { type: "multiple-choice", question: "¿Cómo definir función?", options: ["function", "def", "func", "define"], answer: "def" },
            { type: "multiple-choice", question: "¿Devolver valor?", options: ["send", "return", "yield", "give"], answer: "return" },
            { type: "multiple-choice", question: "¿Función necesita return?", options: ["Verdadero", "Falso"], answer: "Falso" },
            { type: "multiple-choice", question: "¿Qué es un argumento?", options: ["Tipo de dato", "Variable interna", "Valor pasado", "Nombre función"], answer: "Valor pasado" },
            { type: "multiple-choice", question: "Llamar función:", options: ["nombre()", "call nombre", "run nombre", "exec nombre"], answer: "nombre()" }
        ]
    },
    { // Nivel 7
        title: "Listas",
        lesson: [
            { 
                title: "Crear y Acceder Listas", 
                content: `<p>Las listas almacenan múltiples valores.</p>
                <div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python">frutas = ["manzana", "banana", "naranja"]
print(frutas[0])   # manzana
print(frutas[-1])  # naranja (último)</code></pre></div>`
            },
            { 
                title: "Métodos de Listas", 
                content: `<p>Las listas tienen métodos para modificarlas.</p>
                <div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python">numeros = [1, 2, 3]
numeros.append(4)      # [1, 2, 3, 4]
numeros.insert(0, 0)   # [0, 1, 2, 3, 4]
numeros.remove(2)      # [0, 1, 3, 4]</code></pre></div>`
            },
            { 
                title: "Código Completo y Consola Interactiva", 
                content: `<h3>Gestor de Tareas</h3>
                <div id="console-nivel-7" data-code="tareas = []

for i in range(3):
    tarea = input(&quot;Tarea {}: &quot;.format(i+1))
    tareas.append(tarea)

print(&quot;\\nTus tareas:&quot;)
for i, tarea in enumerate(tareas, 1):
    print(&quot;{}. {}&quot;.format(i, tarea))"></div>`
            }
        ],
        quiz: [
            { type: "multiple-choice", question: "¿Agregar al final?", options: ["insert()", "add()", "append()", "extend()"], answer: "append()" },
            { type: "multiple-choice", question: "¿Índice primer elemento?", options: ["1", "0", "-1", "first"], answer: "0" },
            { type: "multiple-choice", question: "¿Listas son inmutables?", options: ["Verdadero", "Falso"], answer: "Falso" },
            { type: "multiple-choice", question: "¿Qué devuelve lista[-1]?", options: ["Primero", "Último", "Segundo", "Error"], answer: "Último" },
            { type: "multiple-choice", question: "pop() sin argumentos:", options: ["Elimina primero", "Elimina último", "Error", "No hace nada"], answer: "Elimina último" }
        ]
    },
    { // Nivel 8
        title: "Diccionarios",
        lesson: [
            { 
                title: "Crear Diccionarios", 
                content: `<p>Los diccionarios almacenan pares clave-valor.</p>
                <div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python">persona = {
    "nombre": "Ana",
    "edad": 25,
    "ciudad": "Madrid"
}
print(persona["nombre"])  # Ana</code></pre></div>`
            },
            { 
                title: "Métodos de Diccionarios", 
                content: `<p>Los diccionarios tienen métodos útiles.</p>
                <div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python">persona.keys()    # Claves
persona.values()  # Valores
persona.items()   # Pares clave-valor</code></pre></div>`
            },
            { 
                title: "Código Completo y Consola Interactiva", 
                content: `<h3>Agenda de Contactos</h3>
                <div id="console-nivel-8" data-code="contactos = {}

for i in range(2):
    nombre = input(&quot;Nombre {}: &quot;.format(i+1))
    telefono = input(&quot;Teléfono: &quot;)
    contactos[nombre] = telefono

print(&quot;\\nContactos:&quot;)
for nombre, tel in contactos.items():
    print(&quot;{}: {}&quot;.format(nombre, tel))"></div>`
            }
        ],
        quiz: [
            { type: "multiple-choice", question: "¿Qué almacenan diccionarios?", options: ["Solo valores", "Pares clave-valor", "Solo claves", "Números"], answer: "Pares clave-valor" },
            { type: "multiple-choice", question: "¿Acceder a valor?", options: ["dict(clave)", "dict.get(clave)", "dict[clave]", "b y c"], answer: "b y c" },
            { type: "multiple-choice", question: "¿Claves únicas?", options: ["Verdadero", "Falso"], answer: "Verdadero" },
            { type: "multiple-choice", question: "¿Obtener claves?", options: ["get_keys()", "keys()", "values()", "items()"], answer: "keys()" },
            { type: "multiple-choice", question: "¿Diccionarios mutables?", options: ["Verdadero", "Falso"], answer: "Verdadero" }
        ]
    },
    { // Nivel 9
        title: "Tuplas y Sets",
        lesson: [
            { 
                title: "Tuplas", 
                content: `<p>Las tuplas son listas inmutables.</p>
                <div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python">coordenadas = (10, 20)
print(coordenadas[0])  # 10

# No se pueden modificar
# coordenadas[0] = 15  # Error!</code></pre></div>`
            },
            { 
                title: "Sets", 
                content: `<p>Los sets son colecciones sin duplicados.</p>
                <div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python">numeros = {1, 2, 3, 2, 1}
print(numeros)  # {1, 2, 3}

numeros.add(4)
numeros.remove(1)</code></pre></div>`
            },
            { 
                title: "Código Completo y Consola Interactiva", 
                content: `<h3>Eliminar Duplicados</h3>
                <div id="console-nivel-9" data-code="numeros = []

for i in range(5):
    num = int(input(&quot;Número {}: &quot;.format(i+1)))
    numeros.append(num)

print(&quot;\\nCon duplicados: {}&quot;.format(numeros))
sin_duplicados = list(set(numeros))
print(&quot;Sin duplicados: {}&quot;.format(sin_duplicados))"></div>`
            }
        ],
        quiz: [
            { type: "multiple-choice", question: "¿Tuplas son mutables?", options: ["Verdadero", "Falso"], answer: "Falso" },
            { type: "multiple-choice", question: "¿Sets permiten duplicados?", options: ["Verdadero", "Falso"], answer: "Falso" },
            { type: "multiple-choice", question: "¿Crear tupla?", options: ["[]", "()", "{}", "<>"], answer: "()" },
            { type: "multiple-choice", question: "¿Crear set?", options: ["[]", "()", "{}", "set()"], answer: "{}" },
            { type: "multiple-choice", question: "¿Agregar a set?", options: ["append()", "add()", "insert()", "push()"], answer: "add()" }
        ]
    },
    { // Nivel 10
        title: "Manejo de Archivos",
        lesson: [
            { 
                title: "Abrir y Leer Archivos", 
                content: `<p>Python puede leer y escribir archivos.</p>
                <div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python">with open("archivo.txt", "r") as f:
    contenido = f.read()
    print(contenido)</code></pre></div>`
            },
            { 
                title: "Escribir Archivos", 
                content: `<p>Puedes escribir en archivos de texto.</p>
                <div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python">with open("archivo.txt", "w") as f:
    f.write("Hola Mundo")
    f.write("\\nSegunda línea")</code></pre></div>`
            },
            { 
                title: "Código Completo y Consola Interactiva", 
                content: `<h3>Simulador de Archivo</h3>
                <div id="console-nivel-10" data-code="# Simulación de escritura
contenido = []

for i in range(3):
    linea = input(&quot;Línea {}: &quot;.format(i+1))
    contenido.append(linea)

print(&quot;\\nContenido del archivo:&quot;)
for i, linea in enumerate(contenido, 1):
    print(&quot;{}: {}&quot;.format(i, linea))

print(&quot;\\nTotal de líneas: {}&quot;.format(len(contenido)))"></div>`
            }
        ],
        quiz: [
            { type: "multiple-choice", question: "¿Abrir para leer?", options: ["'r'", "'w'", "'a'", "'x'"], answer: "'r'" },
            { type: "multiple-choice", question: "¿Abrir para escribir?", options: ["'r'", "'w'", "'a'", "'x'"], answer: "'w'" },
            { type: "multiple-choice", question: "¿with cierra archivo?", options: ["Verdadero", "Falso"], answer: "Verdadero" },
            { type: "multiple-choice", question: "¿Leer todo el archivo?", options: ["read()", "readline()", "readlines()", "readall()"], answer: "read()" },
            { type: "multiple-choice", question: "¿Modo para añadir?", options: ["'r'", "'w'", "'a'", "'x'"], answer: "'a'" }
        ]
    },
    { // Nivel 11
        title: "Introducción a POO - Clases y Objetos",
        lesson: [
            { 
                title: "¿Qué es la Programación Orientada a Objetos?", 
                content: `<p>La <strong>Programación Orientada a Objetos (POO)</strong> es un paradigma de programación que organiza el código en "objetos" que representan entidades del mundo real. En lugar de pensar en funciones y datos separados, la POO agrupa datos y comportamientos relacionados en una sola unidad.</p>
                <p><strong>¿Por qué usar POO?</strong></p>
                <ul>
                    <li><strong>Organización:</strong> El código es más fácil de entender y mantener</li>
                    <li><strong>Reutilización:</strong> Puedes crear plantillas (clases) y usarlas múltiples veces</li>
                    <li><strong>Modularidad:</strong> Cada objeto tiene responsabilidades claras</li>
                    <li><strong>Escalabilidad:</strong> Facilita el crecimiento de proyectos grandes</li>
                </ul>
                <p><strong>Ejemplo del mundo real:</strong> Piensa en un carro. Tiene <em>atributos</em> (color, marca, modelo) y <em>comportamientos</em> (acelerar, frenar, girar). En POO, crearías una "clase Carro" que define estos atributos y comportamientos, y luego crearías "objetos" específicos (tu carro rojo Toyota, mi carro azul Honda).</p>`
            },
            { 
                title: "Crear una Clase - La Plantilla", 
                content: `<p>Una <strong>clase</strong> es como un plano o plantilla que define qué atributos y métodos tendrán los objetos creados a partir de ella. Se define usando la palabra clave <code>class</code>.</p>
                <div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python"># Definir una clase simple
class Persona:
    pass  # Clase vacía por ahora

# Crear un objeto (instancia) de la clase
persona1 = Persona()
print(type(persona1))  # <class '__main__.Persona'></code></pre></div>
                <p><strong>Convenciones importantes:</strong></p>
                <ul>
                    <li>Los nombres de clases usan <strong>PascalCase</strong> (primera letra de cada palabra en mayúscula)</li>
                    <li>Los nombres de objetos usan <strong>snake_case</strong> (minúsculas con guiones bajos)</li>
                    <li><code>pass</code> es un placeholder cuando la clase aún no tiene contenido</li>
                </ul>`
            },
            { 
                title: "El Método __init__ - El Constructor", 
                content: `<p>El método <code>__init__</code> es un <strong>método especial</strong> (también llamado constructor) que se ejecuta automáticamente cuando creas un nuevo objeto. Se usa para inicializar los atributos del objeto.</p>
                <div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python">class Persona:
    def __init__(self, nombre, edad):
        # self.nombre es un atributo de instancia
        self.nombre = nombre
        self.edad = edad

# Crear objetos con valores específicos
persona1 = Persona("Ana", 25)
persona2 = Persona("Carlos", 30)

print(persona1.nombre)  # Ana
print(persona2.edad)    # 30</code></pre></div>
                <p><strong>Desglose del código:</strong></p>
                <ul>
                    <li><code>def __init__(self, ...):</code> - Define el constructor</li>
                    <li><code>self</code> - Referencia al objeto actual (siempre es el primer parámetro)</li>
                    <li><code>self.nombre = nombre</code> - Crea un atributo llamado <code>nombre</code> y le asigna el valor recibido</li>
                    <li><code>Persona("Ana", 25)</code> - Llama automáticamente a <code>__init__</code> con estos argumentos</li>
                </ul>
                <p><strong>Nota importante:</strong> <code>self</code> no se pasa explícitamente al crear el objeto. Python lo hace automáticamente.</p>`
            },
            { 
                title: "Atributos de Instancia vs Atributos de Clase", 
                content: `<p>Hay dos tipos de atributos en Python:</p>
                <p><strong>1. Atributos de Instancia:</strong> Únicos para cada objeto, definidos en <code>__init__</code></p>
                <p><strong>2. Atributos de Clase:</strong> Compartidos por todas las instancias, definidos fuera de <code>__init__</code></p>
                <div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python">class Estudiante:
    # Atributo de clase (compartido por todos)
    institucion = "Universidad Python"
    total_estudiantes = 0
    
    def __init__(self, nombre, carrera):
        # Atributos de instancia (únicos por objeto)
        self.nombre = nombre
        self.carrera = carrera
        # Incrementar contador de clase
        Estudiante.total_estudiantes += 1

# Crear estudiantes
est1 = Estudiante("Ana", "Ingeniería")
est2 = Estudiante("Carlos", "Medicina")

# Atributos de instancia (diferentes)
print(est1.nombre)      # Ana
print(est2.nombre)      # Carlos

# Atributo de clase (mismo para ambos)
print(est1.institucion)  # Universidad Python
print(est2.institucion)  # Universidad Python
print(Estudiante.total_estudiantes)  # 2</code></pre></div>
                <p><strong>Cuándo usar cada uno:</strong></p>
                <ul>
                    <li><strong>Atributos de instancia:</strong> Datos únicos de cada objeto (nombre, edad, ID)</li>
                    <li><strong>Atributos de clase:</strong> Datos compartidos o constantes (configuración, contadores)</li>
                </ul>`
            },
            { 
                title: "Métodos de Instancia", 
                content: `<p>Los <strong>métodos</strong> son funciones definidas dentro de una clase que operan sobre los atributos del objeto. Siempre reciben <code>self</code> como primer parámetro.</p>
                <div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python">class CuentaBancaria:
    def __init__(self, titular, saldo_inicial):
        self.titular = titular
        self.saldo = saldo_inicial
    
    def depositar(self, cantidad):
        """Agregar dinero a la cuenta"""
        if cantidad > 0:
            self.saldo += cantidad
            return "Depósito exitoso. Nuevo saldo: \${}".format(self.saldo)
        return "Cantidad inválida"
    
    def retirar(self, cantidad):
        """Retirar dinero de la cuenta"""
        if cantidad > self.saldo:
            return "Fondos insuficientes"
        if cantidad > 0:
            self.saldo -= cantidad
            return "Retiro exitoso. Nuevo saldo: \${}".format(self.saldo)
        return "Cantidad inválida"
    
    def consultar_saldo(self):
        """Ver el saldo actual"""
        return "Saldo de {}: \${}".format(self.titular, self.saldo)

# Usar la clase
cuenta = CuentaBancaria("Ana García", 1000)
print(cuenta.consultar_saldo())  # Saldo de Ana García: $1000
print(cuenta.depositar(500))     # Depósito exitoso. Nuevo saldo: $1500
print(cuenta.retirar(200))       # Retiro exitoso. Nuevo saldo: $1300</code></pre></div>
                <p><strong>Características de los métodos:</strong></p>
                <ul>
                    <li>Siempre tienen <code>self</code> como primer parámetro</li>
                    <li>Pueden acceder y modificar atributos usando <code>self.atributo</code></li>
                    <li>Pueden llamar a otros métodos usando <code>self.otro_metodo()</code></li>
                    <li>Se llaman con notación de punto: <code>objeto.metodo()</code></li>
                </ul>`
            },
            { 
                title: "Código Completo y Consola Interactiva", 
                content: `<h3>Sistema de Gestión de Productos</h3>
                <p>Este ejemplo muestra una clase completa con múltiples atributos y métodos trabajando juntos:</p>
                
                <div id="console-nivel-11" data-code="class Producto:
    def __init__(self, nombre, precio, stock):
        self.nombre = nombre
        self.precio = precio
        self.stock = stock
    
    def vender(self, cantidad):
        if cantidad &gt; self.stock:
            return &quot;Error: Solo hay {} unidades&quot;.format(self.stock)
        self.stock -= cantidad
        total = cantidad * self.precio
        return &quot;Venta exitosa. Total: \${}. Stock restante: {}&quot;.format(total, self.stock)
    
    def reabastecer(self, cantidad):
        self.stock += cantidad
        return &quot;Stock actualizado: {} unidades&quot;.format(self.stock)
    
    def aplicar_descuento(self, porcentaje):
        descuento = self.precio * (porcentaje / 100)
        self.precio -= descuento
        return &quot;Nuevo precio con {}% descuento: \${:.2f}&quot;.format(porcentaje, self.precio)
    
    def info(self):
        return &quot;{} - \${} - Stock: {}&quot;.format(self.nombre, self.precio, self.stock)

# Crear producto
laptop = Producto(&quot;Laptop Dell&quot;, 800, 10)
print(laptop.info())

# Realizar operaciones
print(laptop.vender(3))
print(laptop.reabastecer(5))
print(laptop.aplicar_descuento(10))
print(laptop.info())"></div>
                
                <h3>Conceptos Aplicados</h3>
                <ul>
                    <li><code>__init__</code> - Inicializa los atributos del producto</li>
                    <li><code>self.nombre, self.precio, self.stock</code> - Atributos de instancia</li>
                    <li><code>vender(), reabastecer(), aplicar_descuento()</code> - Métodos que modifican el estado</li>
                    <li><code>info()</code> - Método que devuelve información del objeto</li>
                </ul>
                
                <h3>Caso de Uso Real</h3>
                <p>Este tipo de clases se usan en sistemas de inventario de tiendas, e-commerce, y aplicaciones de punto de venta. Cada producto es un objeto con su propio estado (precio, stock) y comportamientos (vender, reabastecer).</p>`
            }
        ],
        quiz: [
            { type: "multiple-choice", question: "¿Qué es una clase en POO?", options: ["Un objeto específico", "Una plantilla para crear objetos", "Una función", "Una variable"], answer: "Una plantilla para crear objetos" },
            { type: "multiple-choice", question: "¿Qué hace el método __init__?", options: ["Elimina el objeto", "Inicializa los atributos", "Imprime el objeto", "Copia el objeto"], answer: "Inicializa los atributos" },
            { type: "multiple-choice", question: "¿Qué es 'self' en Python?", options: ["Una palabra clave", "Referencia al objeto actual", "Un tipo de dato", "Una función"], answer: "Referencia al objeto actual" },
            { type: "multiple-choice", question: "¿Cómo se crea un objeto de una clase?", options: ["new Clase()", "Clase.new()", "Clase()", "create Clase()"], answer: "Clase()" },
            { type: "multiple-choice", question: "¿Cuál es la convención para nombres de clases?", options: ["snake_case", "camelCase", "PascalCase", "UPPER_CASE"], answer: "PascalCase" }
        ]
    },
    { // Nivel 12
        title: "POO - Herencia",
        lesson: [
            { 
                title: "¿Qué es la Herencia?", 
                content: `<p>La <strong>herencia</strong> es un mecanismo que permite crear una nueva clase basada en una clase existente. La nueva clase (clase hija o subclase) hereda todos los atributos y métodos de la clase original (clase padre o superclase), y puede agregar o modificar funcionalidad.</p>
                <p><strong>Beneficios de la herencia:</strong></p>
                <ul>
                    <li><strong>Reutilización de código:</strong> No necesitas reescribir código que ya existe</li>
                    <li><strong>Jerarquía lógica:</strong> Modela relaciones "es un" del mundo real</li>
                    <li><strong>Mantenimiento:</strong> Cambios en la clase padre se propagan a las hijas</li>
                    <li><strong>Extensibilidad:</strong> Fácil agregar nuevas variantes</li>
                </ul>
                <p><strong>Ejemplo conceptual:</strong> Un "Empleado" es un tipo de "Persona". Un empleado tiene todo lo que tiene una persona (nombre, edad) más atributos específicos (salario, puesto). En lugar de duplicar el código de Persona, Empleado hereda de Persona.</p>`
            },
            { 
                title: "Crear una Clase Hija", 
                content: `<p>Para crear una clase que herede de otra, se coloca el nombre de la clase padre entre paréntesis después del nombre de la clase hija.</p>
                <div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python"># Clase padre (superclase)
class Persona:
    def __init__(self, nombre, edad):
        self.nombre = nombre
        self.edad = edad
    
    def saludar(self):
        return "Hola, soy {}".format(self.nombre)

# Clase hija (subclase) que hereda de Persona
class Empleado(Persona):
    def __init__(self, nombre, edad, salario):
        # Llamar al constructor de la clase padre
        super().__init__(nombre, edad)
        # Agregar atributo específico de Empleado
        self.salario = salario
    
    def trabajar(self):
        return "{} está trabajando".format(self.nombre)

# Crear un empleado
emp = Empleado("Carlos", 30, 50000)

# Usar métodos heredados
print(emp.saludar())  # Hola, soy Carlos (heredado de Persona)

# Usar métodos propios
print(emp.trabajar())  # Carlos está trabajando

# Acceder a atributos
print("Edad: {}, Salario: \${}".format(emp.edad, emp.salario))</code></pre></div>
                <p><strong>Desglose del código:</strong></p>
                <ul>
                    <li><code>class Empleado(Persona):</code> - Empleado hereda de Persona</li>
                    <li><code>super().__init__(nombre, edad)</code> - Llama al constructor de la clase padre</li>
                    <li><code>self.salario = salario</code> - Agrega un nuevo atributo específico</li>
                    <li>Empleado tiene acceso a <code>saludar()</code> aunque no lo definió</li>
                </ul>`
            },
            { 
                title: "La Función super() - Acceder a la Clase Padre", 
                content: `<p>La función <code>super()</code> devuelve una referencia temporal a la clase padre, permitiéndote llamar sus métodos. Es especialmente útil en el constructor para inicializar los atributos heredados.</p>
                <div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python">class Vehiculo:
    def __init__(self, marca, modelo):
        self.marca = marca
        self.modelo = modelo
    
    def info(self):
        return "{} {}".format(self.marca, self.modelo)

class Auto(Vehiculo):
    def __init__(self, marca, modelo, puertas):
        # Forma recomendada: usar super()
        super().__init__(marca, modelo)
        self.puertas = puertas
    
    def info(self):
        # Llamar al método info() del padre y extenderlo
        info_base = super().info()
        return "{} - {} puertas".format(info_base, self.puertas)

# Crear auto
auto = Auto("Toyota", "Corolla", 4)
print(auto.info())  # Toyota Corolla - 4 puertas</code></pre></div>
                <p><strong>Ventajas de super():</strong></p>
                <ul>
                    <li>Evita duplicación de código</li>
                    <li>Funciona correctamente con herencia múltiple</li>
                    <li>Hace el código más mantenible</li>
                    <li>Si cambias la clase padre, no necesitas modificar las hijas</li>
                </ul>
                <p><strong>Alternativa (no recomendada):</strong> Podrías llamar directamente <code>Vehiculo.__init__(self, marca, modelo)</code>, pero <code>super()</code> es más flexible y Pythonic.</p>`
            },
            { 
                title: "Sobrescribir Métodos (Method Overriding)", 
                content: `<p>Una clase hija puede <strong>sobrescribir</strong> (override) un método heredado definiendo un método con el mismo nombre. Esto permite personalizar el comportamiento para la clase hija.</p>
                <div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python">class Animal:
    def __init__(self, nombre):
        self.nombre = nombre
    
    def hacer_sonido(self):
        return "Algún sonido genérico"

class Perro(Animal):
    def hacer_sonido(self):
        # Sobrescribe el método del padre
        return "{} dice: ¡Guau guau!".format(self.nombre)

class Gato(Animal):
    def hacer_sonido(self):
        # Sobrescribe el método del padre
        return "{} dice: ¡Miau!".format(self.nombre)

# Crear animales
perro = Perro("Rex")
gato = Gato("Michi")

print(perro.hacer_sonido())  # Rex dice: ¡Guau guau!
print(gato.hacer_sonido())   # Michi dice: ¡Miau!</code></pre></div>
                <p><strong>Cuándo sobrescribir métodos:</strong></p>
                <ul>
                    <li>Cuando la clase hija necesita un comportamiento diferente</li>
                    <li>Para especializar funcionalidad genérica</li>
                    <li>Para agregar validaciones o lógica adicional</li>
                </ul>
                <p><strong>Puedes combinar:</strong> Sobrescribir un método pero aún llamar al método del padre con <code>super().metodo()</code> para extender (no reemplazar completamente) la funcionalidad.</p>`
            },
            { 
                title: "Herencia Multinivel y Jerarquías", 
                content: `<p>Python permite crear jerarquías de herencia de múltiples niveles, donde una clase hija puede ser padre de otra clase.</p>
                <div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python">class Persona:
    def __init__(self, nombre):
        self.nombre = nombre
    
    def presentarse(self):
        return "Soy {}".format(self.nombre)

class Empleado(Persona):
    def __init__(self, nombre, empresa):
        super().__init__(nombre)
        self.empresa = empresa
    
    def presentarse(self):
        return "{}, trabajo en {}".format(super().presentarse(), self.empresa)

class Gerente(Empleado):
    def __init__(self, nombre, empresa, departamento):
        super().__init__(nombre, empresa)
        self.departamento = departamento
    
    def presentarse(self):
        return "{} como gerente de {}".format(super().presentarse(), self.departamento)

# Crear gerente
gerente = Gerente("Ana", "TechCorp", "Desarrollo")
print(gerente.presentarse())
# Soy Ana, trabajo en TechCorp como gerente de Desarrollo

# Verificar la jerarquía
print(isinstance(gerente, Gerente))   # True
print(isinstance(gerente, Empleado))  # True
print(isinstance(gerente, Persona))   # True</code></pre></div>
                <p><strong>Función isinstance():</strong> Verifica si un objeto es instancia de una clase o de cualquiera de sus clases padre.</p>
                <p><strong>Función issubclass():</strong> Verifica si una clase es subclase de otra.</p>
                <div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python">print(issubclass(Gerente, Empleado))  # True
print(issubclass(Gerente, Persona))   # True
print(issubclass(Empleado, Gerente))  # False</code></pre></div>`
            },
            { 
                title: "Código Completo y Consola Interactiva", 
                content: `<h3>Sistema de Empleados con Herencia</h3>
                <p>Este ejemplo muestra una jerarquía completa de clases para un sistema de recursos humanos:</p>
                
                <div id="console-nivel-12" data-code="class Empleado:
    def __init__(self, nombre, salario_base):
        self.nombre = nombre
        self.salario_base = salario_base
    
    def calcular_salario(self):
        return self.salario_base
    
    def info(self):
        return &quot;{} - Salario: \${}&quot;.format(self.nombre, self.calcular_salario())

class EmpleadoTiempoCompleto(Empleado):
    def __init__(self, nombre, salario_base, bono_anual):
        super().__init__(nombre, salario_base)
        self.bono_anual = bono_anual
    
    def calcular_salario(self):
        # Salario base + bono mensual
        return self.salario_base + (self.bono_anual / 12)

class EmpleadoPorHoras(Empleado):
    def __init__(self, nombre, tarifa_hora, horas_trabajadas):
        # No tiene salario base fijo
        super().__init__(nombre, 0)
        self.tarifa_hora = tarifa_hora
        self.horas_trabajadas = horas_trabajadas
    
    def calcular_salario(self):
        salario = self.tarifa_hora * self.horas_trabajadas
        # Pago extra por horas extras (más de 160 horas/mes)
        if self.horas_trabajadas &gt; 160:
            horas_extra = self.horas_trabajadas - 160
            salario += horas_extra * self.tarifa_hora * 0.5
        return salario

# Crear empleados
emp1 = EmpleadoTiempoCompleto(&quot;Ana García&quot;, 3000, 12000)
emp2 = EmpleadoPorHoras(&quot;Carlos López&quot;, 20, 180)

print(emp1.info())
print(emp2.info())

# Calcular nómina total
empleados = [emp1, emp2]
total_nomina = sum(emp.calcular_salario() for emp in empleados)
print(&quot;\\nNómina total: \${:.2f}&quot;.format(total_nomina))"></div>
                
                <h3>Conceptos Aplicados</h3>
                <ul>
                    <li><code>Empleado</code> - Clase base con funcionalidad común</li>
                    <li><code>EmpleadoTiempoCompleto</code> y <code>EmpleadoPorHoras</code> - Clases hijas especializadas</li>
                    <li><code>calcular_salario()</code> - Método sobrescrito en cada clase hija</li>
                    <li><code>super().__init__()</code> - Reutilización del constructor padre</li>
                </ul>
                
                <h3>Caso de Uso Real</h3>
                <p>Este patrón se usa en sistemas de nómina, ERP, y aplicaciones de recursos humanos donde diferentes tipos de empleados tienen reglas de cálculo de salario distintas pero comparten atributos comunes.</p>`
            }
        ],
        quiz: [
            { type: "multiple-choice", question: "¿Qué es la herencia en POO?", options: ["Copiar código", "Crear clase basada en otra", "Eliminar una clase", "Modificar una clase"], answer: "Crear clase basada en otra" },
            { type: "multiple-choice", question: "¿Qué hace super()?", options: ["Crea un objeto", "Accede a la clase padre", "Elimina la clase", "Copia la clase"], answer: "Accede a la clase padre" },
            { type: "multiple-choice", question: "¿Qué es sobrescribir un método?", options: ["Eliminarlo", "Redefinirlo en clase hija", "Copiarlo", "Ocultarlo"], answer: "Redefinirlo en clase hija" },
            { type: "multiple-choice", question: "¿Cómo se define una clase hija?", options: ["class Hija(Padre):", "class Hija extends Padre:", "class Hija < Padre:", "class Hija -> Padre:"], answer: "class Hija(Padre):" },
            { type: "multiple-choice", question: "isinstance() verifica si:", options: ["Es una clase", "Es un objeto de una clase", "Es un método", "Es un atributo"], answer: "Es un objeto de una clase" }
        ]
    }
,
    { // Nivel 13
        title: "POO - Encapsulamiento y Propiedades",
        lesson: [
            {
                title: "¿Qué es el Encapsulamiento?",
                content: `<p>El <strong>encapsulamiento</strong> es el principio de ocultar los detalles internos de una clase y exponer solo lo necesario. Esto protege los datos de modificaciones accidentales y permite controlar cómo se accede y modifica la información.</p>
                <p><strong>Beneficios del encapsulamiento:</strong></p>
                <ul>
                    <li><strong>Protección de datos:</strong> Evita que se modifiquen valores de forma incorrecta</li>
                    <li><strong>Validación:</strong> Puedes validar datos antes de asignarlos</li>
                    <li><strong>Flexibilidad:</strong> Puedes cambiar la implementación interna sin afectar el código externo</li>
                    <li><strong>Mantenibilidad:</strong> Reduce el acoplamiento entre componentes</li>
                </ul>
                <p><strong>Ejemplo del mundo real:</strong> Un cajero automático encapsula el dinero. No puedes acceder directamente al dinero, solo a través de operaciones controladas (retirar, depositar) que validan tu identidad y saldo.</p>`
            },
            {
                title: "Atributos Privados en Python",
                content: `<p>En Python, los atributos "privados" se indican con <strong>doble guión bajo</strong> (<code>__</code>) al inicio del nombre. Esto activa el "name mangling" que dificulta (pero no imposibilita) el acceso desde fuera de la clase.</p>
                <div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python">class CuentaBancaria:
    def __init__(self, titular, saldo_inicial):
        self.titular = titular  # Público
        self.__saldo = saldo_inicial  # Privado
    
    def consultar_saldo(self):
        return self.__saldo
    
    def depositar(self, cantidad):
        if cantidad > 0:
            self.__saldo += cantidad
            return True
        return False

cuenta = CuentaBancaria("Ana", 1000)
print(cuenta.titular)  # Ana (acceso directo OK)
# print(cuenta.__saldo)  # Error: AttributeError
print(cuenta.consultar_saldo())  # 1000 (acceso controlado OK)</code></pre></div>
                <p><strong>Convenciones de privacidad:</strong></p>
                <ul>
                    <li><code>atributo</code> - Público, acceso libre</li>
                    <li><code>_atributo</code> - "Protegido", convención de que es interno (no forzado)</li>
                    <li><code>__atributo</code> - "Privado", name mangling aplicado</li>
                </ul>
                <p><strong>Nota:</strong> Python no tiene privacidad verdadera como Java o C++. El doble guión bajo es una convención fuerte, pero técnicamente aún puedes acceder con <code>objeto._Clase__atributo</code>.</p>`
            },
            {
                title: "Propiedades con @property",
                content: `<p>El decorador <code>@property</code> permite acceder a un método como si fuera un atributo, proporcionando un "getter" elegante. Esto te da control sobre cómo se accede a los datos sin cambiar la sintaxis de uso.</p>
                <div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python">class Temperatura:
    def __init__(self, celsius):
        self.__celsius = celsius
    
    @property
    def celsius(self):
        """Getter para celsius"""
        return self.__celsius
    
    @property
    def fahrenheit(self):
        """Convertir a Fahrenheit automáticamente"""
        return (self.__celsius * 9/5) + 32

temp = Temperatura(25)
print(temp.celsius)     # 25 (parece atributo, es método)
print(temp.fahrenheit)  # 77.0 (calculado dinámicamente)</code></pre></div>
                <p><strong>Ventajas de @property:</strong></p>
                <ul>
                    <li>Sintaxis limpia (parece un atributo normal)</li>
                    <li>Puedes calcular valores dinámicamente</li>
                    <li>Puedes agregar lógica sin cambiar la interfaz</li>
                    <li>Permite migrar de atributos públicos a controlados sin romper código</li>
                </ul>`
            },
            {
                title: "Setters con @propiedad.setter",
                content: `<p>El decorador <code>@propiedad.setter</code> permite definir cómo se asignan valores a una propiedad, agregando validación y control.</p>
                <div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python">class Persona:
    def __init__(self, nombre, edad):
        self.__nombre = nombre
        self.__edad = edad
    
    @property
    def edad(self):
        """Getter para edad"""
        return self.__edad
    
    @edad.setter
    def edad(self, nueva_edad):
        """Setter con validación"""
        if nueva_edad < 0:
            raise ValueError("La edad no puede ser negativa")
        if nueva_edad > 150:
            raise ValueError("Edad no realista")
        self.__edad = nueva_edad
    
    @property
    def nombre(self):
        return self.__nombre
    
    @nombre.setter
    def nombre(self, nuevo_nombre):
        if not nuevo_nombre or not nuevo_nombre.strip():
            raise ValueError("El nombre no puede estar vacío")
        self.__nombre = nuevo_nombre.strip()

persona = Persona("Ana", 25)
print(persona.edad)  # 25

persona.edad = 30  # OK, usa el setter
print(persona.edad)  # 30

# persona.edad = -5  # Error: ValueError</code></pre></div>
                <p><strong>Patrón completo de propiedad:</strong></p>
                <ol>
                    <li>Atributo privado: <code>self.__atributo</code></li>
                    <li>Getter con <code>@property</code></li>
                    <li>Setter con <code>@atributo.setter</code></li>
                    <li>Opcionalmente, deleter con <code>@atributo.deleter</code></li>
                </ol>`
            },
            {
                title: "Métodos Privados",
                content: `<p>Al igual que los atributos, los métodos también pueden ser privados usando el doble guión bajo. Esto es útil para métodos auxiliares internos que no deberían llamarse desde fuera.</p>
                <div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python">class Calculadora:
    def __init__(self):
        self.__historial = []
    
    def __agregar_historial(self, operacion, resultado):
        """Método privado para uso interno"""
        self.__historial.append({
            'operacion': operacion,
            'resultado': resultado
        })
    
    def sumar(self, a, b):
        """Método público"""
        resultado = a + b
        self.__agregar_historial(f"{a} + {b}", resultado)
        return resultado
    
    def multiplicar(self, a, b):
        """Método público"""
        resultado = a * b
        self.__agregar_historial(f"{a} * {b}", resultado)
        return resultado
    
    def ver_historial(self):
        """Método público para acceder al historial"""
        return self.__historial.copy()

calc = Calculadora()
print(calc.sumar(5, 3))  # 8
print(calc.multiplicar(4, 2))  # 8
print(calc.ver_historial())  # Lista de operaciones
# calc.__agregar_historial("test", 0)  # Error: AttributeError</code></pre></div>
                <p><strong>Cuándo usar métodos privados:</strong></p>
                <ul>
                    <li>Métodos auxiliares que solo usa la clase internamente</li>
                    <li>Lógica de validación o procesamiento interno</li>
                    <li>Métodos que podrían cambiar en futuras versiones</li>
                </ul>`
            },
            {
                title: "Código Completo y Consola Interactiva",
                content: `<h3>Sistema de Cuenta Bancaria con Encapsulamiento</h3>
                <p>Este ejemplo muestra un sistema bancario completo con validación y control de acceso:</p>
                
                <div id="console-nivel-13" data-code="class CuentaBancaria:
    def __init__(self, titular, saldo_inicial, limite_retiro=1000):
        self.__titular = titular
        self.__saldo = saldo_inicial
        self.__limite_retiro = limite_retiro
        self.__transacciones = []
    
    @property
    def saldo(self):
        &quot;&quot;&quot;Consultar saldo (solo lectura desde fuera)&quot;&quot;&quot;
        return self.__saldo
    
    @property
    def titular(self):
        return self.__titular
    
    def __registrar_transaccion(self, tipo, monto):
        &quot;&quot;&quot;Método privado para registro interno&quot;&quot;&quot;
        self.__transacciones.append({
            'tipo': tipo,
            'monto': monto,
            'saldo_resultante': self.__saldo
        })
    
    def depositar(self, cantidad):
        if cantidad &lt;= 0:
            return &quot;Error: Cantidad debe ser positiva&quot;
        self.__saldo += cantidad
        self.__registrar_transaccion('depósito', cantidad)
        return &quot;Depósito exitoso. Nuevo saldo: \${}&quot;.format(self.__saldo)
    
    def retirar(self, cantidad):
        if cantidad &lt;= 0:
            return &quot;Error: Cantidad debe ser positiva&quot;
        if cantidad &gt; self.__limite_retiro:
            return &quot;Error: Límite de retiro es \${}&quot;.format(self.__limite_retiro)
        if cantidad &gt; self.__saldo:
            return &quot;Error: Fondos insuficientes&quot;
        self.__saldo -= cantidad
        self.__registrar_transaccion('retiro', cantidad)
        return &quot;Retiro exitoso. Nuevo saldo: \${}&quot;.format(self.__saldo)
    
    def ver_transacciones(self):
        return self.__transacciones.copy()

# Crear cuenta
cuenta = CuentaBancaria(&quot;Ana García&quot;, 5000, limite_retiro=2000)

# Operaciones
print(&quot;Titular: {}&quot;.format(cuenta.titular))
print(&quot;Saldo inicial: \${}&quot;.format(cuenta.saldo))
print(cuenta.depositar(1000))
print(cuenta.retirar(500))
print(cuenta.retirar(3000))  # Excede límite
print(&quot;\\nTransacciones:&quot;)
for t in cuenta.ver_transacciones():
    print(&quot;  {}: \${} -&gt; Saldo: \${}&quot;.format(t['tipo'], t['monto'], t['saldo_resultante']))"></div>
                
                <h3>Conceptos Aplicados</h3>
                <ul>
                    <li><code>__saldo, __titular, __transacciones</code> - Atributos privados</li>
                    <li><code>@property</code> - Getters para acceso controlado</li>
                    <li><code>__registrar_transaccion()</code> - Método privado interno</li>
                    <li>Validación en métodos públicos</li>
                    <li><code>.copy()</code> - Devolver copia para proteger datos internos</li>
                </ul>
                
                <h3>Caso de Uso Real</h3>
                <p>Este patrón se usa en aplicaciones bancarias, sistemas de pago, y cualquier aplicación que maneje datos sensibles que requieren validación y control de acceso estricto.</p>`
            }
        ],
        quiz: [
            { type: "multiple-choice", question: "¿Qué es el encapsulamiento?", options: ["Ocultar código", "Proteger y controlar acceso a datos", "Copiar objetos", "Eliminar atributos"], answer: "Proteger y controlar acceso a datos" },
            { type: "multiple-choice", question: "¿Cómo se define un atributo privado?", options: ["_atributo", "__atributo", "private atributo", "atributo__"], answer: "__atributo" },
            { type: "multiple-choice", question: "¿Qué hace @property?", options: ["Crea atributo", "Crea getter elegante", "Elimina método", "Copia propiedad"], answer: "Crea getter elegante" },
            { type: "multiple-choice", question: "¿Para qué sirve un setter?", options: ["Leer valores", "Asignar valores con validación", "Eliminar valores", "Copiar valores"], answer: "Asignar valores con validación" },
            { type: "multiple-choice", question: "¿Python tiene privacidad verdadera?", options: ["Sí, total", "No, es por convención", "Solo en clases", "Solo en métodos"], answer: "No, es por convención" }
        ]
    },
    { // Nivel 14
        title: "POO - Polimorfismo y Métodos Especiales",
        lesson: [
            {
                title: "¿Qué es el Polimorfismo?",
                content: `<p>El <strong>polimorfismo</strong> (del griego "muchas formas") permite que objetos de diferentes clases respondan al mismo método de manera específica a su tipo. Es el principio de "una interfaz, múltiples implementaciones".</p>
                <p><strong>Tipos de polimorfismo en Python:</strong></p>
                <ul>
                    <li><strong>Polimorfismo de herencia:</strong> Clases hijas sobrescriben métodos del padre</li>
                    <li><strong>Duck typing:</strong> "Si camina como pato y grazna como pato, es un pato" - Python no verifica el tipo, solo que tenga los métodos necesarios</li>
                    <li><strong>Sobrecarga de operadores:</strong> Definir cómo funcionan +, -, *, etc. con tus objetos</li>
                </ul>
                <p><strong>Ejemplo conceptual:</strong> Tanto un perro como un gato pueden "hacer_sonido()", pero cada uno lo hace diferente. El código que llama a "hacer_sonido()" no necesita saber si es perro o gato.</p>`
            },
            {
                title: "Polimorfismo con Herencia",
                content: `<p>El polimorfismo más común ocurre cuando múltiples clases hijas implementan el mismo método de diferentes formas:</p>
                <div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python">class Figura:
    def area(self):
        pass  # Método base sin implementación

class Rectangulo(Figura):
    def __init__(self, base, altura):
        self.base = base
        self.altura = altura
    
    def area(self):
        return self.base * self.altura

class Circulo(Figura):
    def __init__(self, radio):
        self.radio = radio
    
    def area(self):
        return 3.14159 * self.radio ** 2

class Triangulo(Figura):
    def __init__(self, base, altura):
        self.base = base
        self.altura = altura
    
    def area(self):
        return (self.base * self.altura) / 2

# Polimorfismo en acción
figuras = [
    Rectangulo(5, 3),
    Circulo(4),
    Triangulo(6, 4)
]

for figura in figuras:
    # Mismo método, diferente implementación
    print("Área: {}".format(figura.area()))</code></pre></div>
                <p><strong>Ventaja clave:</strong> El código que usa las figuras no necesita saber qué tipo específico es cada una. Solo necesita saber que tienen un método <code>area()</code>.</p>`
            },
            {
                title: "Duck Typing - Polimorfismo sin Herencia",
                content: `<p>Python usa <strong>duck typing</strong>: no importa el tipo del objeto, solo que tenga los métodos/atributos que necesitas. Esto permite polimorfismo sin herencia.</p>
                <div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python">class Pato:
    def hablar(self):
        return "¡Cuac cuac!"

class Perro:
    def hablar(self):
        return "¡Guau guau!"

class Persona:
    def hablar(self):
        return "¡Hola!"

def hacer_hablar(objeto):
    # No importa el tipo, solo que tenga hablar()
    print(objeto.hablar())

# Todos funcionan con la misma función
hacer_hablar(Pato())     # ¡Cuac cuac!
hacer_hablar(Perro())    # ¡Guau guau!
hacer_hablar(Persona())  # ¡Hola!</code></pre></div>
                <p><strong>Filosofía de Python:</strong> "Es más fácil pedir perdón que permiso" (EAFP). En lugar de verificar tipos, simplemente intenta usar el método y maneja errores si no existe.</p>`
            },
            {
                title: "Métodos Especiales (Magic Methods)",
                content: `<p>Los <strong>métodos especiales</strong> (también llamados "dunder methods" por el doble guión bajo) permiten que tus objetos se comporten como tipos built-in de Python. Comienzan y terminan con <code>__</code>.</p>
                <p><strong>Métodos especiales comunes:</strong></p>
                <ul>
                    <li><code>__init__(self)</code> - Constructor</li>
                    <li><code>__str__(self)</code> - Representación legible (para <code>print()</code>)</li>
                    <li><code>__repr__(self)</code> - Representación técnica (para debugging)</li>
                    <li><code>__len__(self)</code> - Longitud (para <code>len()</code>)</li>
                    <li><code>__getitem__(self, key)</code> - Acceso con corchetes <code>obj[key]</code></li>
                    <li><code>__eq__(self, other)</code> - Igualdad <code>==</code></li>
                </ul>
                <div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python">class Libro:
    def __init__(self, titulo, autor, paginas):
        self.titulo = titulo
        self.autor = autor
        self.paginas = paginas
    
    def __str__(self):
        # Para print() - legible para humanos
        return '"{}" por {}'.format(self.titulo, self.autor)
    
    def __repr__(self):
        # Para debugging - reproducible
        return "Libro('{}', '{}', {})".format(self.titulo, self.autor, self.paginas)
    
    def __len__(self):
        # Para len()
        return self.paginas
    
    def __eq__(self, otro):
        # Para comparación ==
        return self.titulo == otro.titulo and self.autor == otro.autor

libro1 = Libro("1984", "George Orwell", 328)
libro2 = Libro("1984", "George Orwell", 328)

print(libro1)  # "1984" por George Orwell (usa __str__)
print(repr(libro1))  # Libro('1984', 'George Orwell', 328) (usa __repr__)
print(len(libro1))  # 328 (usa __len__)
print(libro1 == libro2)  # True (usa __eq__)</code></pre></div>`
            },
            {
                title: "Sobrecarga de Operadores",
                content: `<p>Puedes definir cómo funcionan los operadores matemáticos (+, -, *, /) con tus objetos usando métodos especiales:</p>
                <div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python">class Vector:
    def __init__(self, x, y):
        self.x = x
        self.y = y
    
    def __add__(self, otro):
        # Sobrecarga del operador +
        return Vector(self.x + otro.x, self.y + otro.y)
    
    def __sub__(self, otro):
        # Sobrecarga del operador -
        return Vector(self.x - otro.x, self.y - otro.y)
    
    def __mul__(self, escalar):
        # Sobrecarga del operador *
        return Vector(self.x * escalar, self.y * escalar)
    
    def __str__(self):
        return "Vector({}, {})".format(self.x, self.y)

v1 = Vector(3, 4)
v2 = Vector(1, 2)

v3 = v1 + v2  # Usa __add__
print(v3)  # Vector(4, 6)

v4 = v1 - v2  # Usa __sub__
print(v4)  # Vector(2, 2)

v5 = v1 * 2  # Usa __mul__
print(v5)  # Vector(6, 8)</code></pre></div>
                <p><strong>Operadores sobrecargables:</strong></p>
                <ul>
                    <li><code>__add__</code> (+), <code>__sub__</code> (-), <code>__mul__</code> (*), <code>__truediv__</code> (/)</li>
                    <li><code>__lt__</code> (<), <code>__le__</code> (<=), <code>__gt__</code> (>), <code>__ge__</code> (>=)</li>
                    <li><code>__and__</code> (&), <code>__or__</code> (|), <code>__xor__</code> (^)</li>
                </ul>`
            },
            {
                title: "Código Completo y Consola Interactiva",
                content: `<h3>Sistema de Carrito de Compras con Polimorfismo</h3>
                <p>Este ejemplo muestra polimorfismo y métodos especiales en un sistema de e-commerce:</p>
                
                <div id="console-nivel-14" data-code="class Producto:
    def __init__(self, nombre, precio):
        self.nombre = nombre
        self.precio = precio
    
    def __str__(self):
        return &quot;{}: \${}&quot;.format(self.nombre, self.precio)
    
    def __repr__(self):
        return &quot;Producto('{}', {})&quot;.format(self.nombre, self.precio)

class CarritoCompras:
    def __init__(self):
        self.productos = []
    
    def __len__(self):
        # len(carrito) devuelve cantidad de productos
        return len(self.productos)
    
    def __getitem__(self, index):
        # carrito[0] accede a productos
        return self.productos[index]
    
    def __add__(self, producto):
        # carrito + producto agrega al carrito
        nuevo_carrito = CarritoCompras()
        nuevo_carrito.productos = self.productos.copy()
        nuevo_carrito.productos.append(producto)
        return nuevo_carrito
    
    def agregar(self, producto):
        self.productos.append(producto)
    
    def total(self):
        return sum(p.precio for p in self.productos)
    
    def __str__(self):
        if not self.productos:
            return &quot;Carrito vacío&quot;
        items = &quot;\\n&quot;.join(&quot;  - {}&quot;.format(p) for p in self.productos)
        return &quot;Carrito ({} productos):\\n{}\\nTotal: \${}&quot;.format(len(self), items, self.total())

# Crear productos
p1 = Producto(&quot;Laptop&quot;, 800)
p2 = Producto(&quot;Mouse&quot;, 25)
p3 = Producto(&quot;Teclado&quot;, 60)

# Crear carrito
carrito = CarritoCompras()
carrito.agregar(p1)
carrito.agregar(p2)

# Usar métodos especiales
print(&quot;Productos en carrito: {}&quot;.format(len(carrito)))
print(&quot;Primer producto: {}&quot;.format(carrito[0]))

# Usar operador +
carrito = carrito + p3
print(&quot;\\n&quot; + str(carrito))"></div>
                
                <h3>Conceptos Aplicados</h3>
                <ul>
                    <li><code>__str__</code> y <code>__repr__</code> - Representaciones del objeto</li>
                    <li><code>__len__</code> - Soporte para <code>len()</code></li>
                    <li><code>__getitem__</code> - Acceso con corchetes</li>
                    <li><code>__add__</code> - Sobrecarga del operador +</li>
                    <li>Polimorfismo con diferentes productos</li>
                </ul>
                
                <h3>Caso de Uso Real</h3>
                <p>Este patrón se usa en plataformas de e-commerce, sistemas de punto de venta, y aplicaciones de gestión de inventario donde diferentes tipos de productos comparten una interfaz común.</p>`
            }
        ],
        quiz: [
            { type: "multiple-choice", question: "¿Qué es el polimorfismo?", options: ["Copiar objetos", "Múltiples formas de un método", "Eliminar clases", "Crear objetos"], answer: "Múltiples formas de un método" },
            { type: "multiple-choice", question: "¿Qué es duck typing?", options: ["Verificar tipos", "Si tiene los métodos, funciona", "Crear patos", "Eliminar tipos"], answer: "Si tiene los métodos, funciona" },
            { type: "multiple-choice", question: "¿Qué hace __str__?", options: ["Crea string", "Representación legible", "Elimina objeto", "Copia objeto"], answer: "Representación legible" },
            { type: "multiple-choice", question: "¿Qué método sobrecarga el operador +?", options: ["__plus__", "__add__", "__sum__", "__positive__"], answer: "__add__" },
            { type: "multiple-choice", question: "¿Para qué sirve __len__?", options: ["Crear longitud", "Soporte para len()", "Eliminar elementos", "Copiar lista"], answer: "Soporte para len()" }
        ]
    },
    { // Nivel 15 - DESAFÍO
        title: "Proyecto POO - Sistema de Gestión",
        lesson: [
            { title: "Proyecto Completo con POO", content: `<p>Aplicarás todo lo aprendido de POO en un proyecto real: un Sistema de Biblioteca Digital.</p><p><strong>Características:</strong> Gestión de libros, usuarios, préstamos, persistencia JSON, validación de reglas.</p>` },
            { title: "Diseño del Sistema", content: `<p><strong>Clases principales:</strong></p><ul><li>Libro: ISBN, título, autor, disponible</li><li>Usuario: ID, nombre, libros_prestados (máx 3)</li><li>Biblioteca: catálogo, usuarios, operaciones</li></ul>` },
            { title: "Implementación", content: `<div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python">class Libro:
    def __init__(self, isbn, titulo, autor):
        self.isbn = isbn
        self.titulo = titulo
        self.autor = autor
        self.disponible = True
    
    def prestar(self):
        self.disponible = False
    
    def devolver(self):
        self.disponible = True</code></pre></div>` },
            { title: "Consola Interactiva", content: `<div id="console-nivel-15" data-code-base64="Y2xhc3MgTGlicm86CiAgICBkZWYgX19pbml0X18oc2VsZiwgaXNibiwgdGl0dWxvKToKICAgICAgICBzZWxmLmlzYm4gPSBpc2JuCiAgICAgICAgc2VsZi50aXR1bG8gPSB0aXR1bG8KICAgICAgICBzZWxmLmRpc3BvbmlibGUgPSBUcnVlCgpjbGFzcyBCaWJsaW90ZWNhOgogICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgIHNlbGYubGlicm9zID0ge30KICAgIAogICAgZGVmIGFncmVnYXJfbGlicm8oc2VsZiwgbGlicm8pOgogICAgICAgIHNlbGYubGlicm9zW2xpYnJvLmlzYm5dID0gbGlicm8KICAgICAgICByZXR1cm4gIuKckyAne30nIGFncmVnYWRvIi5mb3JtYXQobGlicm8udGl0dWxvKQogICAgCiAgICBkZWYgbGlzdGFyX2Rpc3BvbmlibGVzKHNlbGYpOgogICAgICAgIHJldHVybiBbbC50aXR1bG8gZm9yIGwgaW4gc2VsZi5saWJyb3MudmFsdWVzKCkgaWYgbC5kaXNwb25pYmxlXQoKYmliID0gQmlibGlvdGVjYSgpCnByaW50KGJpYi5hZ3JlZ2FyX2xpYnJvKExpYnJvKCIwMDEiLCAiMTk4NCIpKSkKcHJpbnQoYmliLmFncmVnYXJfbGlicm8oTGlicm8oIjAwMiIsICJFbCBQcmluY2lwaXRvIikpKQpwcmludCgiRGlzcG9uaWJsZXM6IiwgYmliLmxpc3Rhcl9kaXNwb25pYmxlcygpKQ=="></div><p><strong>🎮 Desafío python_challenge3:</strong> Implementa sistema completo con persistencia JSON.</p>` }
        ],
        quiz: [
            { type: "multiple-choice", question: "¿Qué es composición en POO?", options: ["Herencia múltiple", "Una clase contiene objetos de otras", "Copiar clases", "Eliminar objetos"], answer: "Una clase contiene objetos de otras" },
            { type: "multiple-choice", question: "¿Para qué sirve to_dict()?", options: ["Crear diccionario", "Serializar para JSON", "Eliminar objeto", "Copiar objeto"], answer: "Serializar para JSON" },
            { type: "multiple-choice", question: "¿Qué hace @staticmethod?", options: ["Crea variable estática", "Método sin self", "Elimina método", "Copia método"], answer: "Método sin self" },
            { type: "multiple-choice", question: "¿Por qué usar JSON?", options: ["Es rápido", "Formato legible y estándar", "Es binario", "Es encriptado"], answer: "Formato legible y estándar" },
            { type: "multiple-choice", question: "¿Qué valida un límite de préstamos?", options: ["Si existe libro", "Regla de negocio", "Si está disponible", "Si existe usuario"], answer: "Regla de negocio" }
        ]
    },
    { // Nivel 16
        title: "Automatización - Archivos y Directorios",
        lesson: [
            { title: "Módulos para Archivos", content: `<p>Python tiene módulos poderosos para automatizar tareas con archivos:</p><ul><li><code>os</code>: Operaciones del sistema operativo</li><li><code>shutil</code>: Copiar, mover archivos</li><li><code>pathlib</code>: Rutas orientadas a objetos</li></ul>` },
            { title: "Operaciones Básicas", content: `<div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python">import os
import shutil

# Crear directorio
os.makedirs("carpeta", exist_ok=True)

# Listar archivos
archivos = os.listdir(".")

# Copiar archivo
shutil.copy("origen.txt", "destino.txt")

# Mover archivo
shutil.move("archivo.txt", "carpeta/")</code></pre></div>` },
            { title: "Organizador Automático", content: `<div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python">import os

categorias = {
    'Documentos': ['.pdf', '.docx', '.txt'],
    'Imágenes': ['.jpg', '.png', '.gif'],
    'Videos': ['.mp4', '.avi']
}

for archivo in os.listdir('.'):
    ext = os.path.splitext(archivo)[1]
    for categoria, extensiones in categorias.items():
        if ext in extensiones:
            os.makedirs(categoria, exist_ok=True)
            # shutil.move(archivo, "{}/{}".format(categoria, archivo))
            print("Mover {} a {}".format(archivo, categoria))</code></pre></div>` },
            { title: "Consola Interactiva", content: `<div id="console-nivel-16" data-code-base64="aW1wb3J0IG9zCgojIFNpbXVsYXIgb3JnYW5pemFjacOzbiBkZSBhcmNoaXZvcwphcmNoaXZvcyA9IFsiZm90by5qcGciLCAiZG9jdW1lbnRvLnBkZiIsICJ2aWRlby5tcDQiLCAiaW1hZ2VuLnBuZyJdCgpjYXRlZ29yaWFzID0gewogICAgJ0RvY3VtZW50b3MnOiBbJy5wZGYnLCAnLmRvY3gnXSwKICAgICdJbcOhZ2VuZXMnOiBbJy5qcGcnLCAnLnBuZyddLAogICAgJ1ZpZGVvcyc6IFsnLm1wNCddCn0KCmZvciBhcmNoaXZvIGluIGFyY2hpdm9zOgogICAgZXh0ID0gb3MucGF0aC5zcGxpdGV4dChhcmNoaXZvKVsxXQogICAgZm9yIGNhdGVnb3JpYSwgZXh0ZW5zaW9uZXMgaW4gY2F0ZWdvcmlhcy5pdGVtcygpOgogICAgICAgIGlmIGV4dCBpbiBleHRlbnNpb25lczoKICAgICAgICAgICAgcHJpbnQoIvCfk4Ege30g4oaSIHt9LyIuZm9ybWF0KGFyY2hpdm8sIGNhdGVnb3JpYSkpCiAgICAgICAgICAgIGJyZWFr"></div><p><strong>Caso real:</strong> Organizar automáticamente carpeta de Descargas.</p>` }
        ],
        quiz: [
            { type: "multiple-choice", question: "¿Qué módulo mueve archivos?", options: ["os", "shutil", "move", "file"], answer: "shutil" },
            { type: "multiple-choice", question: "¿Qué hace makedirs()?", options: ["Crea archivo", "Crea directorio", "Elimina directorio", "Lista archivos"], answer: "Crea directorio" },
            { type: "multiple-choice", question: "¿Para qué sirve exist_ok=True?", options: ["Crear si existe", "No error si existe", "Forzar creación", "Eliminar existente"], answer: "No error si existe" },
            { type: "multiple-choice", question: "¿Qué devuelve os.listdir()?", options: ["String", "Lista de archivos", "Diccionario", "Tupla"], answer: "Lista de archivos" },
            { type: "multiple-choice", question: "¿Qué hace os.path.splitext()?", options: ["Une rutas", "Separa nombre y extensión", "Crea ruta", "Elimina extensión"], answer: "Separa nombre y extensión" }
        ]
    },
    { // Nivel 17
        title: "Automatización - Fechas y Tiempo",
        lesson: [
            { title: "Módulo datetime", content: `<p>El módulo <code>datetime</code> maneja fechas, horas y duraciones:</p><ul><li><code>datetime</code>: Fecha y hora combinadas</li><li><code>date</code>: Solo fecha</li><li><code>time</code>: Solo hora</li><li><code>timedelta</code>: Duración/diferencia</li></ul>` },
            { title: "Trabajar con Fechas", content: `<div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python">from datetime import datetime, timedelta

# Fecha actual
ahora = datetime.now()
print(ahora)

# Crear fecha específica
cumple = datetime(2024, 12, 25)

# Formatear fecha
print(ahora.strftime("%d/%m/%Y"))

# Operaciones
mañana = ahora + timedelta(days=1)
hace_una_semana = ahora - timedelta(weeks=1)</code></pre></div>` },
            { title: "Calculadora de Fechas", content: `<div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python">from datetime import datetime

def dias_hasta(fecha_objetivo):
    hoy = datetime.now()
    diferencia = fecha_objetivo - hoy
    return diferencia.days

navidad = datetime(2024, 12, 25)
print("Días hasta Navidad: {}".format(dias_hasta(navidad)))</code></pre></div>` },
            { title: "Consola Interactiva", content: `<div id="console-nivel-17"></div><script>createInteractiveConsole(\`from datetime import datetime, timedelta

# Fecha actual
ahora = datetime.now()
print("Hoy: {}".format(ahora.strftime('%d/%m/%Y %H:%M')))

# Operaciones
mañana = ahora + timedelta(days=1)
print("Mañana: {}".format(mañana.strftime('%d/%m/%Y')))

# Calcular edad
nacimiento = datetime(2000, 1, 1)
edad = (ahora - nacimiento).days // 365
print("\\nSi naciste el 01/01/2000, tienes {} años".format(edad))

# Días hasta fin de año
fin_año = datetime(ahora.year, 12, 31)
dias = (fin_año - ahora).days
print("Días hasta fin de año: {}".format(dias))\`, 'console-nivel-17');<\/script><p><strong>Caso real:</strong> Sistemas de reservas, recordatorios, análisis temporal.</p>` }
        ],
        quiz: [
            { type: "multiple-choice", question: "¿Qué módulo maneja fechas?", options: ["time", "datetime", "date", "calendar"], answer: "datetime" },
            { type: "multiple-choice", question: "¿Qué es timedelta?", options: ["Fecha", "Hora", "Duración/diferencia", "Zona horaria"], answer: "Duración/diferencia" },
            { type: "multiple-choice", question: "¿Qué hace strftime()?", options: ["Crea fecha", "Formatea fecha a string", "Parsea string", "Suma fechas"], answer: "Formatea fecha a string" },
            { type: "multiple-choice", question: "¿Cómo sumar 7 días a una fecha?", options: ["fecha + 7", "fecha + timedelta(days=7)", "fecha.add(7)", "fecha + days(7)"], answer: "fecha + timedelta(days=7)" },
            { type: "multiple-choice", question: "¿Qué devuelve datetime.now()?", options: ["String", "Fecha actual", "Hora actual", "Timestamp"], answer: "Fecha actual" }
        ]
    },
    { // Nivel 18
        title: "APIs y Requests",
        lesson: [
            { title: "¿Qué es una API?", content: `<p>Una <strong>API (Application Programming Interface)</strong> permite que programas se comuniquen entre sí. Las <strong>APIs REST</strong> usan HTTP para intercambiar datos (generalmente JSON).</p><p><strong>Métodos HTTP:</strong> GET (obtener), POST (crear), PUT (actualizar), DELETE (eliminar)</p>` },
            { title: "Módulo requests", content: `<div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python">import requests

# GET request
respuesta = requests.get("https://api.ejemplo.com/datos")

# Verificar éxito
if respuesta.status_code == 200:
    datos = respuesta.json()  # Parsear JSON
    print(datos)

# POST request con datos
datos_enviar = {"nombre": "Ana", "edad": 25}
respuesta = requests.post("https://api.ejemplo.com/usuarios", json=datos_enviar)</code></pre></div>` },
            { title: "Consultar API de Clima", content: `<div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python">import requests

def obtener_clima(ciudad):
    url = "https://api.openweathermap.org/data/2.5/weather"
    params = {
        'q': ciudad,
        'appid': 'TU_API_KEY',
        'units': 'metric',
        'lang': 'es'
    }
    
    respuesta = requests.get(url, params=params)
    datos = respuesta.json()
    
    return {
        'temperatura': datos['main']['temp'],
        'descripcion': datos['weather'][0]['description']
    }</code></pre></div>` },
            { title: "Consola Interactiva", content: `<div id="console-nivel-18"></div><script>createInteractiveConsole(\`# Simulación de API (sin requests real)
# En producción usarías: import requests

class APISimulada:
    def get(self, url):
        # Simular respuesta de API
        return {
            'status_code': 200,
            'json': lambda: {
                'ciudad': 'Madrid',
                'temperatura': 22,
                'descripcion': 'Soleado',
                'humedad': 45
            }
        }

api = APISimulada()
respuesta = api.get("https://api.clima.com/madrid")

if respuesta['status_code'] == 200:
    datos = respuesta['json']()
    print("🌡️ Clima en {}:".format(datos['ciudad']))
    print("   Temperatura: {}°C".format(datos['temperatura']))
    print("   Condición: {}".format(datos['descripcion']))
    print("   Humedad: {}%".format(datos['humedad']))\`, 'console-nivel-18');<\/script><p><strong>Caso real:</strong> Integración con servicios externos (clima, mapas, redes sociales, pagos).</p>` }
        ],
        quiz: [
            { type: "multiple-choice", question: "¿Qué es una API REST?", options: ["Base de datos", "Interfaz para comunicación HTTP", "Lenguaje de programación", "Framework"], answer: "Interfaz para comunicación HTTP" },
            { type: "multiple-choice", question: "¿Qué método HTTP obtiene datos?", options: ["POST", "GET", "PUT", "DELETE"], answer: "GET" },
            { type: "multiple-choice", question: "¿Qué hace .json()?", options: ["Crea JSON", "Parsea respuesta a diccionario", "Envía JSON", "Valida JSON"], answer: "Parsea respuesta a diccionario" },
            { type: "multiple-choice", question: "¿Qué indica status_code 200?", options: ["Error", "Éxito", "No encontrado", "Creado"], answer: "Éxito" },
            { type: "multiple-choice", question: "¿Para qué sirven los params?", options: ["Headers", "Parámetros de URL", "Body", "Cookies"], answer: "Parámetros de URL" }
        ]
    },
    { // Nivel 19
        title: "Web Scraping",
        lesson: [
            { title: "¿Qué es Web Scraping?", content: `<p><strong>Web scraping</strong> es extraer datos de sitios web automáticamente. Se usa para:</p><ul><li>Monitoreo de precios</li><li>Agregación de noticias</li><li>Investigación de mercado</li><li>Análisis de datos</li></ul><p><strong>⚠️ Ética:</strong> Respetar robots.txt, no sobrecargar servidores, revisar términos de servicio.</p>` },
            { title: "BeautifulSoup", content: `<div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python">import requests
from bs4 import BeautifulSoup

# Obtener HTML
respuesta = requests.get("https://ejemplo.com")
html = respuesta.text

# Parsear HTML
soup = BeautifulSoup(html, 'html.parser')

# Buscar elementos
titulos = soup.find_all('h2', class_='titulo')
for titulo in titulos:
    print(titulo.text)

# Buscar por CSS selector
enlaces = soup.select('a.link-importante')
for enlace in enlaces:
    print(enlace['href'])</code></pre></div>` },
            { title: "Scraper de Noticias", content: `<div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python">from bs4 import BeautifulSoup
import requests

def extraer_noticias(url):
    respuesta = requests.get(url)
    soup = BeautifulSoup(respuesta.text, 'html.parser')
    
    noticias = []
    for articulo in soup.find_all('article'):
        titulo = articulo.find('h2').text
        resumen = articulo.find('p').text
        noticias.append({
            'titulo': titulo,
            'resumen': resumen
        })
    
    return noticias</code></pre></div>` },
            { title: "Consola Interactiva", content: `<p><strong>💡 Nota:</strong> El web scraping requiere librerías externas como BeautifulSoup. En un proyecto real, usarías <code>pip install beautifulsoup4 requests</code> y luego importarías estas librerías para analizar HTML de sitios web reales.</p><p><strong>Caso real:</strong> Monitoreo de precios, agregadores de noticias, análisis de competencia.</p>` }
        ],
        quiz: [
            { type: "multiple-choice", question: "¿Qué es web scraping?", options: ["Crear sitios web", "Extraer datos de sitios web", "Diseñar páginas", "Hostear sitios"], answer: "Extraer datos de sitios web" },
            { type: "multiple-choice", question: "¿Qué librería parsea HTML?", options: ["requests", "BeautifulSoup", "scrapy", "selenium"], answer: "BeautifulSoup" },
            { type: "multiple-choice", question: "¿Qué hace find_all()?", options: ["Encuentra un elemento", "Encuentra todos los elementos", "Crea elementos", "Elimina elementos"], answer: "Encuentra todos los elementos" },
            { type: "multiple-choice", question: "¿Qué es robots.txt?", options: ["Archivo de configuración", "Reglas de scraping del sitio", "Base de datos", "Script"], answer: "Reglas de scraping del sitio" },
            { type: "multiple-choice", question: "¿Para qué sirve .text?", options: ["Crear texto", "Obtener texto del elemento", "Buscar texto", "Eliminar texto"], answer: "Obtener texto del elemento" }
        ]
    },
    { // Nivel 20 - DESAFÍO FINAL
        title: "Proyecto Final Integrador",
        lesson: [
            { title: "Integrando Todo lo Aprendido", content: `<p>¡Llegaste al final del curso! Ahora crearás un <strong>proyecto que integra TODOS los conceptos</strong>:</p><ul><li>✅ POO (clases, herencia, encapsulamiento)</li><li>✅ Manejo de archivos y persistencia</li><li>✅ Fechas y tiempo</li><li>✅ APIs y requests</li><li>✅ Web scraping (opcional)</li></ul>` },
            { title: "Opciones de Proyecto", content: `<p><strong>Opción 1: Bot de Noticias Automático</strong></p><ul><li>Hace scraping de múltiples fuentes</li><li>Filtra por categorías usando POO</li><li>Guarda en archivos por fecha</li><li>Envía resumen (simulado)</li></ul><p><strong>Opción 2: Sistema de Gestión Empresarial</strong></p><ul><li>Gestiona productos, clientes, ventas</li><li>Persistencia con JSON</li><li>Reportes por fecha</li><li>Interfaz de menú</li></ul><p><strong>Opción 3: Analizador de Datos</strong></p><ul><li>Obtiene datos de API</li><li>Procesa y analiza</li><li>Guarda resultados</li><li>Genera estadísticas</li></ul>` },
            { title: "Ejemplo: Sistema de Tareas con API", content: `<div class="code-block rounded-lg overflow-hidden mt-4"><div class="code-block-header px-4 py-2 flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><pre class="p-4"><code class="language-python">from datetime import datetime
import json

class Tarea:
    def __init__(self, titulo, prioridad="media"):
        self.titulo = titulo
        self.prioridad = prioridad
        self.completada = False
        self.fecha_creacion = datetime.now()
    
    def completar(self):
        self.completada = True
    
    def to_dict(self):
        return {
            'titulo': self.titulo,
            'prioridad': self.prioridad,
            'completada': self.completada,
            'fecha': self.fecha_creacion.isoformat()
        }

class GestorTareas:
    def __init__(self):
        self.tareas = []
    
    def agregar(self, tarea):
        self.tareas.append(tarea)
    
    def listar_pendientes(self):
        return [t for t in self.tareas if not t.completada]
    
    def guardar(self, archivo="tareas.json"):
        with open(archivo, 'w') as f:
            json.dump([t.to_dict() for t in self.tareas], f)</code></pre></div>` },
            { title: "Consola Interactiva - Proyecto Demo", content: `<p><strong>🎮 Desafío Final python_challenge8:</strong> Crea tu propio proyecto integrando POO, archivos, fechas y APIs. Usa las clases <code>Tarea</code> y <code>GestorTareas</code> como base y expándelas con funcionalidades como:</p><ul><li>Guardar tareas en archivo JSON</li><li>Cargar tareas desde archivo</li><li>Filtrar por prioridad o fecha</li><li>Integrar con una API de tareas (opcional)</li></ul>` },
            { title: "¡Felicidades!", content: `<h3>🎉 ¡Completaste el Curso de Python!</h3><p>Ahora dominas:</p><ul><li>✅ Fundamentos de Python</li><li>✅ Estructuras de datos</li><li>✅ Programación Orientada a Objetos</li><li>✅ Manejo de archivos</li><li>✅ Automatizaciones</li><li>✅ APIs y Web Scraping</li><li>✅ Proyectos reales</li></ul><p><strong>Próximos pasos:</strong></p><ul><li>Practica con proyectos personales</li><li>Explora frameworks (Django, Flask, FastAPI)</li><li>Aprende Data Science (pandas, numpy, matplotlib)</li><li>Contribuye a proyectos open source</li></ul><p><strong>¡Sigue programando! 🚀</strong></p>` }
        ],
        quiz: [
            { type: "multiple-choice", question: "¿Qué integra un proyecto completo?", options: ["Solo POO", "POO + archivos + APIs", "Solo APIs", "Solo archivos"], answer: "POO + archivos + APIs" },
            { type: "multiple-choice", question: "¿Para qué sirve to_dict()?", options: ["Crear diccionario", "Serializar objeto", "Eliminar objeto", "Copiar objeto"], answer: "Serializar objeto" },
            { type: "multiple-choice", question: "¿Qué permite la persistencia?", options: ["Ejecutar código", "Guardar datos permanentemente", "Crear objetos", "Eliminar archivos"], answer: "Guardar datos permanentemente" },
            { type: "multiple-choice", question: "¿Cuál es un buen próximo paso?", options: ["Dejar de programar", "Practicar con proyectos", "Olvidar Python", "No hacer nada"], answer: "Practicar con proyectos" },
            { type: "multiple-choice", question: "¿Qué aprendiste en este curso?", options: ["Nada", "Algo", "Mucho", "Todo lo necesario para empezar"], answer: "Todo lo necesario para empezar" }
        ]
    }
];

console.log("✅ courseData loaded successfully", courseData.length);



// --- LÓGICA DE QUIZ MEJORADA ---
let currentQuizType = "";
let currentQuizData = {};
let userAnswers = {};
let foundErrors = [];

// --- LÓGICA DE LA APLICACIÓN (STRICT FIREBASE) ---
let currentLevel = 0;
let resultsScoreV = 0;
let currentLessonStep = 0;
let currentQuizQuestion = 0;
let score = 0;
let currentPracticeStep = 0;
let userProgress = { completedLevels: [], quizScores: {} };
const COURSE_ID = 'python';

const challengeMap = {
    4: { id: 'python_challenge1', title: 'Desafío: Variables' },
    5: { id: 'python_challenge2', title: 'Desafío: Control' },
    9: { id: 'python_challenge3', title: 'Desafío: Funciones' },
    10: { id: 'python_challenge4', title: 'Desafío: Diccionarios' },
    14: { id: 'python_challenge5', title: 'Desafío: POO Básica' },
    15: { id: 'python_challenge6', title: 'Desafío: Excepciones' },
    18: { id: 'python_challenge7', title: 'Desafío: Datos' },
    19: { id: 'python_challenge8', title: 'Desafío Final: Integración' }
};

// INIT (Strict)
document.addEventListener('DOMContentLoaded', async () => {
    // Dynamic Import to ensure Firebase is loaded before proceeding
    let firebaseTools;
    try {
        firebaseTools = await import('./assets/js/firebase-config.js');
    } catch(e) {
        console.error("Critical: Failed to load Firebase.", e);
        // Intentar continuar sin Firebase en modo offline
        console.warn('⚠️ Continuando en modo offline (sin sincronización con Firestore)');
        
        // Cargar datos desde localStorage
        const localSession = JSON.parse(localStorage.getItem('currentUser'));
        if (!localSession || !localSession.id) {
            console.warn('⚠️ Sesión inválida en Python Course.');
            window.location.href = 'index.html';
            return;
        }
        
        // Cargar progreso desde localStorage
        const savedProgress = localStorage.getItem('pythonCourseProgress');
        if (savedProgress) {
            try {
                userProgress = JSON.parse(savedProgress);
            } catch (e) {
                console.error('❌ Error parsing saved progress:', e);
                userProgress = { completedLevels: [], quizScores: {} };
            }
        } else {
            console.log('🆕 Inicializando progreso Python vacío.');
            userProgress = { completedLevels: [], quizScores: {} };
        }
        
        // Renderizar interfaz
        if (window.renderLevelSelection) renderLevelSelection();
        if (window.showPanel) showPanel('levelSelection');
        return;
    }
    
    // Extract functions
    const { showLoading, hideLoading, checkConnection, getUserFromFirestore } = firebaseTools;
    
    if (!checkConnection()) return;
    if (showLoading) showLoading('Sincronizando curso Python...');
    
    const localSession = JSON.parse(localStorage.getItem('currentUser'));
    if (!localSession || !localSession.id) {
        console.warn('⚠️ Sesión inválida en Python Course.');
        window.location.href = 'index.html';
        return;
    }
    
    try {
        if (getUserFromFirestore) {
            const firestoreUser = await getUserFromFirestore(localSession.id);
            if (!firestoreUser) throw new Error('Usuario no encontrado en DB.');
            
            // Sync Local State
            if (firestoreUser.pythonProgress) {
                userProgress = firestoreUser.pythonProgress;
                // Defaults
                if (!userProgress.completedLevels) userProgress.completedLevels = [];
                if (!userProgress.quizScores) userProgress.quizScores = {};
            } else {
                console.log('🆕 Inicializando progreso Python vacío.');
                userProgress = { completedLevels: [], quizScores: {} };
            }
            
            // Update Session Cache
            localStorage.setItem('currentUser', JSON.stringify(firestoreUser));
            localStorage.setItem('pythonCourseProgress', JSON.stringify(userProgress));
        }
        
        // Initial Render
        if (window.renderLevelSelection) renderLevelSelection();
        if (window.showPanel) showPanel('levelSelection');
        
        // Check for Challenge Return
        const urlParams = new URLSearchParams(window.location.search);
        const challengeCompleted = urlParams.get('completed');
        
        if (hideLoading) hideLoading();
        
    } catch (e) {
        console.error('❌ Error Init Python:', e);
        
        // Solo redirigir si es un error crítico (no de Pyodide/postMessage)
        if (e.message && !e.message.includes('postMessage') && !e.message.includes('Pyodide')) {
            alert('Error cargando curso: ' + e.message);
            window.location.href = 'menu_inicio.html';
        } else {
            console.warn('⚠️ Error no crítico de Pyodide - continuando con la carga del curso');
            // Intentar renderizar de todos modos
            if (window.renderLevelSelection) renderLevelSelection();
            if (window.showPanel) showPanel('levelSelection');
            if (hideLoading) hideLoading();
        }
    }
});

async function saveProgress() {
    // 1. Update Global wrapper variable if needed (userProgress IS valid here)
    // 2. Sync to Firebase
    const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
    if (currentUser.id && window.updateCourseProgress) {
        
        // Prepare payload
        const progressPayload = {
            ...userProgress,
            lastUpdated: new Date().toISOString()
        };
        
        // Optimistic Cache Update
        currentUser.pythonProgress = progressPayload;
        localStorage.setItem('currentUser', JSON.stringify(currentUser));
        // localStorage.setItem('pythonCourseProgress', ...) -> Removed per user request (Strict Firebase)
        
        try {
            await window.updateCourseProgress(currentUser.id, 'pythonProgress', progressPayload);
            console.log('✅ Python Progress Saved to Firestore');
        } catch (e) {
            console.error('❌ Error saving python progress:', e);
        }
    }
}

// Deprecated: updateGlobalUserProgress was legacy local storage sync. 
// We mapped functionality into saveProgress above. 
// Keeping empty dummy if called elsewhere, or safely removing.
function updateGlobalUserProgress() {
    saveProgress(); 
}

function markLevelCompleted(levelIndex) {
    if (!userProgress.completedLevels.includes(levelIndex)) {
        userProgress.completedLevels.push(levelIndex);
        saveProgress();
        showLevelUpNotification();
    }
    renderLevelSelection();
}

function showLevelUpNotification() {
    const notification = document.createElement('div');
    notification.id = 'level-up-notification';
    notification.className = 'fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50';
    notification.innerHTML = `
        <div class="bg-green-600 text-white px-6 py-4 rounded-lg shadow-xl text-center animate-bounce">
            <div class="text-4xl mb-2">🎉</div>
            <div class="text-xl font-bold">¡Nivel Completado!</div>
            <div class="text-lg">+1 Nivel</div>
        </div>
    `;
    document.body.appendChild(notification);

    setTimeout(() => {
        if (notification.parentNode) notification.parentNode.removeChild(notification);
    }, 3000);
}

const panels = { levelSelection: document.getElementById('level-selection-panel'), lesson: document.getElementById('lesson-panel'), quiz: document.getElementById('quiz-panel'), results: document.getElementById('results-panel'), practice: document.getElementById('practice-panel') };
const savedTheme = localStorage.getItem('theme') || 'dark';
if (savedTheme === 'light') document.documentElement.classList.remove('dark');

function showPanel(panelName) { 
    // Filtrar paneles null para evitar errores
    Object.values(panels).filter(p => p !== null).forEach(p => p.classList.remove('active')); 
    if(panels[panelName]) panels[panelName].classList.add('active'); 
    lucide.createIcons(); 
}

function renderLevelSelection() {
    const levelGrid = document.getElementById('level-grid');
    if (!levelGrid) return;
    
    levelGrid.innerHTML = '';
    
    // Asegurarse de que userProgress tiene las propiedades necesarias
    if (!userProgress.completedLevels) {
        userProgress.completedLevels = [];
    }
    
    courseData.forEach((level, index) => {
        // Un nivel está desbloqueado si:
        // 1. Es el nivel 1 (índice 0) O
        // 2. El nivel anterior está completado
        const isUnlocked = index === 0 || userProgress.completedLevels.includes(index - 1);
        const isCompleted = userProgress.completedLevels.includes(index);
        
        const levelNode = document.createElement('div');
        levelNode.className = `level-node ${isCompleted ? 'completed' : isUnlocked ? 'unlocked' : 'locked'}`;
        levelNode.style.display = 'flex';
        levelNode.style.flexDirection = 'column';
        levelNode.style.alignItems = 'center';
        levelNode.style.position = 'relative';
        levelNode.style.cursor = isUnlocked ? 'pointer' : 'not-allowed';
        
        const iconWrapper = document.createElement('div');
        iconWrapper.className = 'level-icon-wrapper';
        iconWrapper.style.width = '64px';
        iconWrapper.style.height = '64px';
        iconWrapper.style.borderRadius = '50%';
        iconWrapper.style.display = 'flex';
        iconWrapper.style.alignItems = 'center';
        iconWrapper.style.justifyContent = 'center';
        iconWrapper.style.border = '3px solid';
        iconWrapper.style.transition = 'all 0.3s ease';
        
        const icon = document.createElement('i');
        if (isCompleted) {
            icon.setAttribute('data-lucide', 'check-circle');
            iconWrapper.style.borderColor = 'var(--green)';
            iconWrapper.style.backgroundColor = 'var(--green)';
            iconWrapper.style.color = 'var(--card-background)';
        } else if (isUnlocked) {
            icon.setAttribute('data-lucide', 'circle');
            iconWrapper.style.borderColor = 'var(--accent)';
            iconWrapper.style.color = 'var(--accent)';
        } else {
            icon.setAttribute('data-lucide', 'lock');
            iconWrapper.style.borderColor = 'var(--border)';
            iconWrapper.style.color = 'var(--border)';
            iconWrapper.style.backgroundColor = 'transparent';
        }
        icon.className = 'w-8 h-8';
        
        iconWrapper.appendChild(icon);
        
        const levelNumber = document.createElement('div');
        levelNumber.className = 'level-number';
        levelNumber.textContent = `Nivel ${index + 1}`;
        levelNumber.style.marginTop = '8px';
        levelNumber.style.fontWeight = '600';
        levelNumber.style.fontSize = '0.9rem';
        
        levelNode.appendChild(iconWrapper);
        levelNode.appendChild(levelNumber);
        
        if (isUnlocked) {
            levelNode.addEventListener('click', () => startLevel(index));
        }
        
        levelGrid.appendChild(levelNode);
    });
    
    // Render practice levels grid
    const practiceLevelGrid = document.getElementById('practice-level-grid');
    if (practiceLevelGrid) {
        practiceLevelGrid.innerHTML = '';
        practiceData.forEach((practice, index) => {
            const practiceNode = document.createElement('div');
            practiceNode.className = 'level-node unlocked';
            practiceNode.style.display = 'flex';
            practiceNode.style.flexDirection = 'column';
            practiceNode.style.alignItems = 'center';
            practiceNode.style.cursor = 'pointer';
            
            const iconWrapper = document.createElement('div');
            iconWrapper.className = 'level-icon-wrapper';
            iconWrapper.style.width = '64px';
            iconWrapper.style.height = '64px';
            iconWrapper.style.borderRadius = '50%';
            iconWrapper.style.display = 'flex';
            iconWrapper.style.alignItems = 'center';
            iconWrapper.style.justifyContent = 'center';
            iconWrapper.style.border = '3px solid var(--yellow)';
            iconWrapper.style.color = 'var(--yellow)';
            
            const icon = document.createElement('i');
            icon.setAttribute('data-lucide', 'code-2');
            icon.className = 'w-8 h-8';
            iconWrapper.appendChild(icon);
            
            const practiceNumber = document.createElement('div');
            practiceNumber.className = 'level-number';
            practiceNumber.textContent = `Práctica ${index + 1}`;
            practiceNumber.style.marginTop = '8px';
            practiceNumber.style.fontWeight = '600';
            practiceNumber.style.fontSize = '0.9rem';
            
            practiceNode.appendChild(iconWrapper);
            practiceNode.appendChild(practiceNumber);
            
            practiceNode.addEventListener('click', () => startPractice(index));
            
            practiceLevelGrid.appendChild(practiceNode);
        });
    }
    
    lucide.createIcons();
}

function startLevel(levelIndex) { 
    currentLevel = levelIndex; 
    currentLessonStep = 0; 
    renderLesson(); 
    showPanel('lesson'); 
}

function renderLesson() {
    const levelData = courseData[currentLevel];
    const stepData = levelData.lesson[currentLessonStep];
    document.getElementById('lesson-title').textContent = `Nivel ${currentLevel + 1}: ${stepData.title}`;
    document.getElementById('lesson-content').innerHTML = stepData.content;
    
    // Inicializar Monaco para bloques estáticos inmediatamente
    setTimeout(() => {
        initializeCodeBlockMonaco();
        Prism.highlightAll(); // Fallback para otros elementos Prism si los hay
    }, 50);

    // Inicializar Consolas Interactivas
    setTimeout(() => {
        const consoles = document.querySelectorAll('#lesson-content [data-code-base64], #lesson-content [data-code]');
        consoles.forEach(div => {
            if (div.dataset.codeBase64) {
                 createInteractiveConsole(div.dataset.codeBase64, div.id, true);
            } else if (div.dataset.code) {
                createInteractiveConsole(div.dataset.code, div.id, false);
            }
        });
    }, 100);
    
    document.getElementById('lesson-step').textContent = `${currentLessonStep + 1} / ${levelData.lesson.length}`;
    const progress = ((currentLessonStep + 1) / levelData.lesson.length) * 100;
    document.getElementById('lesson-progress').style.width = `${progress}%`;
    const prevBtn = document.getElementById('prev-btn');
    prevBtn.disabled = currentLessonStep === 0;
    document.getElementById('next-btn').textContent = (currentLessonStep === levelData.lesson.length - 1) ? 'Iniciar Quiz' : 'Siguiente';

    // Re-initialize drag and drop after content change
    setTimeout(() => {
        if(window.initializeClickToPlace) initializeClickToPlace();
    }, 100);
}

function startQuiz() {
    currentQuizQuestion = 0;
    score = 0;
    renderQuizQuestion();
    showPanel('quiz');
    // Bloquear chat durante el quiz
    document.getElementById('chat-modal').classList.add('hidden');
    document.getElementById('chat-toggle-btn').style.display = 'none';
}

function renderQuizQuestion() {
    const levelData = courseData[currentLevel];
    const questionData = levelData.quiz[currentQuizQuestion];
    currentQuizData = questionData;
    currentQuizType = questionData.type;

    document.getElementById('quiz-level-title').textContent = `Quiz - Nivel ${currentLevel + 1}`;
    document.getElementById('quiz-progress').textContent = `${currentQuizQuestion + 1}/${levelData.quiz.length}`;
    document.getElementById('quiz-question').textContent = questionData.question;

    // Actualizar indicador de tipo de pregunta
    const typeNames = {
        "multiple-choice": "Selección múltiple",
    };
    document.getElementById('quiz-type-indicator').textContent = typeNames[currentQuizType] || "Pregunta";

    // Ocultar todos los contenedores primero
    document.querySelectorAll('#quiz-content > div').forEach(container => {
        container.classList.add('hidden');
    });

    // Limpiar respuestas anteriores
    userAnswers = {};
    foundErrors = [];
    document.getElementById('quiz-feedback').classList.add('hidden');

    // Mostrar el contenedor adecuado según el tipo de pregunta
    renderMultipleChoice();


    // Configurar botones
    document.getElementById('quiz-hint-btn').onclick = showHint;
}

function renderMultipleChoice() {
    const container = document.getElementById('multiple-choice-container');
    container.classList.remove('hidden');
    container.innerHTML = '';

    // Crear letras fijas en orden a, b, c, d
    const letters = ['a', 'b', 'c', 'd'];

    // Barajar las opciones antes de asignarlas a las letras
    const shuffledOptions = [...currentQuizData.options].sort(() => Math.random() - 0.5);

    // Crear opciones con letras fijas pero contenido aleatorio
    letters.forEach((letter, index) => {
        const optionButton = document.createElement('button');
        optionButton.textContent = `${letter}) ${shuffledOptions[index]}`;
        optionButton.className = 'quiz-option p-4 rounded-lg text-left';
        optionButton.dataset.answer = shuffledOptions[index];
        optionButton.dataset.isCorrect = shuffledOptions[index] === currentQuizData.answer ? 'true' : 'false';
        optionButton.onclick = () => {
            // Verificar si la respuesta es correcta y actualizar el score
            if (optionButton.dataset.isCorrect === 'true') {
                score++;
            }
            // Avanzar a la siguiente pregunta
            currentQuizQuestion++;
            if (currentQuizQuestion < courseData[currentLevel].quiz.length) {
                renderQuizQuestion();
            } else {
                showResults();
            }
        };
        container.appendChild(optionButton);
    });
}

function renderCodeCompletion() {
    const container = document.getElementById('code-completion-container');
    container.classList.remove('hidden');

    // Configurar el código con inputs
    document.getElementById('code-completion-code').innerHTML = currentQuizData.code;

    // Agregar event listeners a los inputs
    setTimeout(() => {
        document.querySelectorAll('.code-input').forEach(input => {
            const inputElement = document.createElement('input');
            inputElement.type = 'text';
            inputElement.className = 'code-completion-input';
            inputElement.dataset.answer = input.dataset.answer;
            inputElement.addEventListener('input', function() {
                userAnswers[input.dataset.answer] = this.value;
            });
            input.parentNode.replaceChild(inputElement, input);
        });
    }, 100);
}

function renderDragDrop() {
    const container = document.getElementById('drag-drop-container');
    container.classList.remove('hidden');

    // Barajar opciones
    const shuffledOptions = [...currentQuizData.options].sort(() => Math.random() - 0.5);

    // Crear área de opciones
    const optionsArea = document.createElement('div');
    optionsArea.className = 'drag-drop-options';
    optionsArea.innerHTML = '<h4 class="text-sm font-semibold mb-2">Opciones:</h4>';

    shuffledOptions.forEach(option => {
        const optionElement = document.createElement('div');
        optionElement.className = 'drag-option';
        optionElement.textContent = option;
        optionElement.draggable = true;
        optionElement.addEventListener('dragstart', handleDragStart);
        optionsArea.appendChild(optionElement);
    });

    // Crear área de destino
    const targetsArea = document.createElement('div');
    targetsArea.className = 'drag-drop-targets';
    targetsArea.innerHTML = '<h4 class="text-sm font-semibold mb-2">Arrastra aquí en orden:</h4>';

    currentQuizData.correctOrder.forEach(() => {
        const targetElement = document.createElement('div');
        targetElement.className = 'drag-target';
        targetElement.addEventListener('dragover', handleDragOver);
        targetElement.addEventListener('drop', handleDrop);
        targetsArea.appendChild(targetElement);
    });

    // Limpiar y agregar elementos
    container.innerHTML = '';
    container.appendChild(optionsArea);
    container.appendChild(targetsArea);
}

function handleDragStart(e) {
    e.dataTransfer.setData('text/plain', e.target.textContent);
}

function handleDragOver(e) {
    e.preventDefault();
}

function handleDrop(e) {
    e.preventDefault();
    const data = e.dataTransfer.getData('text/plain');
    const target = e.target.closest('.drag-target');

    if (target && !target.querySelector('.drag-option')) {
        const optionElement = document.createElement('div');
        optionElement.className = 'drag-option';
        optionElement.textContent = data;
        optionElement.draggable = false;
        target.appendChild(optionElement);
        target.classList.add('occupied');

        // Guardar respuesta
        const targetIndex = Array.from(target.parentNode.children).indexOf(target);
        userAnswers[targetIndex] = data;
    }
}

function renderMatching() {
    const container = document.getElementById('matching-container');
    container.classList.remove('hidden');
    container.innerHTML = '';

    // Barajar pares
    const shuffledPairs = [...currentQuizData.pairs].sort(() => Math.random() - 0.5);

    // Crear columnas
    const conceptsColumn = document.createElement('div');
    const descriptionsColumn = document.createElement('div');

    conceptsColumn.innerHTML = '<h4 class="text-sm font-semibold mb-2">Conceptos:</h4>';
    descriptionsColumn.innerHTML = '<h4 class="text-sm font-semibold mb-2">Descripciones:</h4>';

    shuffledPairs.forEach(pair => {
        const conceptElement = document.createElement('div');
        conceptElement.className = 'matching-item';
        conceptElement.textContent = pair.concept;
        conceptElement.dataset.concept = pair.concept;
        conceptElement.addEventListener('click', () => selectMatchingItem(conceptElement, 'concept'));
        conceptsColumn.appendChild(conceptElement);

        const descriptionElement = document.createElement('div');
        descriptionElement.className = 'matching-item';
        descriptionElement.textContent = pair.description;
        descriptionElement.dataset.concept = pair.concept;
        descriptionElement.addEventListener('click', () => selectMatchingItem(descriptionElement, 'description'));
        descriptionsColumn.appendChild(descriptionElement);
    });

    container.appendChild(conceptsColumn);
    container.appendChild(descriptionsColumn);
}

let selectedConcept = null;
let selectedDescription = null;

function selectMatchingItem(element, type) {
    if (type === 'concept') {
        // Deseleccionar concepto anterior
        if (selectedConcept) {
            selectedConcept.classList.remove('selected');
        }

        selectedConcept = element;
        element.classList.add('selected');
    } else {
        // Deseleccionar descripción anterior
        if (selectedDescription) {
            selectedDescription.classList.remove('selected');
        }

        selectedDescription = element;
        element.classList.add('selected');
    }

    // Si ambos están seleccionados, verificar si coinciden
    if (selectedConcept && selectedDescription) {
        if (selectedConcept.dataset.concept === selectedDescription.dataset.concept) {
            // Coinciden - marcarlos como emparejados
            selectedConcept.classList.remove('selected');
            selectedConcept.classList.add('matched');
            selectedDescription.classList.remove('selected');
            selectedDescription.classList.add('matched');

            // Guardar emparejamiento
            userAnswers[selectedConcept.dataset.concept] = true;

            // Resetear selección
            selectedConcept = null;
            selectedDescription = null;
        } else {
            // No coinciden - quitar selección después de un breve momento
            setTimeout(() => {
                selectedConcept.classList.remove('selected');
                selectedDescription.classList.remove('selected');
                selectedConcept = null;
                selectedDescription = null;
            }, 1000);
        }
    }
}

function renderOrdering() {
    const container = document.getElementById('ordering-container');
    container.classList.remove('hidden');
    container.innerHTML = '';

    // Barajar pasos
    const shuffledSteps = [...currentQuizData.steps].sort(() => Math.random() - 0.5);

    shuffledSteps.forEach(step => {
        const stepElement = document.createElement('div');
        stepElement.className = 'ordering-item';
        stepElement.draggable = true;
        stepElement.dataset.step = step;

        const handleElement = document.createElement('div');
        handleElement.className = 'ordering-handle';
        handleElement.innerHTML = '<i data-lucide="grip-vertical"></i>';

        stepElement.appendChild(handleElement);
        stepElement.appendChild(document.createTextNode(step));

        stepElement.addEventListener('dragstart', handleOrderingDragStart);
        stepElement.addEventListener('dragover', handleOrderingDragOver);
        stepElement.addEventListener('drop', handleOrderingDrop);
        stepElement.addEventListener('dragend', handleOrderingDragEnd);

        container.appendChild(stepElement);
    });

    setTimeout(() => lucide.createIcons(), 100);
}

let draggedElement = null;

function handleOrderingDragStart(e) {
    draggedElement = e.target;
    e.dataTransfer.effectAllowed = 'move';
    e.dataTransfer.setData('text/html', e.target.outerHTML);
    e.target.classList.add('dragging');
}

function handleOrderingDragOver(e) {
    e.preventDefault();
    e.dataTransfer.dropEffect = 'move';

    const target = e.target.closest('.ordering-item');
    if (target && target !== draggedElement) {
        const rect = target.getBoundingClientRect();
        const next = (e.clientY - rect.top) / (rect.bottom - rect.top) > 0.5;
        container.insertBefore(draggedElement, next ? target.nextSibling : target);
    }
}

function handleOrderingDrop(e) {
    e.preventDefault();
}

function handleOrderingDragEnd(e) {
    e.target.classList.remove('dragging');

    // Guardar orden actual
    userAnswers.order = Array.from(document.querySelectorAll('.ordering-item')).map(item => item.dataset.step);
}

function renderErrorFinding() {
    const container = document.getElementById('error-finding-container');
    container.classList.remove('hidden');

    // Crear contenedor de código con áreas clickeables para errores
    const codeContainer = document.createElement('div');
    codeContainer.className = 'error-code';

    // Dividir el código en líneas
    const lines = currentQuizData.code.split('\n');

    lines.forEach((line, lineIndex) => {
        const lineElement = document.createElement('div');
        lineElement.className = 'flex';

        // Número de línea
        const lineNumber = document.createElement('div');
        lineNumber.className = 'w-8 text-right pr-2 text-gray-500 select-none';
        lineNumber.textContent = lineIndex + 1;
        lineElement.appendChild(lineNumber);

        // Contenido de la línea
        const lineContent = document.createElement('div');
        lineContent.className = 'flex-1 relative';
        lineContent.innerHTML = `<code class="language-python">${line}</code>`;

        // Agregar áreas clickeables para errores en esta línea
        currentQuizData.errors.forEach(error => {
            if (error.line === lineIndex + 1) {
                const errorSpot = document.createElement('div');
                errorSpot.className = 'error-spot';
                errorSpot.style.left = `${error.start}ch`;
                errorSpot.style.width = `${error.end - error.start}ch`;
                errorSpot.style.height = '1.2em';
                errorSpot.style.top = '0';
                errorSpot.dataset.description = error.description;
                errorSpot.addEventListener('click', () => markErrorFound(errorSpot, error.description));
                lineContent.appendChild(errorSpot);
            }
        });

        lineElement.appendChild(lineContent);
        codeContainer.appendChild(lineElement);
    });

    container.innerHTML = '';
    container.appendChild(codeContainer);

    // Resaltar sintaxis
    setTimeout(() => Prism.highlightAll(), 100);
}

function markErrorFound(errorSpot, description) {
    if (!errorSpot.classList.contains('found')) {
        errorSpot.classList.add('found');
        foundErrors.push(description);
        userAnswers.foundErrors = foundErrors;
    }
}

function showHint() {
    let hint = "";

    switch(currentQuizType) {
        case "multiple-choice":
            hint = "Lee cuidadosamente todas las opciones antes de seleccionar una.";
            break;
        case "code-completion":
            hint = "Piensa en qué función o palabra clave falta para que el código funcione correctamente.";
            break;
        case "drag-drop":
            hint = "Recuerda la sintaxis básica de Python para formar sentencias válidas.";
            break;
        case "matching":
            hint = "Haz clic primero en un concepto y luego en su descripción correspondiente.";
            break;
        case "ordering":
            hint = "Piensa en el orden lógico de los pasos para ejecutar un programa Python.";
            break;
        case "error-finding":
            hint = "Busca errores comunes como tipos de datos incorrectos o sintaxis mal formada.";
            break;
    }

    alert(hint);
}

function checkAnswer() {
    let isCorrect = false;
    const feedback = document.getElementById('quiz-feedback');

    switch(currentQuizType) {
        case "multiple-choice":
            isCorrect = userAnswers.selected === currentQuizData.answer;
            break;
        case "code-completion":
            isCorrect = Object.values(userAnswers).includes(currentQuizData.answer);
            break;
        case "drag-drop":
            const userOrder = Object.values(userAnswers);
            isCorrect = JSON.stringify(userOrder) === JSON.stringify(currentQuizData.correctOrder);
            break;
        case "matching":
            isCorrect = Object.keys(userAnswers).length === currentQuizData.pairs.length;
            break;
        case "ordering":
            isCorrect = JSON.stringify(userAnswers.order) === JSON.stringify(currentQuizData.correctOrder);
            break;
        case "error-finding":
            isCorrect = foundErrors.length === currentQuizData.errors.length;
            break;
    }

    // Mostrar feedback
    feedback.textContent = isCorrect ?
        "¡Correcto! " + (currentQuizData.explanation || "Buen trabajo.") :
        "Incorrecto. " + (currentQuizData.explanation || "Inténtalo de nuevo.");
    feedback.className = `quiz-feedback ${isCorrect ? 'correct' : 'incorrect'}`;
    feedback.classList.remove('hidden');

    // Si es correcto, avanzar después de un breve retraso
    if (isCorrect) {
        setTimeout(() => {
            currentQuizQuestion++;
            if (currentQuizQuestion < courseData[currentLevel].quiz.length) {
                renderQuizQuestion();
            } else {
                showResults();
            }
        }, 2000);
    }
}

function showResults() {
    const totalQuestions = courseData[currentLevel].quiz.length;
    const passed = score >= (totalQuestions * 0.7);
    const percentage = Math.round((score / totalQuestions) * 100);

    // Save Score logic
    if (userProgress.quizScores === undefined) userProgress.quizScores = {};
    if (userProgress.quizScores[currentLevel] === undefined || score > userProgress.quizScores[currentLevel]) {
        userProgress.quizScores[currentLevel] = score;
        saveProgress();
        // Guardar quizScores para leaderboard
        saveQuizScore(score, courseData[currentLevel].quiz.length, COURSE_ID, currentLevel + 1);
        // Mostrar challenge si corresponde
        checkAndShowChallenge(currentLevel, challengeMap);
    }

    const resultsTitle = document.getElementById('results-title');
    const resultsScore = document.getElementById('results-score');
    const resultsMessage = document.getElementById('results-message');
    const resultsIcon = document.getElementById('results-icon');
    const nextLevelBtn = document.getElementById('next-level-btn');
    const challengeBtn = document.getElementById('code-challenge-btn');

    resultsScore.textContent = `Puntuación: ${score}/${totalQuestions} (${percentage}%)`;

    if (passed) {
        resultsTitle.textContent = '¡Felicidades!';
        resultsMessage.textContent = 'Has aprobado el cuestionario.';
        resultsIcon.setAttribute('data-lucide', 'award');
        resultsIcon.style.color = 'var(--green)';

        // La lógica de checkAndShowChallenge en course_system.js se encarga del botón
        if (!challengeMap[currentLevel]) {
            challengeBtn.classList.add('hidden');
            nextLevelBtn.classList.remove('hidden');
            markLevelCompleted(currentLevel);
        }

    } else {
        resultsTitle.textContent = '¡Inténtalo de nuevo!';
        resultsMessage.textContent = 'Necesitas al menos 70% para aprobar.';
        resultsIcon.setAttribute('data-lucide', 'refresh-cw');
        resultsIcon.style.color = 'var(--red)';
        nextLevelBtn.classList.add('hidden');
        challengeBtn.classList.add('hidden');
    }
    
    lucide.createIcons();
    showPanel('results');
    
    // Desbloquear chat después del quiz (Removed)
    // document.getElementById('chat-toggle-btn').style.display = 'block';
}

// Render Level Selection Grid
function renderLevelSelection() {
    const levelGrid = document.getElementById('level-grid');
    if (!levelGrid) return;
    
    levelGrid.innerHTML = '';
    levelGrid.style.display = 'grid';
    levelGrid.style.gridTemplateColumns = 'repeat(auto-fit, minmax(80px, 1fr))';
    levelGrid.style.gap = '32px 16px';
    levelGrid.style.width = '100%';
    levelGrid.style.maxWidth = '60rem';
    levelGrid.style.margin = '0 auto';
    
    courseData.forEach((level, index) => {
        const isUnlocked = index < userProgress.unlockedLevel;
        const isCompleted = userProgress.completedLevels.includes(index);
        
        const levelNode = document.createElement('div');
        levelNode.className = `level-node ${isCompleted ? 'completed' : isUnlocked ? 'unlocked' : 'locked'}`;
        levelNode.style.display = 'flex';
        levelNode.style.flexDirection = 'column';
        levelNode.style.alignItems = 'center';
        levelNode.style.position = 'relative';
        levelNode.style.cursor = isUnlocked ? 'pointer' : 'not-allowed';
        
        const iconWrapper = document.createElement('div');
        iconWrapper.className = 'level-icon-wrapper';
        iconWrapper.style.width = '64px';
        iconWrapper.style.height = '64px';
        iconWrapper.style.borderRadius = '50%';
        iconWrapper.style.display = 'flex';
        iconWrapper.style.alignItems = 'center';
        iconWrapper.style.justifyContent = 'center';
        iconWrapper.style.border = '3px solid';
        iconWrapper.style.transition = 'all 0.3s ease';
        
        const icon = document.createElement('i');
        if (isCompleted) {
            icon.setAttribute('data-lucide', 'check-circle');
            iconWrapper.style.borderColor = 'var(--green)';
            iconWrapper.style.backgroundColor = 'var(--green)';
            iconWrapper.style.color = 'var(--card-background)';
        } else if (isUnlocked) {
            icon.setAttribute('data-lucide', 'circle');
            iconWrapper.style.borderColor = 'var(--accent)';
            iconWrapper.style.color = 'var(--accent)';
        } else {
            icon.setAttribute('data-lucide', 'lock');
            iconWrapper.style.borderColor = 'var(--border)';
            iconWrapper.style.color = 'var(--border)';
            iconWrapper.style.backgroundColor = 'transparent';
        }
        icon.className = 'w-8 h-8';
        
        iconWrapper.appendChild(icon);
        
        const levelNumber = document.createElement('div');
        levelNumber.className = 'level-number';
        levelNumber.textContent = `Nivel ${index + 1}`;
        levelNumber.style.marginTop = '8px';
        levelNumber.style.fontWeight = '600';
        levelNumber.style.fontSize = '0.9rem';
        
        levelNode.appendChild(iconWrapper);
        levelNode.appendChild(levelNumber);
        
        if (isUnlocked) {
            levelNode.addEventListener('click', () => startLevel(index));
        }
        
        levelGrid.appendChild(levelNode);
    });
    

    
    lucide.createIcons();
}

// Event Listeners
document.getElementById('next-btn').addEventListener('click', () => { 
    if (currentLessonStep < courseData[currentLevel].lesson.length - 1) { 
        currentLessonStep++; 
        renderLesson(); 
    } else { 
        startQuiz(); 
    } 
});

document.getElementById('prev-btn').addEventListener('click', () => { 
    if (currentLessonStep > 0) { 
        currentLessonStep--; 
        renderLesson(); 
    } 
});

document.getElementById('close-lesson-btn').addEventListener('click', () => { 
    renderLevelSelection(); 
    showPanel('levelSelection'); 
});

document.getElementById('retry-lesson-btn').addEventListener('click', () => startLevel(currentLevel));

document.getElementById('next-level-btn').addEventListener('click', () => {
    if (currentLevel + 1 < courseData.length) {
        startLevel(currentLevel + 1);
    } else {
        renderLevelSelection();
        showPanel('levelSelection');
    }
});



// Elemento 'close-practice-btn' no existe en el HTML - comentado para evitar error
// document.getElementById('close-practice-btn').addEventListener('click', () => {
//     renderLevelSelection();
//     showPanel('levelSelection');
// });

// Theme toggle
document.getElementById('theme-toggle').addEventListener('click', () => {
    const isDark = document.documentElement.classList.toggle('dark');
    localStorage.setItem('theme', isDark ? 'dark' : 'light');
    const icon = document.querySelector('#theme-toggle i');
    icon.setAttribute('data-lucide', isDark ? 'sun' : 'moon');
    lucide.createIcons();
});

// Chat functionality removed


// Error finding functionality
function initializeErrorFinding() {
    // Check if elements exist before adding event listeners
    const giveUpBtn1 = document.getElementById('give-up-1');
    const giveUpBtn2 = document.getElementById('give-up-2');
    
    if (giveUpBtn1) {
        giveUpBtn1.addEventListener('click', () => {
            const solution1 = document.getElementById('solution-1');
            if (solution1) {
                solution1.classList.remove('hidden');
            }
        });
    }
    
    if (giveUpBtn2) {
        giveUpBtn2.addEventListener('click', () => {
            const solution2 = document.getElementById('solution-2');
            if (solution2) {
                solution2.classList.remove('hidden');
            }
        });
    }
}

function getErrorsForBlock(blockId) {
    const errorMap = {
        'error-code-1': ['input("Ingresa tu edad: ")', '"Hola {nombre}, tienes {edad} años!"'],
        'error-code-2': ['input("Primer número: ")', 'input("Segundo número: ")', 'if num1 > num2', 'else num2 > num1:']
    };
    return errorMap[blockId] || [];
}

function checkAllErrorsFound(blockId) {
    // Track found errors and update counter
    const errorCounts = {
        'error-code-1': 2,
        'error-code-2': 4
    };

    // In a real implementation, track which errors have been found
    // For now, just show encouragement
    setTimeout(() => {
        alert('¡Bien! Has encontrado un error. Sigue buscando los demás.');
        updateCommandCounter(blockId);
    }, 500);
}

function updateCommandCounter(blockId) {
    const counterMap = {
        'error-code-1': 'command-counter-1',
        'error-code-2': 'command-counter-2'
    };

    const counterElement = document.getElementById(counterMap[blockId]);
    if (counterElement) {
        // Simulate finding errors - in real implementation, track actual found errors
        const current = parseInt(counterElement.textContent.split(':')[1].split('/')[0]);
        if (current < parseInt(counterElement.textContent.split('/')[1])) {
            counterElement.textContent = `Usados: ${current + 1}/${counterElement.textContent.split('/')[1]}`;
        }
    }
}

// Code completion functionality
function initializeCodeCompletion() {
    // Initialize click-to-place for fill exercises
    initializeClickToPlace();
}

let selectedCommand = null;

function initializeClickToPlace() {
    // Remove existing event listeners to avoid duplicates
    document.querySelectorAll('.command-item').forEach(item => {
        item.removeEventListener('click', handleCommandSelect);
        item.addEventListener('click', handleCommandSelect);
    });

    // Make drop zones clickable for placement
    document.querySelectorAll('.drop-zone').forEach(zone => {
        zone.removeEventListener('click', handleZoneClick);
        zone.addEventListener('click', handleZoneClick);
    });

    // Reset buttons - only add if they exist
    const resetBtn1 = document.getElementById('reset-fill-1');
    const resetBtn2 = document.getElementById('reset-fill-2');
    if (resetBtn1) {
        resetBtn1.removeEventListener('click', () => resetFill(1));
        resetBtn1.addEventListener('click', () => resetFill(1));
    }
    if (resetBtn2) {
        resetBtn2.removeEventListener('click', () => resetFill(2));
        resetBtn2.addEventListener('click', () => resetFill(2));
    }
}

function handleCommandSelect(e) {
    // Remove previous selection
    document.querySelectorAll('.command-item.selected').forEach(item => {
        item.classList.remove('selected');
    });

    // Select this command
    selectedCommand = e.target.dataset.command;
    e.target.classList.add('selected');

    // Add visual feedback - command follows mouse
    document.addEventListener('mousemove', followMouse);
}

function followMouse(e) {
    if (selectedCommand) {
        const selectedElement = document.querySelector('.command-item.selected');
        if (selectedElement) {
            // Create floating element that follows mouse
            let floatingElement = document.getElementById('floating-command');
            if (!floatingElement) {
                floatingElement = document.createElement('div');
                floatingElement.id = 'floating-command';
                floatingElement.className = 'fixed bg-blue-500 text-white px-3 py-1 rounded shadow-lg pointer-events-none z-50';
                floatingElement.textContent = selectedCommand;
                document.body.appendChild(floatingElement);
            }
            floatingElement.style.left = (e.clientX + 10) + 'px';
            floatingElement.style.top = (e.clientY + 10) + 'px';
        }
    }
}

function handleZoneClick(e) {
    if (selectedCommand && !e.currentTarget.dataset.value) {
        const dropZone = e.currentTarget;

        // Clear previous content
        dropZone.textContent = '';

        // Add the command
        const commandSpan = document.createElement('span');
        commandSpan.textContent = selectedCommand;
        commandSpan.className = 'bg-blue-500 text-white px-2 py-1 rounded text-sm';
        dropZone.appendChild(commandSpan);

        // Store the value
        dropZone.dataset.value = selectedCommand;

        // Hide the selected item
        const selectedItem = document.querySelector('.command-item.selected');
        if (selectedItem) {
            selectedItem.style.display = 'none';
            selectedItem.classList.remove('selected');
        }

        // Remove floating element
        const floatingElement = document.getElementById('floating-command');
        if (floatingElement) {
            floatingElement.remove();
        }

        // Clear selection
        selectedCommand = null;
        document.removeEventListener('mousemove', followMouse);
    }
}

function resetFill(exerciseNum) {
    // Reset drop zones
    document.querySelectorAll(`#practice-content .drop-zone`).forEach(zone => {
        zone.textContent = '';
        zone.dataset.value = '';
        zone.style.backgroundColor = '';
    });

    // Show all command items
    document.querySelectorAll('.command-item').forEach(item => {
        item.style.display = 'inline-block';
        item.style.opacity = '1';
    });

    // Reset feedback
    const feedback = document.getElementById(`fill-feedback-${exerciseNum}`);
    feedback.innerHTML = '';

    // Reset counter
    const counterElement = document.getElementById(`command-counter-fill-${exerciseNum}`);
    if (counterElement) {
        counterElement.textContent = `Completados: 0/${counterElement.textContent.split('/')[1]}`;
    }
}

function checkFill(exerciseNum) {
    const answers = {
        1: ['input', 'int', 'input', 'f'],
        2: ['float', 'input', 'float', 'input', 'f', 'if', 'f', 'elif', 'f', 'else']
    };

    const correct = answers[exerciseNum];
    let allCorrect = true;
    const feedback = document.getElementById(`fill-feedback-${exerciseNum}`);

    // Check drop zones instead of inputs
    const dropZones = document.querySelectorAll(`#practice-content .drop-zone`);
    dropZones.forEach((zone, index) => {
        const value = zone.dataset.value || '';
        if (value === correct[index]) {
            zone.style.borderColor = 'green';
            zone.style.backgroundColor = 'rgba(158, 206, 106, 0.1)';
        } else {
            zone.style.borderColor = 'red';
            zone.style.backgroundColor = 'rgba(247, 118, 142, 0.1)';
            allCorrect = false;
        }
    });

    if (allCorrect) {
        feedback.innerHTML = '<span style="color: green;">¡Excelente! Todos los huecos están correctos.</span>';
        updateFillCounter(exerciseNum, true);
    } else {
        feedback.innerHTML = '<span style="color: red;">Algunos huecos están incorrectos. Revisa y vuelve a intentar.</span>';
        updateFillCounter(exerciseNum, false);
    }
}

function updateFillCounter(exerciseNum, success) {
    const counterElement = document.getElementById(`command-counter-fill-${exerciseNum}`);
    if (counterElement) {
        const total = parseInt(counterElement.textContent.split('/')[1]);
        let current = parseInt(counterElement.textContent.split(':')[1].split('/')[0]);
        if (success && current < total) {
            current = total; // Mark as completed when all correct
        }
        counterElement.textContent = `Completados: ${current}/${total}`;
    }
}

// ========================================
// CONSOLA INTERACTIVA DE PYTHON CON MONACO EDITOR
// ========================================

let pyodide = null;
let pyodideReady = false;
let currentInputResolver = null;
window.monacoEditors = {}; // Store editor instances
let monacoRequireConfigured = false;

// Inicializar Pyodide
async function initPyodide() {
    if (pyodideReady) return;
    
    try {
        console.log('🐍 Inicializando Pyodide...');
        pyodide = await loadPyodide({
            indexURL: "https://cdn.jsdelivr.net/pyodide/v0.24.1/full/"
        });
        pyodideReady = true;
        console.log('✅ Pyodide listo!');
    } catch (error) {
        console.error('❌ Error al cargar Pyodide:', error);
    }
}

// Crear componente de consola interactiva con Monaco
function createInteractiveConsole(codeOrBase64, containerId, isBase64 = false) {
    const container = document.getElementById(containerId);
    if (!container) return;

    let code = codeOrBase64;
    if (isBase64) {
        try {
            code = atob(codeOrBase64);
        } catch (e) {
            console.error("Error decoding Base64 code:", e);
            code = "# Error cargando código base";
        }
    }

    const consoleHTML = `
        <div class="python-interactive-container grid grid-cols-1 lg:grid-cols-2 gap-4 h-[500px]">
            <!-- Panel de Código (Monaco) -->
            <div class="code-display-panel flex flex-col h-full border-r border-gray-700/50">
                <div class="code-display-header flex justify-between items-center p-2 bg-gray-900/50">
                    <div class="flex items-center gap-2">
                        <div class="dots flex gap-1">
                            <span class="dot w-3 h-3 rounded-full bg-red-500"></span>
                            <span class="dot w-3 h-3 rounded-full bg-yellow-500"></span>
                            <span class="dot w-3 h-3 rounded-full bg-green-500"></span>
                        </div>
                        <span class="text-xs font-bold text-gray-400 ml-2">main.py</span>
                    </div>
                    <span class="text-xs text-gray-500 bg-gray-800 px-2 py-1 rounded border border-gray-700">Read Only</span>
                </div>
                <!-- Container para Monaco -->
                <div id="monaco-${containerId}" class="flex-1 w-full min-h-0 overflow-hidden"></div>
            </div>

            <!-- Panel de Consola -->
            <div class="console-panel flex flex-col h-full bg-[#1a1b26]">
                <div class="console-header flex justify-between items-center p-2 border-b border-gray-700/50">
                    <div class="title flex items-center gap-2 text-gray-300 text-sm font-mono">
                        <i data-lucide="terminal" class="w-4 h-4"></i>
                        Terminal
                    </div>
                    <div class="console-controls flex gap-2">
                         <button class="console-btn console-btn-run flex items-center gap-1 px-3 py-1 bg-green-600 hover:bg-green-700 text-white rounded text-xs transition-colors" onclick="runPythonCode('${containerId}')">
                            <i data-lucide="play" class="w-3 h-3"></i>
                            Ejecutar
                        </button>
                        <button class="console-btn console-btn-clear p-1 hover:bg-gray-700 rounded text-gray-400 transition-colors" onclick="clearConsole('${containerId}')" title="Limpiar">
                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                        </button>
                    </div>
                </div>
                <div class="console-output flex-1 p-4 overflow-y-auto font-mono text-sm" id="${containerId}-output">
                    <div class="console-line info text-gray-500">>>> Esperando ejecución...</div>
                </div>
                <div class="console-input-prompt hidden flex items-center p-2 border-t border-gray-700/50 bg-gray-900/30" id="${containerId}-input-prompt">
                    <span class="text-yellow-500 mr-2 font-mono">>>></span>
                    <input type="text" class="console-input-field bg-transparent border-none outline-none text-white w-full font-mono text-sm" id="${containerId}-input" placeholder="Escribe aquí..." />
                </div>
            </div>
        </div>
    `;

    container.innerHTML = consoleHTML;
    
    if (window.lucide) lucide.createIcons();

    // Setup input handler
    const inputField = document.getElementById(`${containerId}-input`);
    if (inputField) {
        // Evitar duplicados usando flag en dataset en lugar de clonar
        if (inputField.dataset.listenerAttached === 'true') {
            return;
        }
        
        inputField.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                const value = inputField.value;
                console.log(`[Python Console] Input submitted for ${containerId}: "${value}"`);
                
                // Usar resolver específico del contenedor
                if (window.consoleInputResolvers && window.consoleInputResolvers[containerId]) {
                    window.consoleInputResolvers[containerId](value);
                    delete window.consoleInputResolvers[containerId];
                } else {
                    console.warn(`[Python Console] No resolver found for ${containerId}. Input ignored.`);
                }
                
                inputField.value = '';
                document.getElementById(`${containerId}-input-prompt`).classList.add('hidden');
            }
        });
        
        inputField.dataset.listenerAttached = 'true';
    }

    // Inicializar Monaco Editor
    if (!monacoRequireConfigured) {
        require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.36.1/min/vs' }});
        monacoRequireConfigured = true;
    }
    require(['vs/editor/editor.main'], function() {
        // Define themes first
        if (window.themeManager) window.themeManager.defineCustomThemes();
        
        const user = JSON.parse(localStorage.getItem('currentUser')) || {};
        const userTheme = user.preferredTheme || 'vs-dark';

        const editorElement = document.getElementById(`monaco-${containerId}`);
        if(editorElement) {
             window.monacoEditors[containerId] = monaco.editor.create(editorElement, {
                value: code.trim(),
                language: 'python',
                theme: userTheme, 
                automaticLayout: true,
                minimap: { enabled: true },
                fontSize: 14,
                lineNumbers: 'on',
                renderIndentGuides: true,       
                guides: { indentation: true }, 
                scrollBeyondLastLine: false,
                roundedSelection: true,
                padding: { top: 10 },
                readOnly: true, // USER REQUEST: Prevent modification
                domReadOnly: true // Ensure input is blocked
            });
        }
    });
}

// Ejecutar código Python desde Monaco
// Función para inicializar Monaco Editor en bloques de código estáticos (Ejemplos)
// Convierte los .code-block en editores Monaco con tema Tokyo Night
let codeBlockMonacoInstances = [];
let codeBlockCounter = 0;

function initializeCodeBlockMonaco() {
    if (!window.monaco) return;

    // Obtener todos los bloques de código en la lección actual (los que aún no tienen editor)
    const codeBlocks = document.querySelectorAll('#lesson-content .code-block:not([data-monaco-initialized])');
    
    codeBlocks.forEach((block) => {
        const codeElement = block.querySelector('pre code');
        if (!codeElement) return;
        
        const codeText = codeElement.textContent || codeElement.innerText;
        if (!codeText.trim()) return;

        block.setAttribute('data-monaco-initialized', 'true');

        // Detectar lenguaje
        let language = 'python';
        if (codeElement.className.includes('language-html')) language = 'html';
        else if (codeElement.className.includes('language-css')) language = 'css';
        else if (codeElement.className.includes('language-javascript')) language = 'javascript';

        // Crear ID único
        const uniqueId = `code-block-monaco-${codeBlockCounter++}`;
        
        // Calcular altura basada en líneas
        const lines = codeText.split('\n').length;
        const height = Math.min(Math.max(lines * 22 + 20, 100), 500);

        // Limpiar contenedor pero mantener referencia
        block.innerHTML = '';
        
        // Contenedor principal estilizado
        const container = document.createElement('div');
        container.className = 'code-block-monaco-wrapper';
        container.style.cssText = 'border-radius: 12px; overflow: hidden; margin-top: 1rem; border: 1px solid #414868; box-shadow: 0 4px 12px rgba(0,0,0,0.3);';

        // Header estilo Tokyo Night
        const header = document.createElement('div');
        header.className = 'code-block-header';
        header.style.cssText = 'display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 1rem; background: linear-gradient(135deg, #24283b 0%, #1a1b26 100%); border-bottom: 1px solid #414868;';
        header.innerHTML = `
            <div class="flex items-center gap-2">
                <span class="w-3 h-3 rounded-full bg-[#ff5f56]"></span>
                <span class="w-3 h-3 rounded-full bg-[#ffbd2e]"></span>
                <span class="w-3 h-3 rounded-full bg-[#27c93f]"></span>
                <span class="text-xs text-gray-400 ml-2 font-mono">${language === 'python' ? 'example.py' : language === 'html' ? 'index.html' : 'code.' + language}</span>
            </div>
            <span class="text-xs text-gray-500 bg-gray-800 px-2 py-1 rounded border border-gray-700">Preview</span>
        `;

        const monacoContainer = document.createElement('div');
        monacoContainer.id = uniqueId;
        monacoContainer.style.cssText = `width: 100%; height: ${height}px;`;

        container.appendChild(header);
        container.appendChild(monacoContainer);
        block.appendChild(container);

        const editor = monaco.editor.create(monacoContainer, {
            value: codeText.trim(),
            language: language,
            theme: 'tokyo-night',
            readOnly: true,
            domReadOnly: true,
            minimap: { enabled: false },
            fontSize: 14,
            fontFamily: "'JetBrains Mono', monospace",
            lineNumbers: 'on',
            scrollBeyondLastLine: false,
            padding: { top: 10, bottom: 10 }
        });

        codeBlockMonacoInstances.push(editor);
    });
}

// Re-inicializar los bloques de código cuando se cambia de paso
const originalRenderLesson = typeof renderLesson === 'function' ? renderLesson : null;
if (originalRenderLesson) {
    window.renderLesson = function() {
        // Limpiar instancias anteriores para liberar memoria
        codeBlockMonacoInstances.forEach(editor => {
            if (editor && typeof editor.dispose === 'function') editor.dispose();
        });
        codeBlockMonacoInstances = [];
        
        originalRenderLesson.apply(this, arguments);
        setTimeout(initializeCodeBlockMonaco, 100);
    };
}

async function runPythonCode(containerId) {
    const outputDiv = document.getElementById(`${containerId}-output`);
    const runBtn = document.querySelector(`#${containerId} .console-btn-run`);
    
    if (!outputDiv || !runBtn) return;

    if (!pyodideReady) {
        outputDiv.innerHTML = '<div class="console-loading"><div class="spinner"></div> Cargando...</div>';
        runBtn.disabled = true;
        await initPyodide();
        runBtn.disabled = false;
    }

    const editor = window.monacoEditors[containerId];
    if (!editor) return;
    const code = editor.getValue();

    outputDiv.innerHTML = '<div class="console-line info">🚀 Ejecutando...</div>';

    try {
        // Setup output redirect
        pyodide.globals.set('print_output', (text, is_prompt = false) => {
            const line = document.createElement('div');
            line.className = `console-line ${is_prompt ? 'input' : 'output'}`;
            line.textContent = text;
            outputDiv.appendChild(line);
            outputDiv.scrollTop = outputDiv.scrollHeight;
        });

        // Setup input resolver
        pyodide.globals.set('js_get_input', (prompt) => {
            return getUserInput(containerId, prompt);
        });

        // Pre-configure Python environment
        await pyodide.runPythonAsync(`
import sys
import builtins

class CustomStdout:
    def write(self, text):
        if text.strip(): print_output(text)
    def flush(self): pass

sys.stdout = CustomStdout()
sys.stderr = CustomStdout()

async def async_input(prompt=''):
    if prompt: print_output(prompt, True)
    return await js_get_input(prompt)

builtins.input = async_input
        `);

        // Transform user code to be async-safe
        // We wrap it in a function if it contains 'input' to allow top-level await behavior
        await pyodide.runPythonAsync(code.replace(/\binput\s*\(/g, 'await input('));
        
        const doneLine = document.createElement('div');
        doneLine.className = 'console-line info';
        doneLine.textContent = '✅ Ejecución completada';
        outputDiv.appendChild(doneLine);

    } catch (error) {
        const errorLine = document.createElement('div');
        errorLine.className = 'console-line error';
        errorLine.textContent = `❌ Error: ${error.message}`;
        outputDiv.appendChild(errorLine);
    }
    outputDiv.scrollTop = outputDiv.scrollHeight;
}

// Obtener input del usuario
window.consoleInputResolvers = window.consoleInputResolvers || {};

function getUserInput(containerId, prompt) {
    return new Promise((resolve) => {
        const inputPrompt = document.getElementById(`${containerId}-input-prompt`);
        const inputField = document.getElementById(`${containerId}-input`);
        
        if (!inputPrompt || !inputField) {
            resolve('');
            return;
        }

        inputPrompt.classList.remove('hidden');
        inputPrompt.style.display = 'flex';
        
        setTimeout(() => {
            inputField.focus();
            const outputDiv = document.getElementById(`${containerId}-output`);
            if (outputDiv) outputDiv.scrollTop = outputDiv.scrollHeight;
        }, 50);
        
        window.consoleInputResolvers[containerId] = resolve;
    });
}

// Fin de la lógica de Monaco y Python


</script>

<!-- Prism.js core and languages -->
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-markup.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-css.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-javascript.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/toolbar/prism-toolbar.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-python.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-ruby.min.js"></script>
</body>
</html>